<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"swoole.app","root":"/","images":"/images","scheme":"Muse","version":"8.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"بحث...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="一个专注记录外贸网站开发技术栈的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="杨子鳄鱼 ● 外贸自建站">
<meta property="og:url" content="https://swoole.app/page/35/index.html">
<meta property="og:site_name" content="杨子鳄鱼 ● 外贸自建站">
<meta property="og:description" content="一个专注记录外贸网站开发技术栈的个人博客">
<meta property="og:locale">
<meta property="article:author" content="lnmput@gmail.com">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://swoole.app/page/35/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-Hans","comments":"","permalink":"","path":"page/35/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>杨子鳄鱼 ● 外贸自建站</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="تشغيل شريط التصفح" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">杨子鳄鱼 ● 外贸自建站</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">十年外贸建站经验，专注外贸独立站建设，欢迎咨询</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section">Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags" rel="section">الوسوم</a></li>
        <li class="menu-item menu-item-read"><a href="/read" rel="section">read</a></li>
        <li class="menu-item menu-item-translate"><a href="/tags/translate" rel="section">translate</a></li>
        <li class="menu-item menu-item-about"><a href="/about" rel="section">معلومات</a></li>
        <li class="menu-item menu-item-site"><a href="/site" rel="section">site</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          المحتويات
        </li>
        <li class="sidebar-nav-overview">
          عام
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">lnmput@gmail.com</p>
  <div class="site-description" itemprop="description">一个专注记录外贸网站开发技术栈的个人博客</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">373</span>
          <span class="site-state-item-name">المقالات</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">146</span>
        <span class="site-state-item-name">الوسوم</span>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2016/10/24/python%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="一个专注记录外贸网站开发技术栈的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="杨子鳄鱼 ● 外贸自建站">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/10/24/python%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">python字符串操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">نُشر في</span>

      <time title="أُنشأ: 2016-10-24 21:48:09" itemprop="dateCreated datePublished" datetime="2016-10-24T21:48:09+09:00">2016-10-24</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">عُدل في</span>
        <time title="عُدل: 2018-03-27 22:27:01" itemprop="dateModified" datetime="2018-03-27T22:27:01+09:00">2018-03-27</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
你那能叫活着么？你那只能叫没死。
</blockquote>
### 去空格
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#strip 同时去掉左右两边的空格</span></span><br><span class="line"><span class="comment">#lstrip 去掉左边的空格</span></span><br><span class="line"><span class="comment">#rstrip 去掉右边的空格</span></span><br><span class="line">s = <span class="string">&#x27;  yang guo qi   &#x27;</span></span><br><span class="line">s= s.strip()</span><br><span class="line"><span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure>
### 去一些特殊符号
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;  yang guo qi  , &#x27;</span></span><br><span class="line">s= s.strip().strip(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure>
### 计算长度
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;  yang guo qi  , &#x27;</span></span><br><span class="line">s= <span class="built_in">len</span>(s)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure>
### 大小写转换
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;  yang guo qi  , &#x27;</span></span><br><span class="line">s= s.upper()</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;  Yang guo qi  , &#x27;</span></span><br><span class="line">s= s.lower()</span><br><span class="line"><span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure>
### 反转字符串
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;  Yang guo qi  , &#x27;</span></span><br><span class="line">s= s[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure>
### 查找字符串
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;  Yang guo qi  , &#x27;</span></span><br><span class="line">d = <span class="string">&#x27;qi&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s.find(d))</span><br><span class="line"><span class="comment"># 返回位置</span></span><br></pre></td></tr></table></figure>
### 字符串截取
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span> = ’0123456789′</span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">str</span>[<span class="number">0</span>:<span class="number">3</span>]) <span class="comment">#截取第一位到第三位的字符</span></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">str</span>[:]) <span class="comment">#截取字符串的全部字符</span></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">str</span>[<span class="number">6</span>:]) <span class="comment">#截取第七个字符到结尾</span></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">str</span>[:-<span class="number">3</span>]) <span class="comment">#截取从头开始到倒数第三个字符之前</span></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">str</span>[<span class="number">2</span>]) <span class="comment">#截取第三个字符</span></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">str</span>[-<span class="number">1</span>]) <span class="comment">#截取倒数第一个字符</span></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">str</span>[::-<span class="number">1</span>]) <span class="comment">#创造一个与原字符串顺序相反的字符串</span></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">str</span>[-<span class="number">3</span>:-<span class="number">1</span>]) <span class="comment">#截取倒数第三位与倒数第一位之前的字符</span></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">str</span>[-<span class="number">3</span>:]) <span class="comment">#截取倒数第三位到结尾</span></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">str</span>[:-<span class="number">5</span>:-<span class="number">3</span>]) <span class="comment">#逆序截取，具体啥意思没搞明白？</span></span><br></pre></td></tr></table></figure>
### 分割字符串
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;Yang,guo qi&#x27;</span></span><br><span class="line">d = s.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"></span><br><span class="line">sStr1 = <span class="string">&#x27;ab,cde,fgh,ijk&#x27;</span></span><br><span class="line">sStr2 = <span class="string">&#x27;,&#x27;</span></span><br><span class="line">sStr1 = sStr1[sStr1.find(sStr2) + <span class="number">1</span>:]</span><br><span class="line"><span class="built_in">print</span>(sStr1)</span><br></pre></td></tr></table></figure>
### 格式化
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span></span><br><span class="line">s = <span class="string">&#x27;this is my &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;dog&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"><span class="number">2.</span></span><br><span class="line">s = <span class="string">&#x27;this is my &#123;&#125; and &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;dog&#x27;</span>,<span class="string">&#x27;cat&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"><span class="number">3.</span> 语法求解释</span><br><span class="line">urls = [<span class="string">&#x27;oa&#123;&#125;-New_York&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>,<span class="number">930</span>,<span class="number">30</span>)]</span><br><span class="line"><span class="built_in">print</span>(urls)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2016/10/24/python%E7%88%AC%E8%99%AB%E7%AC%AC%E4%B8%80%E5%91%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="一个专注记录外贸网站开发技术栈的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="杨子鳄鱼 ● 外贸自建站">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/10/24/python%E7%88%AC%E8%99%AB%E7%AC%AC%E4%B8%80%E5%91%A8/" class="post-title-link" itemprop="url">python爬虫第一周</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">نُشر في</span>

      <time title="أُنشأ: 2016-10-24 21:32:09" itemprop="dateCreated datePublished" datetime="2016-10-24T21:32:09+09:00">2016-10-24</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">عُدل في</span>
        <time title="عُدل: 2018-04-25 10:34:38" itemprop="dateModified" datetime="2018-04-25T10:34:38+09:00">2018-04-25</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
身不饥寒，天未曾负我；学无长进，我何以对天
</blockquote>

<h3 id="安装lxml"><a href="#安装lxml" class="headerlink" title="安装lxml"></a>安装lxml</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 首先安装pip install wheel</span><br><span class="line"><span class="number">2.</span> 在这里下载对应的.whl文件，注意别改文件名！</span><br><span class="line">   http://www.lfd.uci.edu/~gohlke/pythonlibs/<span class="comment">#lxml</span></span><br><span class="line">   cp后面是Python的版本号，<span class="number">27</span>表示<span class="number">2.7</span>，根据你的Python版本选择下载。</span><br><span class="line"><span class="number">3.</span> pip install 带后缀的完整文件名</span><br></pre></td></tr></table></figure>
<h3 id="例子-一"><a href="#例子-一" class="headerlink" title="例子(一)"></a>例子(一)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span>  urlopen</span><br><span class="line">resp = urlopen(<span class="string">&#x27;http://www.tooopen.com/img/87.aspx&#x27;</span>).read().decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">Soup = BeautifulSoup(resp,<span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">images = Soup.select(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> image <span class="keyword">in</span> images:</span><br><span class="line">    <span class="built_in">print</span>(image.get_text())</span><br></pre></td></tr></table></figure>
<h3 id="例子-二"><a href="#例子-二" class="headerlink" title="例子(二)"></a>例子(二)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span>  urlopen</span><br><span class="line">resp = urlopen(<span class="string">&#x27;http://www.tooopen.com/img/87.aspx&#x27;</span>).read().decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">Soup = BeautifulSoup(resp,<span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">images = Soup.select(<span class="string">&#x27;img&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> image <span class="keyword">in</span> images:</span><br><span class="line">    <span class="built_in">print</span>(image.get(<span class="string">&#x27;src&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h3 id="例子-三"><a href="#例子-三" class="headerlink" title="例子(三)"></a>例子(三)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;http://zhuanzhuan.58.com/detail/789842404801118212z.shtml&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getInfo</span>(<span class="params">url</span>):</span></span><br><span class="line">    wpData = requests.get(url)</span><br><span class="line">    soup = BeautifulSoup(wpData.text,<span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">    title = soup.title.text</span><br><span class="line">    price = soup.select(<span class="string">&#x27;.price_now &gt; i&#x27;</span>)</span><br><span class="line">    tags = soup.select(<span class="string">&#x27;.qual_label&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> tags</span><br><span class="line"></span><br><span class="line">data = getInfo(url)</span><br><span class="line"><span class="keyword">for</span> tag <span class="keyword">in</span> data:</span><br><span class="line">    <span class="built_in">print</span>(tag.text)</span><br></pre></td></tr></table></figure>
<h3 id="传递http头部"><a href="#传递http头部" class="headerlink" title="传递http头部"></a>传递http头部</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span>  requests</span><br><span class="line">url = <span class="string">&#x27;http://www.tripadvisor.cn/Saves#525792&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWeb....36&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;TASSK=eNs%2BEc2TG.....0N9BrZpKwsTH%2BAwg%3D...; NPID=&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">wpData = requests.get(url,headers = headers)</span><br><span class="line">soup = BeautifulSoup(wpData.text,<span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">titles = soup.select(<span class="string">&#x27;div.title&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(soup)</span><br></pre></td></tr></table></figure>
<h3 id="构建多页数延迟访问"><a href="#构建多页数延迟访问" class="headerlink" title="构建多页数延迟访问"></a>构建多页数延迟访问</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span>  requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">urls = [<span class="string">&#x27;http://www.tripadvisor.cn/...-oa&#123;&#125;-New_Y...rk.html#ATTRACTION_LIST&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>,<span class="number">930</span>,<span class="number">30</span>)]</span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(url)</span><br></pre></td></tr></table></figure>
<h3 id="异步加载"><a href="#异步加载" class="headerlink" title="异步加载"></a>异步加载</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在 chrome 浏览器中找到有规律的，xhr请求链接</span><br></pre></td></tr></table></figure>
<h3 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h3><ul>
<li>一般PC端的数据如果不能直接拿到，可以尝试访问手机端从而直接达到目的</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2016/10/24/laravel%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%93%E5%8D%B0sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="一个专注记录外贸网站开发技术栈的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="杨子鳄鱼 ● 外贸自建站">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/10/24/laravel%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%93%E5%8D%B0sql/" class="post-title-link" itemprop="url">laravel中如何打印sql</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">نُشر في</span>

      <time title="أُنشأ: 2016-10-24 10:13:28" itemprop="dateCreated datePublished" datetime="2016-10-24T10:13:28+09:00">2016-10-24</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">عُدل في</span>
        <time title="عُدل: 2018-04-08 14:48:33" itemprop="dateModified" datetime="2018-04-08T14:48:33+09:00">2018-04-08</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
你也是一片
在我胸口颤动的小叶子。
生命之风将你吹送至此。
</blockquote>

<h3 id="第一种方法"><a href="#第一种方法" class="headerlink" title="第一种方法"></a>第一种方法</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//in our case,</span></span><br><span class="line"> DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;toSql(); </span><br><span class="line"><span class="comment">//return</span></span><br><span class="line">select * <span class="keyword">from</span> users</span><br></pre></td></tr></table></figure>
<h3 id="第二种方法"><a href="#第二种方法" class="headerlink" title="第二种方法"></a>第二种方法</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;haha&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    Event::listen(<span class="string">&#x27;illuminate.query&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$query</span>, <span class="variable">$params</span>, <span class="variable">$time</span>, <span class="variable">$conn</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        dd(<span class="keyword">array</span>(<span class="variable">$query</span>, <span class="variable">$params</span>, <span class="variable">$time</span>, <span class="variable">$conn</span>));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    \RainLab\User\Models\User::whereBetween(<span class="string">&#x27;created_at&#x27;</span>, </span><br><span class="line">    	[<span class="string">&#x27;2016-05-26 00:00:00&#x27;</span>, <span class="string">&#x27;2016-06-27 00:00:00&#x27;</span>]</span><br><span class="line">    	)-&gt;get([<span class="string">&#x27;email&#x27;</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="第三种方法"><a href="#第三种方法" class="headerlink" title="第三种方法"></a>第三种方法</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DB::enableQueryLog();</span><br><span class="line">   <span class="variable">$users</span> = \RainLab\User\Models\User::whereBetween(<span class="string">&#x27;created_at&#x27;</span>, [<span class="string">&#x27;2016-05-26 00:00:00&#x27;</span>, <span class="string">&#x27;2016-06-27 00:00:00&#x27;</span>])-&gt;get();</span><br><span class="line">   dd(DB::getQueryLog());</span><br></pre></td></tr></table></figure>

<h3 id="第四种方法"><a href="#第四种方法" class="headerlink" title="第四种方法"></a>第四种方法</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trace_sql</span>(<span class="params"><span class="variable">$dump</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    \DB::listen(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$event</span></span>) <span class="keyword">use</span>(<span class="params"><span class="variable">$dump</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$dump</span>) &#123;</span><br><span class="line">            dump(<span class="variable">$event</span>-&gt;sql);</span><br><span class="line">            dump(<span class="variable">$event</span>-&gt;bindings);</span><br><span class="line">        &#125;</span><br><span class="line">        info(<span class="variable">$event</span>-&gt;sql);</span><br><span class="line">        info(<span class="variable">$event</span>-&gt;bindings);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="最后一种方法"><a href="#最后一种方法" class="headerlink" title="最后一种方法"></a>最后一种方法</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//安装 debug</span></span><br><span class="line">composer <span class="keyword">require</span> barryvdh/laravel-debugbar</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2016/10/17/python%E5%B0%8F%E5%AE%9E%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="一个专注记录外贸网站开发技术栈的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="杨子鳄鱼 ● 外贸自建站">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/10/17/python%E5%B0%8F%E5%AE%9E%E4%BE%8B/" class="post-title-link" itemprop="url">python小实例</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">نُشر في</span>

      <time title="أُنشأ: 2016-10-17 14:46:25" itemprop="dateCreated datePublished" datetime="2016-10-17T14:46:25+09:00">2016-10-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">عُدل في</span>
        <time title="عُدل: 2018-04-25 10:34:31" itemprop="dateModified" datetime="2018-04-25T10:34:31+09:00">2018-04-25</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
自此无心爱良夜，任他明月下西楼。
</blockquote>

<h3 id="按逗号分隔列表"><a href="#按逗号分隔列表" class="headerlink" title="按逗号分隔列表"></a>按逗号分隔列表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">L = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">s1 = <span class="string">&#x27;,&#x27;</span>.join(<span class="built_in">str</span>(n) <span class="keyword">for</span> n <span class="keyword">in</span> L)</span><br><span class="line"><span class="built_in">print</span> s1</span><br></pre></td></tr></table></figure>
<h3 id="有1、2、3、4个数字，能组成多少个互不相同且无重复数字的三位数？都是多少？"><a href="#有1、2、3、4个数字，能组成多少个互不相同且无重复数字的三位数？都是多少？" class="headerlink" title="有1、2、3、4个数字，能组成多少个互不相同且无重复数字的三位数？都是多少？"></a>有1、2、3、4个数字，能组成多少个互不相同且无重复数字的三位数？都是多少？</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">            <span class="keyword">if</span>( i != k ) <span class="keyword">and</span> (i != j) <span class="keyword">and</span> (j != k):</span><br><span class="line">                <span class="built_in">print</span> i,j,k</span><br></pre></td></tr></table></figure>
<h3 id="交换两个变量"><a href="#交换两个变量" class="headerlink" title="交换两个变量"></a>交换两个变量</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exchange</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    a,b = b,a</span><br><span class="line">    <span class="keyword">return</span> (a,b)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    x = <span class="number">10</span></span><br><span class="line">    y = <span class="number">20</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;x = %d,y = %d&#x27;</span> % (x,y))</span><br><span class="line"></span><br><span class="line">x,y = exchange(x,y)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;x = %d,y = %d&#x27;</span> % (x,y))</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2016/10/08/git%E6%92%A4%E9%94%80commit%E7%9A%84%E4%B8%89%E4%B8%AA%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="一个专注记录外贸网站开发技术栈的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="杨子鳄鱼 ● 外贸自建站">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/10/08/git%E6%92%A4%E9%94%80commit%E7%9A%84%E4%B8%89%E4%B8%AA%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">git撤销commit的三个方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">نُشر في</span>

      <time title="أُنشأ: 2016-10-08 21:33:53" itemprop="dateCreated datePublished" datetime="2016-10-08T21:33:53+09:00">2016-10-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">عُدل في</span>
        <time title="عُدل: 2018-03-27 22:22:55" itemprop="dateModified" datetime="2018-03-27T22:22:55+09:00">2018-03-27</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
當我們懂得珍惜平凡的幸福時，就已經成了人生的贏家。
</blockquote>
撤销commit有很多方法，个人比较推荐用 reset 或 rebase -i，底下将会同时介绍 revert 和 reset 的方法。

<p>commit 如下</p>
<p>A -&gt; B -&gt; C -&gt; D -&gt; E<br>想要还原到 commit C 之后的状态 (也就是把 D 和 E 回退)</p>
<h3 id="revert"><a href="#revert" class="headerlink" title="revert"></a>revert</h3><p>用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git revert E</span><br><span class="line">git revert D</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p>A -&gt; B -&gt; C -&gt; D -&gt; E -&gt; F -&gt; G<br>F 是还原 commit E 修改结果的 commit</p>
<p>G 是还原 commit D 修改结果的 commit</p>
<p>因此，revert 只会让 commit 继续往前</p>
<p>优点是可以针对某个 commit 进行还原，并且留下还原记录</p>
<h3 id="rebase-i"><a href="#rebase-i" class="headerlink" title="rebase -i"></a>rebase -i</h3><p>假如想要抽掉某个 commit 又不想留下记录, rebase -i 就很好用了</p>
<p>假如只想要还原 D 变成：</p>
<p>A -&gt; B -&gt; C -&gt; E</p>
<p>则用命令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase -i C</span><br></pre></td></tr></table></figure>
<p>这时候会出现文字编辑</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pick D xxx</span><br><span class="line">pick E ooo</span><br></pre></td></tr></table></figure>
<p>把 pick D xxx 整列移除后储存就可以了，若中间有遇到冲突，则必须自行修正后再继续</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git rebase --<span class="keyword">continue</span></span><br></pre></td></tr></table></figure>
<h3 id="reset"><a href="#reset" class="headerlink" title="reset"></a>reset</h3><p>用于做整段 commits 的还原</p>
<p>例如希望还原到 B commit 以后的状态变成</p>
<p>A -&gt; B<br>则</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset B</span><br></pre></td></tr></table></figure>
<p>那么 git 会将 log 中的 C, D, E 都清除</p>
<p>但档案内容没有任何变动，因此会看到 C, D, E 修改的档案处在 unstaged 阶段</p>
<p>若针对部分档案还原可以用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout [file path]</span><br></pre></td></tr></table></figure>
<p>若要全部还原可用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -f</span><br></pre></td></tr></table></figure>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>还没 push 前，个人倾向不产生太多 commit。因此我都会用 rebase -i 进行编修, 顺便合并或reword 一些 commit</p>
<p>某个特殊情况, 例如发现某个 commit 里面包含了不相干的档案, 欲重新 commit 时，就会先用 rebase -i 把欲修改的 commit 换到后面(较新), 然后再用 reset 重新 stage + commit。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2016/08/31/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3PHP%E5%8E%9F%E7%90%86%E4%B9%8BOpcodes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="一个专注记录外贸网站开发技术栈的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="杨子鳄鱼 ● 外贸自建站">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/08/31/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3PHP%E5%8E%9F%E7%90%86%E4%B9%8BOpcodes/" class="post-title-link" itemprop="url">深入理解PHP原理之Opcodes</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">نُشر في</span>
      

      <time title="أُنشأ: 2016-08-31 09:49:23 / عُدل: 10:55:21" itemprop="dateCreated datePublished" datetime="2016-08-31T09:49:23+09:00">2016-08-31</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
低头要有勇气，抬头要有底气
</blockquote>
Opcode是一种PHP脚本编译后的中间语言，就像Java的ByteCode,或者.NET的MSL，举个例子，比如你写下了如下的PHP代码：
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">   <span class="variable">$a</span> = <span class="number">1</span> + <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
PHP执行这段代码会经过如下4个步骤(确切的来说，应该是PHP的语言引擎Zend)

<ul>
<li>1.Scanning(Lexing) ,将PHP代码转换为语言片段(Tokens)</li>
<li>2.Parsing, 将Tokens转换成简单而有意义的表达式</li>
<li>3.Compilation, 将表达式编译成Opocdes</li>
<li>4.Execution, 顺次执行Opcodes，每次一条，从而实现PHP脚本的功能。</li>
</ul>
<p>题外话:现在有的Cache比如APC,可以使得PHP缓存住Opcodes，这样，每次有请求来临的时候，就不需要重复执行前面3步，从而能大幅的提高PHP的执行速度。</p>
<p>那什么是Lexing? 学过编译原理的同学都应该对编译原理中的词法分析步骤有所了解，Lex就是一个词法分析的依据表。 Zend/zend_language_scanner.c会根据Zend/zend_language_scanner.l(Lex文件),来输入的 PHP代码进行词法分析，从而得到一个一个的“词”，PHP4.2开始提供了一个函数叫token_get_all,这个函数就可以讲一段PHP代码 Scanning成Tokens；</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.laruence.com/2008/06/18/221.html">http://www.laruence.com/2008/06/18/221.html</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2016/08/24/PHP%E5%8F%8D%E5%B0%84%E7%B1%BBReflectionClass/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="一个专注记录外贸网站开发技术栈的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="杨子鳄鱼 ● 外贸自建站">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/08/24/PHP%E5%8F%8D%E5%B0%84%E7%B1%BBReflectionClass/" class="post-title-link" itemprop="url">PHP反射类ReflectionClass</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">نُشر في</span>
      

      <time title="أُنشأ: 2016-08-24 14:22:29 / عُدل: 15:57:48" itemprop="dateCreated datePublished" datetime="2016-08-24T14:22:29+09:00">2016-08-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
我讨厌变老，当我们力量衰弱的时候如果出现更强的敌人，我会觉得很恐怖，很遗憾。
</blockquote>
### 基本说明
先定义一个User类
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;registert&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
实例化并调用其中的方法
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$user</span> = <span class="keyword">new</span> User();</span><br><span class="line"><span class="variable">$user</span>-&gt;login();</span><br></pre></td></tr></table></figure>
实例化User类的反射类并调用其中的一个方法
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$reUser</span> = <span class="keyword">new</span> \ReflectionClass(<span class="string">&#x27;User&#x27;</span>);</span><br><span class="line">var_dump(<span class="variable">$reUser</span>-&gt;getFileName());</span><br></pre></td></tr></table></figure>
说明：ReflectionClass类获取类相关信息，如获取属性、方法、文档注释等；

<h3 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h3><ul>
<li>通过_call可以调用类一些不确定的方法，这个时候就可以通过反射类ReflectionClass来判断类方法是否存在，是不是可见可调用的。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionA</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;I&#x27;am A\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">actionB</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;I&#x27;am B\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$objects</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;objects=<span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"><span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;objects[]=<span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">pp</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//调用不可见的方法或者没有的方法都会走到这里</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$args</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="keyword">$this</span>-&gt;objects <span class="keyword">as</span> <span class="variable">$object</span>)&#123;</span><br><span class="line">            <span class="variable">$class</span>=<span class="keyword">new</span> ReflectionClass(<span class="variable">$object</span>);</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable">$class</span>-&gt;hasMethod(<span class="variable">$name</span>))&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$method</span>=<span class="variable">$class</span>-&gt;getMethod(<span class="variable">$name</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$method</span>&amp;&amp;<span class="variable">$method</span>-&gt;isPublic()&amp;&amp;!<span class="variable">$method</span>-&gt;isAbstract())&#123;</span><br><span class="line">                <span class="variable">$method</span>-&gt;invoke(<span class="variable">$object</span>,<span class="variable">$args</span>);</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;not method!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$t</span>=<span class="keyword">new</span> test();</span><br><span class="line"><span class="variable">$t</span>-&gt;add(<span class="keyword">new</span> A());</span><br><span class="line"><span class="variable">$t</span>-&gt;add(<span class="keyword">new</span> B());</span><br><span class="line"><span class="variable">$t</span>-&gt;pp(); <span class="comment">//不可见方法</span></span><br><span class="line"><span class="variable">$t</span>-&gt;actionA();</span><br><span class="line"><span class="variable">$t</span>-&gt;actionB();</span><br></pre></td></tr></table></figure>






      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2016/08/24/PHP%E5%87%BD%E6%95%B0call-user-func-array%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="一个专注记录外贸网站开发技术栈的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="杨子鳄鱼 ● 外贸自建站">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/08/24/PHP%E5%87%BD%E6%95%B0call-user-func-array%E7%94%A8%E6%B3%95/" class="post-title-link" itemprop="url">PHP函数call_user_func_array用法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">نُشر في</span>
      

      <time title="أُنشأ: 2016-08-24 12:13:26 / عُدل: 15:52:15" itemprop="dateCreated datePublished" datetime="2016-08-24T12:13:26+09:00">2016-08-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
无她，唯手熟尔
</blockquote>
### 例子


<p>调用函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"><span class="variable">$b</span>, <span class="variable">$c</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$c</span>;</span><br><span class="line">&#125;</span><br><span class="line">call_user_func_array(<span class="string">&#x27;a&#x27;</span>, <span class="keyword">array</span>(<span class="string">&quot;111&quot;</span>, <span class="string">&quot;222&quot;</span>));</span><br><span class="line"><span class="comment">//显示 111 222</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>调用静态方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">ClassA</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">bc</span>(<span class="params"><span class="variable">$b</span>, <span class="variable">$c</span></span>) </span>&#123;</span><br><span class="line">	<span class="variable">$bc</span> = <span class="variable">$b</span> + <span class="variable">$c</span>;</span><br><span class="line">	  <span class="keyword">echo</span> <span class="variable">$bc</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">call_user_func_array(<span class="keyword">array</span>(<span class="string">&#x27;ClassA&#x27;</span>,<span class="string">&#x27;bc&#x27;</span>), <span class="keyword">array</span>(<span class="string">&quot;111&quot;</span>, <span class="string">&quot;222&quot;</span>));</span><br><span class="line"><span class="comment">//显示 333</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>说明：这样就可以用数组的方式给类的方法传入必要的参数</p>
<p>调用普通方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hello, World!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> MyClass();</span><br><span class="line">call_user_func(<span class="keyword">array</span>(<span class="variable">$a</span>, <span class="string">&#x27;hello&#x27;</span>));</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2016/08/24/PHP%E5%A4%A7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BE%AA%E7%8E%AF%E6%97%B6%E5%86%85%E5%AD%98%E8%80%97%E5%B0%BD%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="一个专注记录外贸网站开发技术栈的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="杨子鳄鱼 ● 外贸自建站">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/08/24/PHP%E5%A4%A7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BE%AA%E7%8E%AF%E6%97%B6%E5%86%85%E5%AD%98%E8%80%97%E5%B0%BD%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">PHP大量数据循环时内存耗尽问题的解决方案</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">نُشر في</span>
      

      <time title="أُنشأ: 2016-08-24 10:52:33 / عُدل: 11:58:51" itemprop="dateCreated datePublished" datetime="2016-08-24T10:52:33+09:00">2016-08-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
我的肺功能快衰竭了，没有两天了，请大家不要打钱了，谢谢大家这段时间的帮助，希望来生没有痛苦。---魏则西
</blockquote>

<p>最近在开发一个PHP程序时遇到了下面的错误：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHP Fatal <span class="built_in">error</span>: Allowed memory size of <span class="number">268</span> <span class="number">435</span> <span class="number">456</span> bytes exhausted</span><br></pre></td></tr></table></figure>
<p>错误信息显示允许的最大内存已经耗尽。遇到这样的错误起初让我很诧异，但转眼一想，也不奇怪，因为我正在开发的这个程序是要用一个foreach循环语句在一个有4万条记录的表里全表搜索具有特定特征的数据，也就是说，一次要把4万条数据取出，然后逐条检查每天数据。可想而知，4万条数据全部加载到内存中，内存不爆才怪。</p>
<p>毕竟编程这么多年，我隐约记得PHP里提供有非一次全部加载数据的API，是像处理流媒体那样，随用随取随丢、数据并不会积累在内存的查询方法。经过简单的搜索，果然在官方网站上找到的正确的用法。</p>
<p>这个问题在PHP的官方网站上叫缓冲查询和非缓冲查询(Buffered and Unbuffered queries)。 PHP的查询缺省模式是缓冲模式。也就是说，查询数据结果会一次全部提取到内存里供PHP程序处理。这样给了PHP程序额外的功能，比如说，计算行数，将 指针指向某一行等。更重要的是程序可以对数据集反复进行二次查询和过滤等操作。但这种缓冲查询模式的缺陷就是消耗内存，也就是用空间换速度。</p>
<p>相对的，另外一种PHP查询模式是非缓冲查询，数据库服务器会一条一条的返回数据，而不是一次全部返回，这样的结果就是PHP程序消耗较少的内存，但却增加了数据库服务器的压力，因为数据库会一直等待PHP来取数据，一直到数据全部取完。</p>
<p>很显然，缓冲查询模式适用于小数据量查询，而非缓冲查询适应于大数据量查询。</p>
<p>对于PHP的缓冲模式查询大家都知道，下面列举的例子是如何执行非缓冲查询API。</p>
<h3 id="非缓冲查询方法一-mysqli"><a href="#非缓冲查询方法一-mysqli" class="headerlink" title="非缓冲查询方法一: mysqli"></a>非缓冲查询方法一: mysqli</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$mysqli</span>  = <span class="keyword">new</span> mysqli(<span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;my_user&quot;</span>, <span class="string">&quot;my_password&quot;</span>, <span class="string">&quot;world&quot;</span>); </span><br><span class="line"><span class="variable">$uresult</span> = <span class="variable">$mysqli</span>-&gt;query(<span class="string">&quot;SELECT Name FROM City&quot;</span>, MYSQLI_USE_RESULT); </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$uresult</span>) &#123; </span><br><span class="line">   <span class="keyword">while</span> (<span class="variable">$row</span> = <span class="variable">$uresult</span>-&gt;fetch_assoc()) &#123; </span><br><span class="line">       <span class="keyword">echo</span> <span class="variable">$row</span>[<span class="string">&#x27;Name&#x27;</span>] . PHP_EOL; </span><br><span class="line">   &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="variable">$uresult</span>-&gt;close(); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="非缓冲查询方法二-pdo-mysql"><a href="#非缓冲查询方法二-pdo-mysql" class="headerlink" title="非缓冲查询方法二: pdo_mysql"></a>非缓冲查询方法二: pdo_mysql</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$pdo</span> = <span class="keyword">new</span> PDO(<span class="string">&quot;mysql:host=localhost;dbname=world&quot;</span>, <span class="string">&#x27;my_user&#x27;</span>, <span class="string">&#x27;my_pass&#x27;</span>); </span><br><span class="line"><span class="variable">$pdo</span>-&gt;setAttribute(PDO::MYSQL_ATTR_USE_BUFFERED_QUERY, <span class="literal">false</span>); </span><br><span class="line"></span><br><span class="line"><span class="variable">$uresult</span> = <span class="variable">$pdo</span>-&gt;query(<span class="string">&quot;SELECT Name FROM City&quot;</span>); </span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$uresult</span>) &#123; </span><br><span class="line">   <span class="keyword">while</span> (<span class="variable">$row</span> = <span class="variable">$uresult</span>-&gt;fetch(PDO::FETCH_ASSOC)) &#123; </span><br><span class="line">       <span class="keyword">echo</span> <span class="variable">$row</span>[<span class="string">&#x27;Name&#x27;</span>] . PHP_EOL; </span><br><span class="line">   &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="非缓冲查询方法三-mysql"><a href="#非缓冲查询方法三-mysql" class="headerlink" title="非缓冲查询方法三: mysql"></a>非缓冲查询方法三: mysql</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$conn</span> = mysql_connect(<span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;my_user&quot;</span>, <span class="string">&quot;my_pass&quot;</span>); </span><br><span class="line"><span class="variable">$db</span>   = mysql_select_db(<span class="string">&quot;world&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="variable">$uresult</span> = mysql_unbuffered_query(<span class="string">&quot;SELECT Name FROM City&quot;</span>); </span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$uresult</span>) &#123; </span><br><span class="line">   <span class="keyword">while</span> (<span class="variable">$row</span> = mysql_fetch_assoc(<span class="variable">$uresult</span>)) &#123; </span><br><span class="line">       <span class="keyword">echo</span> <span class="variable">$row</span>[<span class="string">&#x27;Name&#x27;</span>] . PHP_EOL; </span><br><span class="line">   &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.codeceo.com/article/php-foreach-memory.html">http://www.codeceo.com/article/php-foreach-memory.html</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2016/08/23/PHP%E4%B8%AD%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%80%A7%E2%80%94%E2%80%94%E4%BD%A0%E8%A7%89%E5%BE%97%E8%87%AA%E5%B7%B1%E5%B9%B8%E8%BF%90%E5%90%97%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="一个专注记录外贸网站开发技术栈的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="杨子鳄鱼 ● 外贸自建站">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/08/23/PHP%E4%B8%AD%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%80%A7%E2%80%94%E2%80%94%E4%BD%A0%E8%A7%89%E5%BE%97%E8%87%AA%E5%B7%B1%E5%B9%B8%E8%BF%90%E5%90%97%EF%BC%9F/" class="post-title-link" itemprop="url">PHP中的随机性——你觉得自己幸运吗？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">نُشر في</span>
      

      <time title="أُنشأ: 2016-08-23 14:17:06 / عُدل: 15:37:31" itemprop="dateCreated datePublished" datetime="2016-08-23T14:17:06+09:00">2016-08-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
把一切平凡的事做好即不平凡，把一切简单的事做好即不简单。
</blockquote>
PHP 5没有提供一种简单的机制来生成密码学上强壮的随机数，但是PHP 7通过引入几个CSPRNG函数来解决了这个问题。
### 什么是CSPRNG

<p>引用维基百科,一个密码学上安全的伪随机数发生器（Cryptographically Secure Pseudorandom Number Generator 缩写CSPRNG）是一个伪随机数生成器（PRNG）,其生成的伪随机数适用于密码学算法。</p>
<p>CSPRNG可能主要用于:</p>
<p>密钥生成（例如,生成复杂的密钥）<br>为新用户产生随机的密码<br>加密系统<br>获得高级别安全性的一个关键方面就是高品质的随机性</p>
<h3 id="PHP7-中的CSPRNG"><a href="#PHP7-中的CSPRNG" class="headerlink" title="PHP7 中的CSPRNG"></a>PHP7 中的CSPRNG</h3><p>PHP 7引入了两个新函数可以用来实现CSPRNG： random_bytes 和 random_int。</p>
<p>random_bytes 函数返回一个字符串，接受一个int型入参代表返回结果的字节数。</p>
<p>例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$bytes</span> = random_bytes(<span class="string">&#x27;10&#x27;</span>);</span><br><span class="line">var_dump(bin2hex(<span class="variable">$bytes</span>));</span><br><span class="line"><span class="comment">//possible ouput: string(20) &quot;7dfab0af960d359388e6&quot;</span></span><br><span class="line">random_int 函数返回一个指定范围内的<span class="keyword">int</span>型数字。</span><br></pre></td></tr></table></figure>
<p>例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var_dump(random_int(<span class="number">1</span>, <span class="number">100</span>));</span><br><span class="line"><span class="comment">//possible output: 27</span></span><br></pre></td></tr></table></figure>

<h3 id="后台运行环境"><a href="#后台运行环境" class="headerlink" title="后台运行环境"></a>后台运行环境</h3><p>以上函数的随机性不同的取决于环境：</p>
<p>在window上，CryptGenRandom()总是被使用。<br>在其他平台，arc4random_buf()如果可用会被使用（在BSD系列或者具有libbsd的系统上成立）<br>以上都不成立的话，一个linux系统调用getrandom(2)会被使用。<br>如果还不行，/dev/urandom 会被作为最后一个可使用的工具<br>如果以上都不行，系统会抛出错误<br>一个简单的测试</p>
<h3 id="PHP5-呢"><a href="#PHP5-呢" class="headerlink" title="PHP5 呢"></a>PHP5 呢</h3><p>缺省情况下，PHP5 不提供强壮的随机数发生器。实际上，还是有选择的比如 openssl_random_pseudo_bytes(), mcrypt_create_iv() 或者直接使用fread()函数来使用 /dev/random 或 /dev/urandom 设备。也有一些包比如 RandomLib 或 libsodium.</p>
<p>如果你想要开始使用一个更好的随机数发生器并且同时准备好使用PHP7，你可以使用Paragon Initiative Enterprises random_compat 库。 random_compat 库允许你在 PHP 5.x project.使用 random_bytes() and random_int()</p>
<p>这个库可以通过Composer安装：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">composer <span class="keyword">require</span> paragonie/random_compat</span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;vendor/autoload.php&#x27;</span>;</span><br><span class="line"><span class="variable">$string</span> = random_bytes(<span class="number">32</span>);</span><br><span class="line">var_dump(bin2hex(<span class="variable">$string</span>));</span><br><span class="line"><span class="comment">// string(64) &quot;8757a27ce421b3b9363b7825104f8bc8cf27c4c3036573e5f0d4a91ad2aaec6f&quot;</span></span><br><span class="line"><span class="variable">$int</span> = random_int(<span class="number">0</span>,<span class="number">255</span>);</span><br><span class="line">var_dump(<span class="variable">$int</span>);</span><br><span class="line"><span class="comment">// int(81)</span></span><br><span class="line"><span class="comment">//random_compat 库和PHP7使用不同的顺序:</span></span><br><span class="line"></span><br><span class="line">fread() /dev/urandom <span class="keyword">if</span> available</span><br><span class="line">mcrypt_create_iv(<span class="variable">$bytes</span>, MCRYPT_CREATE_IV)</span><br><span class="line">COM(<span class="string">&#x27;CAPICOM.Utilities.1&#x27;</span>)-&gt;GetRandom()</span><br><span class="line">openssl_random_pseudo_bytes()</span><br></pre></td></tr></table></figure>
<p>想知道为什么是这个顺序建议阅读 documentation.</p>
<p>这个库的一个简单应用用来产生密码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$passwordChar</span> = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line"><span class="variable">$passwordLength</span> = <span class="number">8</span>;</span><br><span class="line"><span class="variable">$max</span> = strlen(<span class="variable">$passwordChar</span>) - <span class="number">1</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$passwordLength</span>; ++<span class="variable">$i</span>) &#123;</span><br><span class="line">    <span class="variable">$password</span> .= <span class="variable">$passwordChar</span>[random_int(<span class="number">0</span>, <span class="variable">$max</span>)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$password</span>;</span><br><span class="line"><span class="comment">//possible output: 7rgG8GHu</span></span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>你总是应该使用一个密码学上安全的伪随机数生成器，random_compat 库提供了一种好的实现。</p>
<p>如果你想要使用可靠的随机数据源，如你在本文所见，建议尽快使用 random_int 和 random_bytes.</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.codeceo.com/article/php-random.html">http://www.codeceo.com/article/php-random.html</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/34/"><i class="fa fa-angle-left" aria-label="الصفحة السابقة"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/34/">34</a><span class="page-number current">35</span><a class="page-number" href="/page/36/">36</a><span class="space">&hellip;</span><a class="page-number" href="/page/38/">38</a><a class="extend next" rel="next" href="/page/36/"><i class="fa fa-angle-right" aria-label="الصفحة التالية"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lnmput@gmail.com</span>
</div>
  <div class="powered-by">تطبيق الموقع <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
