<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"swoole.app","root":"/","images":"/images","scheme":"Gemini","version":"8.7.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="要么庸俗，要么孤独">
<meta property="og:type" content="website">
<meta property="og:title" content="外贸独立站(日本)">
<meta property="og:url" content="https://swoole.app/page/7/index.html">
<meta property="og:site_name" content="外贸独立站(日本)">
<meta property="og:description" content="要么庸俗，要么孤独">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="lnmput@gmail.com">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://swoole.app/page/7/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/7/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>外贸独立站(日本)</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外贸独立站(日本)</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">专注外贸独立站建设</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-首页"><a href="/" rel="section">首页</a></li>
        <li class="menu-item menu-item-标签"><a href="/tags" rel="section">标签</a></li>
        <li class="menu-item menu-item-读书"><a href="/read" rel="section">读书</a></li>
        <li class="menu-item menu-item-翻译"><a href="/tags/translate" rel="section">翻译</a></li>
        <li class="menu-item menu-item-关于我"><a href="/about" rel="section">关于我</a></li>
        <li class="menu-item menu-item-外贸站"><a href="/site" rel="section">外贸站</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lnmput@gmail.com"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">lnmput@gmail.com</p>
  <div class="site-description" itemprop="description">要么庸俗，要么孤独</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">415</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">134</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://octobercms.com/" title="octobercms → https:&#x2F;&#x2F;octobercms.com&#x2F;" rel="noopener" target="_blank">octobercms</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://medium.com/" title="medium → https:&#x2F;&#x2F;medium.com&#x2F;" rel="noopener" target="_blank">medium</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/lnmput" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2020/03/23/golang%E5%AE%9A%E4%B9%89%E6%A0%88%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="要么庸俗，要么孤独">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外贸独立站(日本)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/23/golang%E5%AE%9A%E4%B9%89%E6%A0%88%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="post-title-link" itemprop="url">golang定义栈的数据结构</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-23 21:03:44" itemprop="dateCreated datePublished" datetime="2020-03-23T21:03:44+09:00">2020-03-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-10 13:58:30" itemprop="dateModified" datetime="2021-09-10T13:58:30+09:00">2021-09-10</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
东风夜放花千树，更吹落，星如雨。
</blockquote>

<h3 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h3><p>栈是一种操作受限制的线性表，将允许进行插入、删除的一端称为栈顶，另一端称为栈底。看到这里你可能会觉得有点绕，其实数据结构很多的定义都很抽象，这是很正常的，下面我将类比一个生活中的常见实例帮助大家理解。</p>
<p>我们在日常生活中洗盘子的时候，摞起来的盘子就是一个典型的栈结构。不管取还是放，总是要放在盘子堆的最上面操作。如果你想从一堆盘子的中间强行取一个盘子，那就有可能酿成大祸。</p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>我们在日常生活中，一摞盘子肯定有很多个而且是连续的，所以我们首先需要一个切片，并且我们日常生活中的盘子是不能无限的摞的，这点在计算机里也是同样的，计算机里也会有 Stack Overflow 的问题。 所以我们还需要一个容量的限制元素。 并且我们还需要频繁的对栈顶元素进行操作，所以我们还需要一个标记位 top 来标记栈顶元素的索引。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stack <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// 用来装元素的切片</span></span><br><span class="line">    container []<span class="keyword">int</span></span><br><span class="line">    <span class="comment">// 栈顶标记位</span></span><br><span class="line">    top <span class="keyword">int</span></span><br><span class="line">    <span class="comment">// 容量限制</span></span><br><span class="line">    size <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化时，要传入容量限制</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStack</span><span class="params">(size <span class="keyword">int</span>)</span> *<span class="title">Stack</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Stack&#123;</span><br><span class="line">        container: <span class="built_in">make</span>([]<span class="keyword">int</span>,size),</span><br><span class="line">        <span class="comment">// 栈顶指针初始可以指向-1，也可以指向0，想一想为什么。</span></span><br><span class="line">        top:       <span class="number">0</span>,</span><br><span class="line">        size:      size,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>初始化时要注意，我们这里返回的是一个 Stack 的指针，引用传递在系统中的开销比较小</p>
<h3 id="栈的基本操作"><a href="#栈的基本操作" class="headerlink" title="栈的基本操作"></a>栈的基本操作</h3><p>对于一个栈来说，其基本操作分为以下四种。</p>
<ul>
<li>Push(e E) , 将一个数据类型为 E 的元素 e 放到栈顶。</li>
<li>Pop() , 将栈顶元素取出。</li>
<li>IsFul() , 栈是否满了。</li>
<li>IsEmpty() , 栈是否空了。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stack <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// 用来装元素的切片</span></span><br><span class="line">    container []<span class="keyword">int</span></span><br><span class="line">    <span class="comment">// 栈顶标记位</span></span><br><span class="line">    top <span class="keyword">int</span></span><br><span class="line">    <span class="comment">// 容量限制</span></span><br><span class="line">    size <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化时，要传入容量限制</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStack</span><span class="params">(size <span class="keyword">int</span>)</span> <span class="title">Stack</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Stack&#123;</span><br><span class="line">        container: <span class="built_in">make</span>([]<span class="keyword">int</span>, size),</span><br><span class="line">        top:       <span class="number">0</span>,</span><br><span class="line">        size:      size,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Push</span><span class="params">(e <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.IsFull() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 把盘子摞上去</span></span><br><span class="line">    s.container[s.top] = e</span><br><span class="line">    <span class="comment">// 下一个能摞盘子的位置</span></span><br><span class="line">    s.top++</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Pop</span><span class="params">()</span> <span class="params">(flag <span class="keyword">bool</span>, ret <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 如果栈空了，你就无法拿到新盘子，所以flag此时为false</span></span><br><span class="line">    <span class="keyword">if</span> s.IsEmpty() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>, ret</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 取出盘子</span></span><br><span class="line">    ret = s.container[s.top<span class="number">-1</span>]</span><br><span class="line">    <span class="comment">// 下一个能取盘子的位置</span></span><br><span class="line">    s.top--</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>, ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">IsEmpty</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.top == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">IsFull</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.top == s.size &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    stack := NewStack(<span class="number">3</span>)</span><br><span class="line">    <span class="comment">// 先测试栈为空的时候能否Pop</span></span><br><span class="line">    fmt.Println(stack.Pop())</span><br><span class="line">    <span class="comment">// 测试Push是否正常</span></span><br><span class="line">    stack.Push(<span class="number">1</span>)</span><br><span class="line">    stack.Push(<span class="number">2</span>)</span><br><span class="line">    stack.Push(<span class="number">3</span>)</span><br><span class="line">    <span class="comment">// 如果栈为正常的，这里Pop打印顺序应该是3,2,1</span></span><br><span class="line">    fmt.Println(stack.Pop())</span><br><span class="line">    fmt.Println(stack.Pop())</span><br><span class="line">    fmt.Println(stack.Pop())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="栈的常见应用"><a href="#栈的常见应用" class="headerlink" title="栈的常见应用"></a>栈的常见应用</h3><h4 id="浏览器中的前进后退"><a href="#浏览器中的前进后退" class="headerlink" title="浏览器中的前进后退"></a>浏览器中的前进后退</h4><p>假设你现在是 N 年前的 Chrome 浏览器工程师， 你现在很苦恼，有的网页在打开下一个页面后就回不去上一级了，你现在急迫的想要一个后退的功能，请问要怎么样实现呢？</p>
<p>仔细分析之后不难发现，所谓的后退，撤销等操作，其实就是一个栈的 Pop 操作，我们每次点击的网址, 或者进行的操作，都是被程序 Push 到了一个栈中，所以一旦我们点击撤销或后退时，总是可以返回我们最近一次的操作。这就是栈的最广泛的应用。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stack <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// 用来装元素的切片</span></span><br><span class="line">    container []<span class="keyword">string</span></span><br><span class="line">    <span class="comment">// 栈顶标记位</span></span><br><span class="line">    top <span class="keyword">int</span></span><br><span class="line">    <span class="comment">// 容量限制</span></span><br><span class="line">    size <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化时，要传入容量限制</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStack</span><span class="params">(size <span class="keyword">int</span>)</span> <span class="title">Stack</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Stack&#123;</span><br><span class="line">        container: <span class="built_in">make</span>([]<span class="keyword">string</span>, size),</span><br><span class="line">        top:       <span class="number">0</span>,</span><br><span class="line">        size:      size,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Push</span><span class="params">(e <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.IsFull() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    s.container[s.top] = e</span><br><span class="line">    s.top++</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Pop</span><span class="params">()</span> <span class="params">(flag <span class="keyword">bool</span>, ret <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 如果栈是空的，那么就不能继续 Pop 了</span></span><br><span class="line">    <span class="keyword">if</span> s.IsEmpty() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>, ret</span><br><span class="line">    &#125;</span><br><span class="line">    ret = s.container[s.top<span class="number">-1</span>]</span><br><span class="line">    s.top--</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>, ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">IsEmpty</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.top == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">IsFull</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.top == s.size &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    back := NewStack(<span class="number">3</span>)</span><br><span class="line">    <span class="comment">// 模拟每次点击网页时，浏览器会自push你的网址到栈中</span></span><br><span class="line">    back.Push(<span class="string">&quot;www.baidu.com&quot;</span>)</span><br><span class="line">    back.Push(<span class="string">&quot;www.bing.com&quot;</span>)</span><br><span class="line">    back.Push(<span class="string">&quot;www.goole.com&quot;</span>)</span><br><span class="line">    <span class="comment">// 每次点击后退时，就相当于是从栈中Pop了一个网址</span></span><br><span class="line">    fmt.Println(back.Pop())</span><br><span class="line">    fmt.Println(back.Pop())</span><br><span class="line">    fmt.Println(back.Pop())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="括号匹配"><a href="#括号匹配" class="headerlink" title="括号匹配"></a>括号匹配</h4><p>在现代的 IDE 中，我们的编辑器环境是十分智能的,我少打了一个括号，IDE 就自动给我画了一条红线。是不是非常的神奇。其实这个功能也是用栈实现的。下面来说一下思路：<br>若遇到左括号入栈，遇到右括号时将栈顶左括号出栈，则遍历完所有括号后 stack 仍然为空；如果遍历之后 stack 不为空，那么说明有多余的左括号。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stack <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// 用来装元素的切片</span></span><br><span class="line">    container []<span class="keyword">byte</span></span><br><span class="line">    <span class="comment">// 栈顶标记位</span></span><br><span class="line">    top <span class="keyword">int</span></span><br><span class="line">    <span class="comment">// 容量限制</span></span><br><span class="line">    size <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化时，要传入容量限制</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStack</span><span class="params">(size <span class="keyword">int</span>)</span> <span class="title">Stack</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Stack&#123;</span><br><span class="line">        container: <span class="built_in">make</span>([]<span class="keyword">byte</span>,size),</span><br><span class="line">        top:       <span class="number">0</span>,</span><br><span class="line">        size:      size,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Push</span> <span class="params">(e <span class="keyword">byte</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.IsFull() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    s.container[s.top] = e</span><br><span class="line">    s.top++</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Pop</span> <span class="params">()</span> <span class="params">(flag <span class="keyword">bool</span>,ret <span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 如果栈是空的，那么就不能继续 Pop 了</span></span><br><span class="line">    <span class="keyword">if</span> s.IsEmpty() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>,ret</span><br><span class="line">    &#125;</span><br><span class="line">    ret = s.container[s.top<span class="number">-1</span>]</span><br><span class="line">    s.top--</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>,ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">IsEmpty</span> <span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.top == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">IsFull</span> <span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.top == s.size &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsValid</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    stack := NewStack(<span class="number">100</span>)</span><br><span class="line">    <span class="comment">// 遍历括号字符串</span></span><br><span class="line">    <span class="keyword">for</span> _,v := <span class="keyword">range</span> s &#123;</span><br><span class="line">        <span class="keyword">if</span> v == <span class="string">&#x27;(&#x27;</span> &#123;</span><br><span class="line">            <span class="comment">// 由于golang中的字符串默认是unicode编码，所以我们要做一个强制类型转换</span></span><br><span class="line">            stack.Push(<span class="keyword">byte</span>(v))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> v == <span class="string">&#x27;)&#x27;</span> &#123;</span><br><span class="line">            <span class="comment">// 如果flag不为true，说明栈已经到底了，可以直返回false</span></span><br><span class="line">            <span class="keyword">if</span> flag,top := stack.Pop(); flag == <span class="literal">true</span> &amp;&amp;top == <span class="string">&#x27;(&#x27;</span> &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 字符串遍历完后如果栈也空了，说明括号匹配</span></span><br><span class="line">    <span class="keyword">if</span> stack.IsEmpty() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果栈不空，说明栈里还有多余的左括号</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    test1 := <span class="string">&quot;()()())&quot;</span></span><br><span class="line">    test2 := <span class="string">&quot;((()&quot;</span></span><br><span class="line">    test3 := <span class="string">&quot;()()()()&quot;</span></span><br><span class="line">    fmt.Println(IsValid(test1))</span><br><span class="line">    fmt.Println(IsValid(test2))</span><br><span class="line">    fmt.Println(IsValid(test3))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2020/03/22/go%E8%AF%AD%E8%A8%80%E5%B0%86interface%E5%8F%98%E9%87%8F%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%9B%BA%E5%AE%9A%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="要么庸俗，要么孤独">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外贸独立站(日本)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/22/go%E8%AF%AD%E8%A8%80%E5%B0%86interface%E5%8F%98%E9%87%8F%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%9B%BA%E5%AE%9A%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0/" class="post-title-link" itemprop="url">go语言将interface变量转换为固定类型的参数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-22 23:35:53" itemprop="dateCreated datePublished" datetime="2020-03-22T23:35:53+09:00">2020-03-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-10 13:55:05" itemprop="dateModified" datetime="2021-09-10T13:55:05+09:00">2021-09-10</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
终有一天 我有属于我的天
</blockquote>

<p>Goのプログラミングでは、どんな型の引数でも受け取れる関数を作るのにinterface{}を使います。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">v</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span>&#123;</span><br><span class="line">  fmt.Println(x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// v(1)     =&gt; 1</span></span><br><span class="line"><span class="comment">// v(&quot;abc&quot;) =&gt; abc</span></span><br></pre></td></tr></table></figure>
<p>しかし、interface{}型な変数を、たとえばintを引数にとる関数に渡すと、エラーになります。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x <span class="keyword">interface</span>&#123;&#125; = <span class="number">1</span></span><br><span class="line">  fmt.Println( add2(x) )</span><br><span class="line">  <span class="comment">//=&gt; cannot use x (type interface &#123;&#125;) as type int in argument to add2: need type assertion</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add2</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> n + <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>このようなことをしたい場合は、castするか、switch式を使うことで、型を変換して関数に渡すことができます。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x <span class="keyword">interface</span>&#123;&#125; = <span class="number">1</span></span><br><span class="line">  <span class="keyword">var</span> y <span class="keyword">interface</span>&#123;&#125; = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// cast</span></span><br><span class="line">  <span class="keyword">if</span> xi, ok := x.(<span class="keyword">int</span>); ok&#123;</span><br><span class="line">    fmt.Println( add2(xi) ) <span class="comment">//=&gt; 3</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//switch</span></span><br><span class="line">  <span class="keyword">switch</span> yi := y.(<span class="keyword">type</span>)&#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="keyword">int</span>:</span><br><span class="line">    <span class="comment">// ここに入ってきた時は、yiの型はintとして扱われる</span></span><br><span class="line">    fmt.Println( add2(yi) ) <span class="comment">//=&gt; 5</span></span><br><span class="line">  <span class="keyword">case</span> <span class="keyword">int64</span>, <span class="keyword">int32</span>, <span class="keyword">int8</span>:</span><br><span class="line">    <span class="comment">// ここに入ってきた時は、yiの型はint64, int32, int8のうち適切な型が選ばれている</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add2</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> n + <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>パッケージ的なものを自作していると、</p>
<ul>
<li>どんな型の変数も渡せる</li>
<li>特定の型の関数を渡せる</li>
</ul>
<p>ような関数が欲しくなることがあります。具体的には以下のように使える関数です</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exec</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  v <span class="keyword">interface</span>&#123;&#125;, // value</span></span></span><br><span class="line"><span class="params"><span class="function">  f <span class="keyword">interface</span>&#123;&#125;, // valueを引数に実行する<span class="keyword">func</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">  fv := reflect.ValueOf(f)</span><br><span class="line">  <span class="keyword">if</span> fv.Kind() != reflect.Func&#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;2&#x27;nd argument is not func.&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  rv := reflect.ValueOf(v)</span><br><span class="line">  <span class="keyword">return</span> fv.Call([]reflect.Value&#123;rv&#125;)[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//　以下のように使える</span></span><br><span class="line">exec(<span class="number">5</span>, <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">int</span></span>&#123; <span class="keyword">return</span> i * ( i + <span class="number">1</span>) &#125;)</span><br><span class="line">exec(<span class="string">&quot;Tom&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span>&#123; <span class="keyword">return</span> <span class="string">&quot;hello! &quot;</span> + s &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一引数と、第二引数の引数の型が違うと、buildはできるが実行時にエラーが起きる</span></span><br><span class="line">exec(<span class="string">&quot;Tom&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">int</span></span>&#123; <span class="keyword">return</span> i * ( i + <span class="number">1</span>) &#125;)</span><br></pre></td></tr></table></figure>
<p>build時に、エラーを出してほしいのですが、なかなかそうもいかない…</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://qiita.com/umanoda/items/07887d33ef1155b26ed2">https://qiita.com/umanoda/items/07887d33ef1155b26ed2</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2020/03/22/golang%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="要么庸俗，要么孤独">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外贸独立站(日本)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/22/golang%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">golang字符串相关处理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-22 23:05:09" itemprop="dateCreated datePublished" datetime="2020-03-22T23:05:09+09:00">2020-03-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-10 13:56:47" itemprop="dateModified" datetime="2021-09-10T13:56:47+09:00">2021-09-10</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
琴声何在 生死难猜 用一生去等待
</blockquote>

<h3 id="文字列を結合する"><a href="#文字列を結合する" class="headerlink" title="文字列を結合する"></a>文字列を結合する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := <span class="string">&quot;Hello&quot;</span></span><br><span class="line">    b := a + <span class="string">&quot; World&quot;</span></span><br><span class="line">    fmt.Println(b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="繰り返し文字列を生成する"><a href="#繰り返し文字列を生成する" class="headerlink" title="繰り返し文字列を生成する"></a>繰り返し文字列を生成する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;Hey &quot;</span></span><br><span class="line">    fmt.Println(strings.Repeat(s, <span class="number">3</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="大文字・小文字に揃える"><a href="#大文字・小文字に揃える" class="headerlink" title="大文字・小文字に揃える"></a>大文字・小文字に揃える</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;I love GoLang&quot;</span></span><br><span class="line">    fmt.Println(strings.ToUpper(s))</span><br><span class="line">    fmt.Println(strings.ToLower(s))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="大文字と小文字の入れ替え"><a href="#大文字と小文字の入れ替え" class="headerlink" title="大文字と小文字の入れ替え"></a>大文字と小文字の入れ替え</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//うーん、かなりイマイチ</span></span><br><span class="line">    s := <span class="string">&quot;i lOVE gOLANG&quot;</span></span><br><span class="line">    sr := <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> _, x := <span class="keyword">range</span> s &#123;</span><br><span class="line">        xs := <span class="keyword">string</span>(x)</span><br><span class="line">        u := strings.ToUpper(xs)</span><br><span class="line">        l := strings.ToLower(xs)</span><br><span class="line">        <span class="keyword">if</span> u == xs &#123;</span><br><span class="line">            sr += l</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> l == xs &#123;</span><br><span class="line">            sr += u</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sr += xs</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(sr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="コマンドの実行結果を文字列に"><a href="#コマンドの実行結果を文字列に" class="headerlink" title="コマンドの実行結果を文字列に"></a>コマンドの実行結果を文字列に</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;os/exec&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    out, _ := exec.Command(<span class="string">&quot;date&quot;</span>).Output()</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(out))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="複数行の文字列を作成する"><a href="#複数行の文字列を作成する" class="headerlink" title="複数行の文字列を作成する"></a>複数行の文字列を作成する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">`</span></span><br><span class="line"><span class="string">    This is a test.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    GoLang, programming language developed at Google.</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ヒアドキュメントの終端文字列をインデントする"><a href="#ヒアドキュメントの終端文字列をインデントする" class="headerlink" title="ヒアドキュメントの終端文字列をインデントする"></a>ヒアドキュメントの終端文字列をインデントする</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;github.com/MakeNowJust/heredoc/dot&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := D(<span class="string">`</span></span><br><span class="line"><span class="string">    This is a test.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    GoLang, programming language developed at Google.   </span></span><br><span class="line"><span class="string">    `</span>)</span><br><span class="line">    fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="複数行のコマンドの実行結果を文字列に設定する"><a href="#複数行のコマンドの実行結果を文字列に設定する" class="headerlink" title="複数行のコマンドの実行結果を文字列に設定する"></a>複数行のコマンドの実行結果を文字列に設定する</h3><p>exec.Command()を使います。 (echoはシェル組み込みコマンドのせいか実行されない。。)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;os/exec&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := D(<span class="string">`</span></span><br><span class="line"><span class="string">    date</span></span><br><span class="line"><span class="string">    echo &quot;-----------------------------&quot;</span></span><br><span class="line"><span class="string">    ps</span></span><br><span class="line"><span class="string">    `</span>)</span><br><span class="line">    outs := <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> _, s = <span class="keyword">range</span> strings.Split(s, <span class="string">&quot;\n&quot;</span>) &#123;</span><br><span class="line">        out, _ := exec.Command(s).Output()</span><br><span class="line">        outs += <span class="keyword">string</span>(out)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(outs)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="部分文字列を取り出す"><a href="#部分文字列を取り出す" class="headerlink" title="部分文字列を取り出す"></a>部分文字列を取り出す</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;Apple Banana Orange&quot;</span></span><br><span class="line">    fmt.Println(s[<span class="number">0</span>:<span class="number">5</span>])       <span class="comment">// =&gt; Apple</span></span><br><span class="line">    fmt.Println(s[<span class="number">6</span>:(<span class="number">6</span> + <span class="number">6</span>)]) <span class="comment">// =&gt; Banana</span></span><br><span class="line">    fmt.Println(s[<span class="number">0</span>:<span class="number">3</span>])       <span class="comment">// =&gt; App</span></span><br><span class="line">    fmt.Println(s[<span class="number">6</span>])         <span class="comment">// =&gt; 66</span></span><br><span class="line">    fmt.Println(s[<span class="number">13</span>:<span class="number">19</span>])     <span class="comment">// =&gt; Orange</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="部分文字列を置き換える"><a href="#部分文字列を置き換える" class="headerlink" title="部分文字列を置き換える"></a>部分文字列を置き換える</h3><p>(うーんいまいち。。)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;Apple Banana Orange&quot;</span></span><br><span class="line">    ss := strings.Split(s, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    srep := strings.Split(<span class="string">&quot;Vine &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i, _ := <span class="keyword">range</span> srep &#123;</span><br><span class="line">        ss[i] = srep[i]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(strings.Join(ss, <span class="string">&quot;&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文字列中の式を評価し値を展開する"><a href="#文字列中の式を評価し値を展開する" class="headerlink" title="文字列中の式を評価し値を展開する"></a>文字列中の式を評価し値を展開する</h3><p>intなら%dでもよいですが、型推定をよさげに行うのなら%vが使えます。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    value := <span class="number">123</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;value is %v\n&quot;</span>, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文字列を1文字ずつ処理する"><a href="#文字列を1文字ずつ処理する" class="headerlink" title="文字列を1文字ずつ処理する"></a>文字列を1文字ずつ処理する</h3><p>こちらによると、 string[n]だとbyte単位、rangeで回すとrune(utf-8文字)単位らしいです。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    sum := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, c := <span class="keyword">range</span> <span class="string">&quot;Golang&quot;</span> &#123;</span><br><span class="line">        sum = sum + <span class="keyword">int</span>(c)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(sum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文字列の先頭と末尾の空白文字を削除する"><a href="#文字列の先頭と末尾の空白文字を削除する" class="headerlink" title="文字列の先頭と末尾の空白文字を削除する"></a>文字列の先頭と末尾の空白文字を削除する</h3><p>空白ならTrimSpace, 任意の文字でやりたければTrimでやれます。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;   Hello, Golang!   &quot;</span></span><br><span class="line">    s = strings.TrimSpace(s)</span><br><span class="line">    fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文字列を整数に変換する-to-i"><a href="#文字列を整数に変換する-to-i" class="headerlink" title="文字列を整数に変換する (to_i)"></a>文字列を整数に変換する (to_i)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strconv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    i := <span class="number">1</span></span><br><span class="line">    s := <span class="string">&quot;999&quot;</span></span><br><span class="line">    si, _ := strconv.Atoi(s)</span><br><span class="line">    i = i + si</span><br><span class="line">    fmt.Println(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文字列を浮動小数点に変換する-to-f"><a href="#文字列を浮動小数点に変換する-to-f" class="headerlink" title="文字列を浮動小数点に変換する (to_f)"></a>文字列を浮動小数点に変換する (to_f)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strconv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;10&quot;</span></span><br><span class="line">    sf, _ := strconv.ParseFloat(s, <span class="number">64</span>) <span class="comment">//64 bit float</span></span><br><span class="line">    fmt.Println(sf)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8進文字列を整数に変換する"><a href="#8進文字列を整数に変換する" class="headerlink" title="8進文字列を整数に変換する"></a>8進文字列を整数に変換する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strconv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;010&quot;</span></span><br><span class="line">    so, _ := strconv.ParseInt(s, <span class="number">8</span>, <span class="number">64</span>) <span class="comment">// base 8, 64bit</span></span><br><span class="line">    fmt.Println(so)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="16進文字列を整数に変換する"><a href="#16進文字列を整数に変換する" class="headerlink" title="16進文字列を整数に変換する"></a>16進文字列を整数に変換する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strconv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;ff&quot;</span> <span class="comment">// 0xは含んではいけません。</span></span><br><span class="line">    sh, _ := strconv.ParseInt(s, <span class="number">16</span>, <span class="number">64</span>)</span><br><span class="line">    fmt.Println(sh)</span><br><span class="line"></span><br><span class="line">    s = <span class="string">&quot;0xff&quot;</span> <span class="comment">// 0xを含んでも良い</span></span><br><span class="line">    sh, _ = strconv.ParseInt(s, <span class="number">0</span>, <span class="number">64</span>)</span><br><span class="line">    fmt.Println(sh)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ASCII文字をコード値に（コード値をASCII文字に）変換する"><a href="#ASCII文字をコード値に（コード値をASCII文字に）変換する" class="headerlink" title="ASCII文字をコード値に（コード値をASCII文字に）変換する"></a>ASCII文字をコード値に（コード値をASCII文字に）変換する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;ABC&quot;</span></span><br><span class="line">    fmt.Println(s[<span class="number">0</span>])</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(<span class="number">82</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`		</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### 文字列を中央寄せ・左詰・右詰する</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//右詰、左詰めはformat文字列が対応しています。±で指定。</span></span><br><span class="line">    s := <span class="string">&quot;Go&quot;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%10s\n&quot;</span>, s)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%-10s\n&quot;</span>, s)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//センタリングはなさそうです。</span></span><br><span class="line">    l := <span class="number">10</span></span><br><span class="line">    ls := (l - <span class="built_in">len</span>(s)) / <span class="number">2</span></span><br><span class="line">    cs := strings.Repeat(<span class="string">&quot; &quot;</span>, ls) + s + strings.Repeat(<span class="string">&quot; &quot;</span>, l-(ls+<span class="built_in">len</span>(s)))</span><br><span class="line">    fmt.Println(cs)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="“次”の文字列を取得する"><a href="#“次”の文字列を取得する" class="headerlink" title="“次”の文字列を取得する"></a>“次”の文字列を取得する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(succ(<span class="string">&quot;9&quot;</span>))    <span class="comment">// =&gt; &quot;10&quot;</span></span><br><span class="line">    fmt.Println(succ(<span class="string">&quot;a&quot;</span>))    <span class="comment">// =&gt; &quot;b&quot;</span></span><br><span class="line">    fmt.Println(succ(<span class="string">&quot;AAA&quot;</span>))  <span class="comment">// =&gt; &quot;AAB&quot;</span></span><br><span class="line">    fmt.Println(succ(<span class="string">&quot;A99&quot;</span>))  <span class="comment">// =&gt; &quot;B00&quot;</span></span><br><span class="line">    fmt.Println(succ(<span class="string">&quot;A099&quot;</span>)) <span class="comment">// =&gt; &quot;A100&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文字列を反転して返す</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverse</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    ans := <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i, _ := <span class="keyword">range</span> s &#123;</span><br><span class="line">        ans += <span class="keyword">string</span>(s[<span class="built_in">len</span>(s)-i<span class="number">-1</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">string</span>(ans)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;次&quot;の文字列を取得する</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">succ</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    r := reverse(s)</span><br><span class="line">    ans := <span class="string">&quot;&quot;</span></span><br><span class="line">    carry := <span class="number">1</span></span><br><span class="line">    lastLetter := <span class="keyword">string</span>(r[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> i, _ := <span class="keyword">range</span> r &#123;</span><br><span class="line">        lastLetter = <span class="keyword">string</span>(r[i])</span><br><span class="line">        a := lastLetter</span><br><span class="line">        <span class="keyword">if</span> carry == <span class="number">1</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> lastLetter == <span class="string">&quot;z&quot;</span> &#123;</span><br><span class="line">                a = <span class="string">&quot;a&quot;</span></span><br><span class="line">                carry = <span class="number">1</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> lastLetter == <span class="string">&quot;Z&quot;</span> &#123;</span><br><span class="line">                a = <span class="string">&quot;A&quot;</span></span><br><span class="line">                carry = <span class="number">1</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> lastLetter == <span class="string">&quot;9&quot;</span> &#123;</span><br><span class="line">                a = <span class="string">&quot;0&quot;</span></span><br><span class="line">                carry = <span class="number">1</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> r[i] == <span class="number">0</span> &#123;</span><br><span class="line">                    a = <span class="string">&quot;1&quot;</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    a = <span class="keyword">string</span>(r[i] + <span class="number">1</span>)</span><br><span class="line">                    carry = <span class="number">0</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ans += a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> carry == <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> lastLetter == <span class="string">&quot;9&quot;</span> &#123;</span><br><span class="line">            ans += <span class="string">&quot;1&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> lastLetter == <span class="string">&quot;z&quot;</span> &#123;</span><br><span class="line">            ans += <span class="string">&quot;a&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> lastLetter == <span class="string">&quot;Z&quot;</span> &#123;</span><br><span class="line">            ans += <span class="string">&quot;A&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> reverse(ans)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文字列を暗号化する"><a href="#文字列を暗号化する" class="headerlink" title="文字列を暗号化する"></a>文字列を暗号化する</h3><p>とりあえずMD5あたりの例を書いておきます。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span>     <span class="string">&quot;crypto/md5&quot;</span></span><br><span class="line"><span class="keyword">import</span>     <span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="keyword">import</span>     <span class="string">&quot;bufio&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    h := md5.New()</span><br><span class="line">    io.WriteString(h, <span class="string">&quot;hogehoge&quot;</span>)</span><br><span class="line"></span><br><span class="line">    fmt.Print(<span class="string">&quot;input password &gt;&quot;</span>)</span><br><span class="line">    scanner := bufio.NewScanner(os.Stdin)</span><br><span class="line">    scanner.Scan()</span><br><span class="line"></span><br><span class="line">    h2 := md5.New()</span><br><span class="line">    io.WriteString(h2, scanner.Text())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> h2.Sum(<span class="literal">nil</span>)[<span class="number">0</span>] == h.Sum(<span class="literal">nil</span>)[<span class="number">0</span>] &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;right&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;wrong&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文字列中で指定したパターンにマッチする部分を置換する"><a href="#文字列中で指定したパターンにマッチする部分を置換する" class="headerlink" title="文字列中で指定したパターンにマッチする部分を置換する"></a>文字列中で指定したパターンにマッチする部分を置換する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;Apple Banana Apple Orange&quot;</span></span><br><span class="line">    s = strings.Replace(s, <span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Pine&quot;</span>, <span class="number">1</span>) <span class="comment">// 最後の引数は回数</span></span><br><span class="line">    fmt.Println(s)</span><br><span class="line">    s = strings.Replace(s, <span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Pine&quot;</span>, <span class="number">-1</span>) <span class="comment">// &lt;0で無制限</span></span><br><span class="line">    fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文字列中に含まれている任意文字列の位置を求める"><a href="#文字列中に含まれている任意文字列の位置を求める" class="headerlink" title="文字列中に含まれている任意文字列の位置を求める"></a>文字列中に含まれている任意文字列の位置を求める</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;Apple Banana Apple Orange&quot;</span></span><br><span class="line">    fmt.Println(strings.Index(s, <span class="string">&quot;Apple&quot;</span>))  <span class="comment">// =&gt; 0</span></span><br><span class="line">    fmt.Println(strings.Index(s, <span class="string">&quot;Banana&quot;</span>)) <span class="comment">// =&gt; 6</span></span><br><span class="line">    <span class="comment">// 途中から検索する方法は無いのでスライスで渡す</span></span><br><span class="line">    fmt.Println(strings.Index(s[<span class="number">6</span>:], <span class="string">&quot;Apple&quot;</span>) + <span class="number">6</span>) <span class="comment">// =&gt; 13</span></span><br><span class="line">    <span class="comment">// 後方検索はLastIndex()</span></span><br><span class="line">    fmt.Println(strings.LastIndex(s, <span class="string">&quot;Apple&quot;</span>))          <span class="comment">// =&gt; 13</span></span><br><span class="line">    fmt.Println(strings.Index(s[:(<span class="built_in">len</span>(s)<span class="number">-6</span>)], <span class="string">&quot;Apple&quot;</span>)) <span class="comment">// =&gt; 0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文字列の末端の改行を削除する"><a href="#文字列の末端の改行を削除する" class="headerlink" title="文字列の末端の改行を削除する"></a>文字列の末端の改行を削除する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;Hello, Golang!\n&quot;</span></span><br><span class="line">    s = strings.TrimRight(s, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="カンマ区切りの文字列を扱う"><a href="#カンマ区切りの文字列を扱う" class="headerlink" title="カンマ区切りの文字列を扱う"></a>カンマ区切りの文字列を扱う</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    s := <span class="string">&quot;001,ASHITANI Tatsuji,Yokohama&quot;</span></span><br><span class="line">    slice := strings.Split(s, <span class="string">&quot;,&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> _, x := <span class="keyword">range</span> slice &#123;</span><br><span class="line">        fmt.Println(x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="任意のパターンにマッチするものを全て抜き出す"><a href="#任意のパターンにマッチするものを全て抜き出す" class="headerlink" title="任意のパターンにマッチするものを全て抜き出す"></a>任意のパターンにマッチするものを全て抜き出す</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;regexp&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;hoge:045-111-2222 boke:045-222-2222&quot;</span></span><br><span class="line">    re, _ := regexp.Compile(<span class="string">&quot;(\\S+):([\\d\\-]+)&quot;</span>)</span><br><span class="line">    ans := re.FindAllStringSubmatch(s, <span class="number">-1</span>) <span class="comment">// [マッチした全体,１個目のカッコ,２個目のカッコ,..]の配列</span></span><br><span class="line">    fmt.Println(ans)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="漢字コードを変換する"><a href="#漢字コードを変換する" class="headerlink" title="漢字コードを変換する"></a>漢字コードを変換する</h3><p>下記はEUCの例です。 指定するコーディングは、EUCJP,ISO2022JP,ShiftJISのどれかです。<br>こちらでご指摘いただいた点を 修正しました。’EUCJP’は’japanese.EUCJP’と呼びます。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;golang.org/x/text/encoding/japanese&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;golang.org/x/text/transform&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;bytes&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    KconvFwrite()     <span class="comment">// ファイル書き込み</span></span><br><span class="line">    KconvFread()      <span class="comment">// ファイル読み出し</span></span><br><span class="line">    KconvToBuffer()   <span class="comment">// バッファに書き込み</span></span><br><span class="line">    KconvFromBuffer() <span class="comment">// バッファから読み出し</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ファイル書き込み</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">KconvFwrite</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;漢字です&quot;</span> <span class="comment">// UTF8</span></span><br><span class="line">    f, _ := os.Create(<span class="string">&quot;EUC.txt&quot;</span>)</span><br><span class="line">    r := strings.NewReader(s)</span><br><span class="line">    w := transform.NewWriter(f, japanese.EUCJP.NewEncoder()) <span class="comment">// Encoder-&gt;f</span></span><br><span class="line">    io.Copy(w, r)                                            <span class="comment">// r -&gt; w(-&gt;Encoder-&gt;f)</span></span><br><span class="line">    f.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ファイル読み出し</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">KconvFread</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f, _ := os.Open(<span class="string">&quot;EUC.txt&quot;</span>)</span><br><span class="line">    b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">    r := transform.NewReader(f, japanese.EUCJP.NewDecoder()) <span class="comment">// f -&gt; Decoder</span></span><br><span class="line">    io.Copy(b, r)                                            <span class="comment">// (f-&gt;Decoder)-&gt;b</span></span><br><span class="line">    fmt.Println(b.String())</span><br><span class="line">    f.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// バッファに書き込み</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">KconvToBuffer</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;漢字です&quot;</span> <span class="comment">// UTF8</span></span><br><span class="line">    b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">    r := strings.NewReader(s)</span><br><span class="line">    w := transform.NewWriter(b, japanese.EUCJP.NewEncoder()) <span class="comment">// Encoder-&gt;f</span></span><br><span class="line">    io.Copy(w, r)                                            <span class="comment">// r -&gt; w(-&gt;Encoder-&gt;f)</span></span><br><span class="line"></span><br><span class="line">    st := b.String()</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(st); i++ &#123;</span><br><span class="line">        fmt.Println(st[i])</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(b.String())</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// バッファから読み出し</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">KconvFromBuffer</span><span class="params">()</span></span> &#123;</span><br><span class="line">    str_bytes := []<span class="keyword">byte</span>&#123;<span class="number">180</span>, <span class="number">193</span>, <span class="number">187</span>, <span class="number">250</span>, <span class="number">164</span>, <span class="number">199</span>, <span class="number">164</span>, <span class="number">185</span>&#125;</span><br><span class="line">    s := bytes.NewBuffer(str_bytes).String() <span class="comment">// &quot;漢字です&quot; in EUC</span></span><br><span class="line"></span><br><span class="line">    sr := strings.NewReader(s)</span><br><span class="line">    b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">    r := transform.NewReader(sr, japanese.EUCJP.NewDecoder()) <span class="comment">// sr -&gt; Decoder</span></span><br><span class="line">    io.Copy(b, r)                                             <span class="comment">// (sr-&gt;Decoder)-&gt;b</span></span><br><span class="line">    fmt.Println(b.String())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="マルチバイト文字の数を数える"><a href="#マルチバイト文字の数を数える" class="headerlink" title="マルチバイト文字の数を数える"></a>マルチバイト文字の数を数える</h3><p>こちらが詳しいです。 len()だとbyteカウント、[]runeに変換するとutf-8カウント。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;日本語&quot;</span></span><br><span class="line">    fmt.Println(<span class="built_in">len</span>(s))         <span class="comment">// =&gt; 9</span></span><br><span class="line">    fmt.Println(<span class="built_in">len</span>([]<span class="keyword">rune</span>(s))) <span class="comment">// =&gt; 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="マルチバイト文字列の最後の1文字を削除する"><a href="#マルチバイト文字列の最後の1文字を削除する" class="headerlink" title="マルチバイト文字列の最後の1文字を削除する"></a>マルチバイト文字列の最後の1文字を削除する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;日本語&quot;</span></span><br><span class="line">    sc := []<span class="keyword">rune</span>(s)</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(sc[:(<span class="built_in">len</span>(sc) - <span class="number">1</span>)])) <span class="comment">// =&gt; &quot;日本&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://ashitani.jp/golangtips/tips_string.html#string_Split">https://ashitani.jp/golangtips/tips_string.html#string_Split</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2020/03/16/go%E8%AF%BB%E5%86%99csv%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="要么庸俗，要么孤独">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外贸独立站(日本)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/16/go%E8%AF%BB%E5%86%99csv%E6%96%87%E4%BB%B6/" class="post-title-link" itemprop="url">go读写csv文件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-16 21:18:44" itemprop="dateCreated datePublished" datetime="2020-03-16T21:18:44+09:00">2020-03-16</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-10 13:55:00" itemprop="dateModified" datetime="2021-09-10T13:55:00+09:00">2021-09-10</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
我害怕，看到你，独自一人绝望；
更害怕，看不到你，不能和你一起迷惘……
</blockquote>

<p>go言語の encoding/csv パッケージの使い方。<br>CSVファイルの読み書きと、オプション、エラーハンドリングについて書いてます。</p>
<h3 id="一行ずつ読み込む-Read"><a href="#一行ずつ読み込む-Read" class="headerlink" title="一行ずつ読み込む(Read)"></a>一行ずつ読み込む(Read)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/csv&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;io&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">`名前,年齢,身長,体重</span></span><br><span class="line"><span class="string">Tanaka,31,190cm,97kg</span></span><br><span class="line"><span class="string">Suzuki,46,180cm,79kg</span></span><br><span class="line"><span class="string">Matsui,45,188cm,95kg</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">    r := csv.NewReader(strings.NewReader(s))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        record, err := r.Read()</span><br><span class="line">        <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Fatal(err)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// recordは配列</span></span><br><span class="line">        fmt.Printf(<span class="string">&quot;%#v\n&quot;</span>, record)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// []string&#123;&quot;名前&quot;, &quot;年齢&quot;, &quot;身長&quot;, &quot;体重&quot;&#125;</span></span><br><span class="line">        <span class="comment">// []string&#123;&quot;Tanaka&quot;, &quot;31&quot;, &quot;190cm&quot;, &quot;97kg&quot;&#125;</span></span><br><span class="line">        <span class="comment">// []string&#123;&quot;Suzuki&quot;, &quot;46&quot;, &quot;180cm&quot;, &quot;79kg&quot;&#125;</span></span><br><span class="line">        <span class="comment">// []string&#123;&quot;Matsui&quot;, &quot;45&quot;, &quot;188cm&quot;, &quot;95kg&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ファイルから読み込む"><a href="#ファイルから読み込む" class="headerlink" title="ファイルから読み込む"></a>ファイルから読み込む</h3><p>ファイルから読み込む場合は <code>csv.NewReader</code> に <code>*os.File</code> を渡す</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/csv&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f, err := os.Open(<span class="string">&quot;file.csv&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r := csv.NewReader(f)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        record, err := r.Read()</span><br><span class="line">        <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Fatal(err)</span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Println(record)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="csv-Readerのオプション"><a href="#csv-Readerのオプション" class="headerlink" title="csv.Readerのオプション"></a>csv.Readerのオプション</h3><blockquote>
<p>Comma: 区切り文字を変更<br>Comment: コメント行の先頭になる文字を指定<br>FieldsPerRecord: 各行のフィールド数を指定<br>LazyQuotes: ダブルクオートを厳密にチェックするかどうか<br>TrimLeadingSpace: 先頭の空白文字を無視する<br>ReuseRecord: スライスの再利用<br>TrailingComma: Deprecated(非推奨)</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/csv&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;io&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">`名前;年齢;身長;体重</span></span><br><span class="line"><span class="string"># コメント行</span></span><br><span class="line"><span class="string">Tanaka;31;190cm;97kg</span></span><br><span class="line"><span class="string"># コメント行</span></span><br><span class="line"><span class="string">Suzuki;46;180cm;79kg</span></span><br><span class="line"><span class="string"># コメント行</span></span><br><span class="line"><span class="string">Matsui;45;188cm;95kg</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line">    r := csv.NewReader(strings.NewReader(s))</span><br><span class="line">    r.Comma = <span class="string">&#x27;;&#x27;</span> <span class="comment">// 区切り文字を , から ; に変更</span></span><br><span class="line">    r.Comment = <span class="string">&#x27;#&#x27;</span> <span class="comment">// 先頭が # の場合はコメント行として扱う</span></span><br><span class="line">    r.FieldsPerRecord = <span class="number">4</span> <span class="comment">// 各行のフィールド数。多くても少なくてもエラーになる</span></span><br><span class="line">    r.LazyQuotes = <span class="literal">true</span> <span class="comment">// true の場合、&quot;&quot; が値の途中に &quot;180&quot;cm のようになっていてもエラーにならない</span></span><br><span class="line">    r.TrimLeadingSpace = <span class="literal">true</span> <span class="comment">// true の場合は、先頭の空白文字を無視する</span></span><br><span class="line">    r.ReuseRecord = <span class="literal">true</span> <span class="comment">// true の場合は、Read で戻ってくるスライスを次回再利用する。パフォーマンスが上がる</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        record, err := r.Read()</span><br><span class="line">        <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Fatal(err)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// recordは配列</span></span><br><span class="line">        fmt.Printf(<span class="string">&quot;%#v\n&quot;</span>, record)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// []string&#123;&quot;名前&quot;, &quot;年齢&quot;, &quot;身長&quot;, &quot;体重&quot;&#125;</span></span><br><span class="line">        <span class="comment">// []string&#123;&quot;Tanaka&quot;, &quot;31&quot;, &quot;190cm&quot;, &quot;97kg&quot;&#125;</span></span><br><span class="line">        <span class="comment">// []string&#123;&quot;Suzuki&quot;, &quot;46&quot;, &quot;180cm&quot;, &quot;79kg&quot;&#125;</span></span><br><span class="line">        <span class="comment">// []string&#123;&quot;Matsui&quot;, &quot;45&quot;, &quot;188cm&quot;, &quot;95kg&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="エラーハンドリング-csv-ParseError"><a href="#エラーハンドリング-csv-ParseError" class="headerlink" title="エラーハンドリング(csv.ParseError)"></a>エラーハンドリング(csv.ParseError)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/csv&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">`名前,年齢,身長,体重</span></span><br><span class="line"><span class="string">Tanaka,31,190cm,97kg</span></span><br><span class="line"><span class="string">Suzuki,46,180cm,79kg</span></span><br><span class="line"><span class="string">Matsui,45,188cm,95kg</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">    r := csv.NewReader(strings.NewReader(s))</span><br><span class="line"></span><br><span class="line">    records, err := r.ReadAll()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> e, ok := err.(*csv.ParseError); ok &#123;</span><br><span class="line">            n := <span class="number">0</span></span><br><span class="line">            <span class="keyword">switch</span> e.Err &#123;</span><br><span class="line">            <span class="keyword">case</span> csv.ErrBareQuote:</span><br><span class="line">                <span class="comment">// ダブルクオート途中で使用されていて LazyQuotes を true にしていない場合のエラー</span></span><br><span class="line">                <span class="comment">// 例えば、 Tan&quot;aka,31,190cm,97kg のように 途中に &quot; がある場合</span></span><br><span class="line">                n = <span class="number">1</span></span><br><span class="line">            <span class="keyword">case</span> csv.ErrQuote:</span><br><span class="line">                <span class="comment">// 先頭がダブルクオートで始まっていて、末尾がダブルクオートになっていない場合のエラー</span></span><br><span class="line">                <span class="comment">// 例えば、 &quot;Tanaka,31,190cm,97kg のように閉じるための &quot; がない場合</span></span><br><span class="line">                n = <span class="number">2</span></span><br><span class="line">            <span class="keyword">case</span> csv.ErrFieldCount:</span><br><span class="line">                <span class="comment">// FieldsPerRecordで指定した数と異なる場合のエラー</span></span><br><span class="line">                n = <span class="number">3</span></span><br><span class="line">            &#125;</span><br><span class="line">            log.Fatal(<span class="string">&quot;\nエラー: &quot;</span>, n, <span class="string">&quot;\n&quot;</span>, e.Err,</span><br><span class="line">                <span class="string">&quot;\nStartLine:&quot;</span>, e.StartLine, <span class="string">&quot;\nLine:&quot;</span>, e.Line, <span class="string">&quot;\nColumn:&quot;</span>, e.Column)</span><br><span class="line">        &#125;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(records)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="読み込んだShift-JISファイルをUTF8にする"><a href="#読み込んだShift-JISファイルをUTF8にする" class="headerlink" title="読み込んだShift-JISファイルをUTF8にする"></a>読み込んだShift-JISファイルをUTF8にする</h3><p><code>encoding/japanese</code> と <code>text/transform</code> が必要なのでダウンロードする</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> get golang.org/x/text/encoding/japanese golang.org/x/text/transform</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/csv&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;golang.org/x/text/encoding/japanese&quot;</span></span><br><span class="line">    <span class="string">&quot;golang.org/x/text/transform&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f, err := os.Open(<span class="string">&quot;file-sjis.csv&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r := csv.NewReader(transform.NewReader(f, japanese.ShiftJIS.NewDecoder()))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        record, err := r.Read()</span><br><span class="line">        <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Fatal(err)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fmt.Println(record)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="一度にすべて読み込む-ReadAll"><a href="#一度にすべて読み込む-ReadAll" class="headerlink" title="一度にすべて読み込む(ReadAll)"></a>一度にすべて読み込む(ReadAll)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/csv&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">`名前,年齢,身長,体重</span></span><br><span class="line"><span class="string">Tanaka,31,190cm,97kg</span></span><br><span class="line"><span class="string">Suzuki,46,180cm,79kg</span></span><br><span class="line"><span class="string">Matsui,45,188cm,95kg</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">    r := csv.NewReader(strings.NewReader(s))</span><br><span class="line"></span><br><span class="line">    record, err := r.ReadAll()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%#v\n&quot;</span>, record)</span><br><span class="line">    <span class="comment">// [][]string&#123;</span></span><br><span class="line">    <span class="comment">//     []string&#123;&quot;名前&quot;, &quot;年齢&quot;, &quot;身長&quot;, &quot;体重&quot;&#125;,</span></span><br><span class="line">    <span class="comment">//     []string&#123;&quot;Tanaka&quot;, &quot;31&quot;, &quot;190cm&quot;, &quot;97kg&quot;&#125;,</span></span><br><span class="line">    <span class="comment">//     []string&#123;&quot;Suzuki&quot;, &quot;46&quot;, &quot;180cm&quot;, &quot;79kg&quot;&#125;,</span></span><br><span class="line">    <span class="comment">//     []string&#123;&quot;Matsui&quot;, &quot;45&quot;, &quot;188cm&quot;, &quot;95kg&quot;&#125;,</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="一行ずつ書き込む-Write"><a href="#一行ずつ書き込む-Write" class="headerlink" title="一行ずつ書き込む(Write)"></a>一行ずつ書き込む(Write)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/csv&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    records := [][]<span class="keyword">string</span>&#123;</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">&quot;名前&quot;</span>, <span class="string">&quot;年齢&quot;</span>, <span class="string">&quot;身長&quot;</span>, <span class="string">&quot;体重&quot;</span>&#125;,</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">&quot;Tanaka&quot;</span>, <span class="string">&quot;31&quot;</span>, <span class="string">&quot;190cm&quot;</span>, <span class="string">&quot;97kg&quot;</span>&#125;,</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">&quot;Suzuki&quot;</span>, <span class="string">&quot;46&quot;</span>, <span class="string">&quot;180cm&quot;</span>, <span class="string">&quot;79kg&quot;</span>&#125;,</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">&quot;Matsui&quot;</span>, <span class="string">&quot;45&quot;</span>, <span class="string">&quot;188cm&quot;</span>, <span class="string">&quot;95kg&quot;</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    f, err := os.Create(<span class="string">&quot;file.csv&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    w := csv.NewWriter(f)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// オプション</span></span><br><span class="line">    w.Camma = <span class="string">&#x27;,&#x27;</span> <span class="comment">// デフォルトはカンマ区切りで出力される。変更する場合はこの rune 文字を変更する</span></span><br><span class="line">    w.UseCRLF = <span class="literal">true</span> <span class="comment">// 改行文字を CRLF(\r\n) にする</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, record := <span class="keyword">range</span> records &#123;</span><br><span class="line">        <span class="keyword">if</span> err := w.Write(record); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Fatal(err)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    w.Flush() <span class="comment">// バッファに残っているデータをすべて書き込む</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := w.Error(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>書き込み結果</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat file.csv</span><br><span class="line">名前,年齢,身長,体重</span><br><span class="line">Tanaka,<span class="number">31</span>,<span class="number">190</span>cm,<span class="number">97</span>kg</span><br><span class="line">Suzuki,<span class="number">46</span>,<span class="number">180</span>cm,<span class="number">79</span>kg</span><br><span class="line">Matsui,<span class="number">45</span>,<span class="number">188</span>cm,<span class="number">95</span>kg</span><br></pre></td></tr></table></figure>

<h3 id="すべて一度に書き込む-WriteAll"><a href="#すべて一度に書き込む-WriteAll" class="headerlink" title="すべて一度に書き込む(WriteAll)"></a>すべて一度に書き込む(WriteAll)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/csv&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    records := [][]<span class="keyword">string</span>&#123;</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">&quot;名前&quot;</span>, <span class="string">&quot;年齢&quot;</span>, <span class="string">&quot;身長&quot;</span>, <span class="string">&quot;体重&quot;</span>&#125;,</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">&quot;Tanaka&quot;</span>, <span class="string">&quot;31&quot;</span>, <span class="string">&quot;190cm&quot;</span>, <span class="string">&quot;97kg&quot;</span>&#125;,</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">&quot;Suzuki&quot;</span>, <span class="string">&quot;46&quot;</span>, <span class="string">&quot;180cm&quot;</span>, <span class="string">&quot;79kg&quot;</span>&#125;,</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">&quot;Matsui&quot;</span>, <span class="string">&quot;45&quot;</span>, <span class="string">&quot;188cm&quot;</span>, <span class="string">&quot;95kg&quot;</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    f, err := os.Create(<span class="string">&quot;file.csv&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    w := csv.NewWriter(f)</span><br><span class="line"></span><br><span class="line">    w.WriteAll(records)</span><br><span class="line"></span><br><span class="line">    w.Flush()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := w.Error(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CSVを構造体にマッピングする"><a href="#CSVを構造体にマッピングする" class="headerlink" title="CSVを構造体にマッピングする"></a>CSVを構造体にマッピングする</h3><p>以下のように書いてみたけど、reflect 使うとさらに面倒そう。<br>なので gocsv (gocsvのgodocページ) を使えば、読み込んだCSVを構造体にマッピングできて、 その逆で構造体からCSVに変換するのも楽にできそう。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/csv&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;io&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> People <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name   <span class="keyword">string</span></span><br><span class="line">    Age    <span class="keyword">int</span></span><br><span class="line">    Height <span class="keyword">string</span></span><br><span class="line">    Weight <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">`名前,年齢,身長,体重</span></span><br><span class="line"><span class="string">Tanaka,31,190cm,97kg</span></span><br><span class="line"><span class="string">Suzuki,46,180cm,79kg</span></span><br><span class="line"><span class="string">Matsui,45,188cm,95kg</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">    r := csv.NewReader(strings.NewReader(s))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> p []People</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; ; i++ &#123;</span><br><span class="line">        record, err := r.Read()</span><br><span class="line">        <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Fatal(err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> people People</span><br><span class="line">        <span class="keyword">for</span> i, v := <span class="keyword">range</span> record &#123;</span><br><span class="line">            <span class="keyword">switch</span> i &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                people.Name = v</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                people.Age, err = strconv.Atoi(v)</span><br><span class="line">                <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">                    log.Fatal(err)</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                people.Height = v</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                people.Weight = v</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        p = <span class="built_in">append</span>(p, people)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(p)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://golang.hateblo.jp/entry/golang-encoding-csv">https://golang.hateblo.jp/entry/golang-encoding-csv</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2020/03/13/%E7%90%86%E8%A7%A3laravel%E7%9A%84%E7%AE%A1%E9%81%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="要么庸俗，要么孤独">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外贸独立站(日本)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/13/%E7%90%86%E8%A7%A3laravel%E7%9A%84%E7%AE%A1%E9%81%93/" class="post-title-link" itemprop="url">理解laravel的管道</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-03-13 17:18:06 / 修改时间：18:43:02" itemprop="dateCreated datePublished" datetime="2020-03-13T17:18:06+09:00">2020-03-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
当我们搬开别人架下的绊脚石时，也许恰恰是在为自己铺路。
</blockquote>

<p>Basically, using laravel pipelines you can pass an object between several classes in a fluid way to perform any type of task and finally return the resulting value once all the “tasks” have been executed.</p>
<p>The most clear example about how pipelines works resides in one of the most used components of the framework itself. I’m talking about middlewares.</p>
<p>Middleware provide a convenient mechanism for filtering HTTP requests entering your application… This is how a basic middleware looks like:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">app(Pipeline::class)</span><br><span class="line">    -&gt;send(<span class="variable">$content</span>)</span><br><span class="line">    -&gt;through(<span class="variable">$pipes</span>)</span><br><span class="line">    -&gt;via(‘customMethodName’) <span class="comment">// &lt;---- This one :)</span></span><br><span class="line">    -&gt;then(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$content</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Post::create([<span class="string">&#x27;content&#x27;</span> =&gt; <span class="variable">$content</span>]);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>These “middlewares” are in fact just pipes by where the request is going to be sent thru, in order to perform any needed task. Here you can check if the request is an HTTP request, a JSON request, if there is any user authenticated, etc.</p>
<p>If you take a quick look to the <code>Illuminate\Foundation\Http\Kernel</code> class, you’ll see how the middlewares are executed by using a new instance of the Pipeline class.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Send the given request through the middleware / router.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span>  \Illuminate\Http\Request  $request</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">sendRequestThroughRouter</span>(<span class="params"><span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;app-&gt;instance(<span class="string">&#x27;request&#x27;</span>, <span class="variable">$request</span>);</span><br><span class="line">    Facade::clearResolvedInstance(<span class="string">&#x27;request&#x27;</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;bootstrap();</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">new</span> Pipeline(<span class="keyword">$this</span>-&gt;app))</span><br><span class="line">                    -&gt;send(<span class="variable">$request</span>)</span><br><span class="line">                    -&gt;through(<span class="keyword">$this</span>-&gt;app-&gt;shouldSkipMiddleware() ? [] : <span class="keyword">$this</span>-&gt;middleware)</span><br><span class="line">    -&gt;then(<span class="keyword">$this</span>-&gt;dispatchToRouter());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can read in the code something like: a new pipeline that sends the request through a list of middlewares and then dispatch the router.</p>
<p>Don’t worry if this seems a little overwhelmed to you. Let’s try to clarify the concept with the follow example.</p>
<h3 id="Working-on-a-class-that-requires-to-run-multiple-tasks"><a href="#Working-on-a-class-that-requires-to-run-multiple-tasks" class="headerlink" title="Working on a class that requires to run multiple tasks"></a>Working on a class that requires to run multiple tasks</h3><p>Consider this situation. Let’s say you are building a forum where people can create threads and leave comments. But your client ask you to auto-remove tags or edit them on every piece of content when it’s created.</p>
<p>So this is what you are asked to do:</p>
<ul>
<li>Replace link tags with plain text.</li>
<li>Replace bad words with “*”</li>
<li>Remove script tags entirely from the content</li>
</ul>
<p>Probably you end up creating classes to handle each of these “tasks”.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$pipes</span> = [</span><br><span class="line">    RemoveBadWords::class</span><br><span class="line">    ReplaceLinkTags::clas</span><br><span class="line">    RemoveScriptTags::class</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>What we are going to do is to pass the given “content” to each task and then return the result to the next one. We can do this using a pipeline.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$pipes</span> = [</span><br><span class="line">        RemoveBadWords::class,</span><br><span class="line">        ReplaceLinkTags::clas,</span><br><span class="line">        RemoveScriptTags::class</span><br><span class="line">    ];</span><br><span class="line">    <span class="variable">$post</span> = app(Pipeline::class)</span><br><span class="line">        -&gt;send(<span class="variable">$request</span>-&gt;content)</span><br><span class="line">        -&gt;through(<span class="variable">$pipes</span>)</span><br><span class="line">        -&gt;then(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$content</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Post::create([<span class="string">&#x27;content&#x27;</span> =&gt; <span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="comment">// return any type of response</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Each “task” class should have a “handle” method to perform the action. Maybe it would be a good idea to have a contract to be implemented by each class:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Pipe</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$content</span>, <span class="built_in">Closure</span> <span class="variable">$next</span></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoveBadWords</span> <span class="keyword">implements</span> <span class="title">Pipe</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$content</span>, <span class="built_in">Closure</span> <span class="variable">$next</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Here you perform the task and return the updated $content</span></span><br><span class="line">        <span class="comment">// to the next pipe</span></span><br><span class="line">        <span class="keyword">return</span>  <span class="variable">$next</span>(<span class="variable">$content</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The method used to perform the task should receive two parameters, the first one would be the passable object, and the second one would be a closure where the object is going to be redirected to after running the last pipe.</p>
<p>You can use a custom method name instead of ‘handle’. Then you need to specify the method name to be used by the pipeline, like so</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">app(Pipeline::class)</span><br><span class="line">    -&gt;send(<span class="variable">$content</span>)</span><br><span class="line">    -&gt;through(<span class="variable">$pipes</span>)</span><br><span class="line">    -&gt;via(‘customMethodName’) <span class="comment">// &lt;---- This one :)</span></span><br><span class="line">    -&gt;then(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$content</span></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> Post::create([<span class="string">&#x27;content&#x27;</span> =&gt; <span class="variable">$content</span>]);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="What-happens-at-the-end"><a href="#What-happens-at-the-end" class="headerlink" title="What happens at the end ?"></a>What happens at the end ?</h3><p>What should happen here is that the post content is going to be modified by each one of the <code>$pipes</code> and at the end, this resulting content is going to be stored.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span> = app(Pipeline::class)</span><br><span class="line">    -&gt;send(<span class="variable">$request</span>-&gt;all())</span><br><span class="line">    -&gt;through(<span class="variable">$pipes</span>)</span><br><span class="line">    -&gt;then(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$content</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Post::create([<span class="string">&#x27;content&#x27;</span> =&gt; <span class="variable">$content</span>]);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Final-words"><a href="#Final-words" class="headerlink" title="Final words"></a>Final words</h3><p>Remember, there are tons of ways you can approach this type of issues. What you decide to do it’s up to you. But it is good to know that you have this tool in your arsenal to be used if necessary. I hope this example gives you a better understanding of what these “laravel pipelines” are and how to use them. You can also take a look at api laravel documents if you want to know more about how this</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://jeffochoa.me/understanding-laravel-pipelines">https://jeffochoa.me/understanding-laravel-pipelines</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2020/03/02/a-real-world-example-of-go-interfaces/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="要么庸俗，要么孤独">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外贸独立站(日本)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/02/a-real-world-example-of-go-interfaces/" class="post-title-link" itemprop="url">A-Real-World-Example-of-Go-Interfaces</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-02 20:54:48" itemprop="dateCreated datePublished" datetime="2020-03-02T20:54:48+09:00">2020-03-02</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-06-01 17:31:34" itemprop="dateModified" datetime="2022-06-01T17:31:34+09:00">2022-06-01</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
孤独的孩子，悄悄在风中长大了。
</blockquote>

<p>Suppose I’m building a web app in Go. In my app, I want to send a message to my users. I can send a message to the users via email or SMS. This would be a perfect use case for interfaces.</p>
<p>For this hypothetical web app, I create the following <code>main.go</code> file.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Email <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserNotifier <span class="keyword">interface</span> &#123;</span><br><span class="line">	SendMessage(user *User, message <span class="keyword">string</span>) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	user := &amp;User&#123;<span class="string">&quot;Dirk&quot;</span>, <span class="string">&quot;dirk@email.com&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;Welcome %s\n&quot;</span>, user.Name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The User struct represents a user.<br>You can see I created a UserNotifier of type interface that has a single function: <code>SendMessage()</code>.<br>To implement this interface, I have to create a struct that implements the <code>SendMessage()</code> function.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> EmailNotifier <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(notifier EmailNotifier)</span> <span class="title">SendMessage</span><span class="params">(user *User, message <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	_, err := fmt.Printf(<span class="string">&quot;Sending email to %s with content %s\n&quot;</span>, user.Name, message)</span><br><span class="line">	<span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As you can see, I created a new EmailNotifier struct. Then I implemented the SendMessage() method on the struct. Note that in this example, the EmailNotifier simply prints a message. In the real world, you would probably call an email API such as Mailgun.</p>
<p>And that’s it, the interface is now implemented.</p>
<p>The next thing to do is send an email to the user using the UserNotifier interface.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	user := User&#123;<span class="string">&quot;Dirk&quot;</span>, <span class="string">&quot;dirk@email.com&quot;</span>&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Welcome %s\n&quot;</span>, user.Name)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> userNotifier UserNotifier</span><br><span class="line">	userNotifier = EmailNotifier&#123;&#125;</span><br><span class="line">	userNotifier.SendMessage(&amp;user, <span class="string">&quot;Interfaces all the way!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When running this program, the SendMessage() of the EmailNotifier is called correctly.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> build -o main main.<span class="keyword">go</span></span><br><span class="line">./main</span><br><span class="line">Welcome Dirk</span><br><span class="line">Sending email to Dirk with content Interfaces all the way!</span><br></pre></td></tr></table></figure>
<p>Let’s implement an SMS interface as well.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SmsNotifier <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(notifier SmsNotifier)</span> <span class="title">SendMessage</span><span class="params">(user *User, message <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	_, err := fmt.Printf(<span class="string">&quot;Sending SMS to %s with content %s\n&quot;</span>, user.Name, message)</span><br><span class="line">	<span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>One cool feature is we can store the notifier in the user struct. In this way, each user will have a personal notifier.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Email <span class="keyword">string</span></span><br><span class="line">	Notifier UserNotifier</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You can then add a handy method to the User struct that notifies the user using the UserNotifier interface.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">notify</span><span class="params">(message <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> user.Notifier.SendMessage(user, message)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Finally, I created two users in the main() function and called the notify() method.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	user1 := User&#123;<span class="string">&quot;Dirk&quot;</span>, <span class="string">&quot;dirk@email.com&quot;</span>, EmailNotifier&#123;&#125;&#125;</span><br><span class="line">	user2 := User&#123;<span class="string">&quot;Justin&quot;</span>, <span class="string">&quot;bieber@email.com&quot;</span>, SmsNotifier&#123;&#125;&#125;</span><br><span class="line"></span><br><span class="line">	user1.notify(<span class="string">&quot;Welcome Email user!&quot;</span>)</span><br><span class="line">	user2.notify(<span class="string">&quot;Welcome SMS user!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The final result worked as expected.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> build -o main main.<span class="keyword">go</span></span><br><span class="line">./main</span><br><span class="line">Sending email to Dirk with content Welcome Email user!</span><br><span class="line">Sending SMS to Justin with content Welcome SMS user!</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://medium.com/better-programming/a-real-world-example-of-go-interfaces-98e89b2ddb67">https://medium.com/better-programming/a-real-world-example-of-go-interfaces-98e89b2ddb67</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2020/03/01/go%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="要么庸俗，要么孤独">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外贸独立站(日本)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/01/go%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91/" class="post-title-link" itemprop="url">go如何进行交叉编译</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-01 11:04:33" itemprop="dateCreated datePublished" datetime="2020-03-01T11:04:33+09:00">2020-03-01</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-10 13:55:17" itemprop="dateModified" datetime="2021-09-10T13:55:17+09:00">2021-09-10</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
你爱上小溪 是因为没有见过大海 我已见过银河 但我只爱一颗星
</blockquote>

<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>golang如何在一个平台编译另外一个平台可以执行的文件。比如在mac上编译Windows和linux可以执行的文件。那么我们的问题就设定成：如何在mac上编译64位linux的可执行文件。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>golang的交叉编译要保证golang版本在1.5以上，本解决方案实例代码1.9版本执行的。</p>
<p>hello.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;hello, world\n&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在mac上编译64位linux的命令编译命令</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GOOS=linux GOARCH=amd64 <span class="keyword">go</span> build hello.<span class="keyword">go</span></span><br></pre></td></tr></table></figure>

<h3 id="参数解析"><a href="#参数解析" class="headerlink" title="参数解析"></a>参数解析</h3><p>这里用到了两个变量：</p>
<ul>
<li>GOOS：目标操作系统</li>
<li>GOARCH：目标操作系统的架构</li>
</ul>
<h3 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h3><p>在网络上的诸多教程中可能会看到下面的编译命令</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGO_ENABLED=<span class="number">0</span> GOOS=linux GOARCH=amd64 <span class="keyword">go</span> build hello.<span class="keyword">go</span></span><br></pre></td></tr></table></figure>
<p>其中CGO_ENABLED=0的意思是使用C语言版本的GO编译器，参数配置为0的时候就关闭C语言版本的编译器了。自从golang1.5以后go就使用go语言编译器进行编译了。在golang1.9当中没有使用CGO_ENABLED参数发现依然可以正常编译。当然使用了也可以正常编译。比如把CGO_ENABLED参数设置成1，即在编译的过程当中使用CGO编译器，我发现依然是可以正常编译的。</p>
<p>实际上如果在go当中使用了C的库，比如import “C”默认使用go build的时候就会启动CGO编译器，当然我们可以使用CGO_ENABLED=0来控制go build是否使用CGO编译器。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2020/02/21/how-to-add-a-panel-to-chrome-dev-tools/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="要么庸俗，要么孤独">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外贸独立站(日本)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/21/how-to-add-a-panel-to-chrome-dev-tools/" class="post-title-link" itemprop="url">How-to-add-a-panel-to-Chrome-Dev-Tools</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-21 11:26:16" itemprop="dateCreated datePublished" datetime="2020-02-21T11:26:16+09:00">2020-02-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-10 13:29:43" itemprop="dateModified" datetime="2021-09-10T13:29:43+09:00">2021-09-10</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
她曾那么可爱。然后一切都变了。
</blockquote>

<p>I’m a big fan of the Chrome Extension API. It is a simple (and cool) way to extend my favorite browser using HTML and JavaScript. One of the features I’ve been excited about for a while now is the DevTools API. This has been in “experimental” status for a while but is now (mostly) available in the main release.</p>
<p>The DevTools API allows you to integrate extensions directly into your DevTools. There are multiple samples of this API. But there aren’t any samples that detail how to create panels. There is documentation for creating panels, but it wasn’t clear how to use that API in a real extension. I dug at it for a while and finally figured it out. What follows is what I had to do to make panel creation work. It may not be the right way, but it worked. First, you must set a devtools_page value in your manifest.json. Here is my sample manifest.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;ColdFire&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.2&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Adds ColdFire support.&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;devtools_page&quot;</span>: <span class="string">&quot;devtools.html&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;tabs&quot;</span>,</span><br><span class="line">    <span class="string">&quot;http://*/*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://*/*&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>the critical part here is devtools_page. You specify a HTML file that will be executed every time the devtools UI is opened. Here is my HTML file:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;devtools.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Not much, right? As far as I can tell, the actual HTML for this file is never going to be rendered - anywhere. Instead, the entire point of this file is to load a JavaScript script. If so, it would be nice if Google would let us simply point devtools_page to a JavaScript script instead. Now let’s look at the script.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;hello from devtools&quot;</span>);</span><br><span class="line">chrome.devtools.panels.create(<span class="string">&quot;ColdFire&quot;</span>,</span><br><span class="line">                              <span class="string">&quot;coldfusion10.png&quot;</span>,</span><br><span class="line">                              <span class="string">&quot;panel.html&quot;</span>,</span><br><span class="line">                              <span class="function"><span class="keyword">function</span>(<span class="params">panel</span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">&quot;hello from callback&quot;</span>); &#125;);</span><br></pre></td></tr></table></figure>

<p>The main part of this script - for now - is just one line. It runs the panels.create API to define a new panel. The first argument is the title. The second is the icon. The third is the HTML file for the panel. Finally, the last argument is a callback to execute when the panel is created. There is no documentation on what size the icon should be. It seems to be 32x32.</p>
<p>Now let’s look at panel.html. I’ve only just begun development so for right now it is pretty simple.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;panel.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>ColdFire<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>And last but not least, the JavaScript file loaded by the panel:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;panel.js&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>So - what about all those console messages? As I tried to get things working, I used console messages all over the place so I could - hopefully - see what was going on. I had very little luck with this. I’ve blogged before about how to use console with Chrome Extensions, but that tip only works when you have a background script. My test extension did not. What finally worked was this:</p>
<p>Click the button that detaches Chrome Dev Tools<br>With the Chrome Dev Tools in its own window and currently focused, use the keyboard combo to open Chrome Dev Tools<br>This opens a second Chrome Dev Tools and I could see all my log messages there.</p>
<p>I hope this helps. As I said, I just got this working so I probably have a lot more to learn.</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.raymondcamden.com/2012/07/15/How-to-add-a-panel-to-Chrome-Dev-Tools">https://www.raymondcamden.com/2012/07/15/How-to-add-a-panel-to-Chrome-Dev-Tools</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2020/01/17/golang%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84restfulapi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="要么庸俗，要么孤独">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外贸独立站(日本)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/17/golang%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84restfulapi/" class="post-title-link" itemprop="url">golang创建一个简单的restfulapi</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-17 19:03:25" itemprop="dateCreated datePublished" datetime="2020-01-17T19:03:25+09:00">2020-01-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-10 13:59:42" itemprop="dateModified" datetime="2021-09-10T13:59:42+09:00">2021-09-10</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
你如今的气质里，藏着你走过的路，读过的书，和爱过的人。
</blockquote>

<p>Webからエンタープライズアプリケーションまで、RESTfulというアーキテクチャーが使われています。ステートレス設計として、別々のソフトウェアコンポーネント間の通信を提供する強力な方法であります。 Web開発者として、RESTful APIを作るために、主にPythonを使いますが、最近Goプログラミング言語に出会い、興味を持ってきました。Goプログラミング言語（golangでも呼ばれる）は、Googleのプロジェクトで、マイクロサービスアーキテクチャに適当な多くの機能も提供するので、人気が増えています。</p>
<p>本記事、golangを使ってシンプルなRESTful APIをどう作るか説明したいと思います。</p>
<h3 id="仕様"><a href="#仕様" class="headerlink" title="仕様"></a>仕様</h3><p>RESTful APIは、通常CRUDができます。CRUDとは、データベースの四つの主要な機能、「作成（Create）」「読み出し（Read）」「更新（Update）」「削除（Delete）」ですが、今回は、簡単にするために、読み出しの機能しか作りません。そして、データがJSONの形式で書きます。</p>
<p>そして、このエンドポイントがあります：</p>
<ul>
<li>/ -&gt; ホームページですが、とりあえずテキストしかを見せない</li>
<li>/items/ -&gt; Itemのリスト、Itemデータを全部見せる</li>
<li>/items/{id} -&gt; 特定のItemの情報<br>それぞれのItemは、「title」と「description」のデータがあって、簡単にするために、データベースを使用するのではなく、データを事前に定義します。</li>
</ul>
<h3 id="開発プロセス"><a href="#開発プロセス" class="headerlink" title="開発プロセス"></a>開発プロセス</h3><p>最初は、必要なパッケージをインストールします。ルーティングのために、Muxというパッケージを使っていきます。CMD / Terminalを開けて、このコマンドを実行してください：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/gorilla/mux</span><br></pre></td></tr></table></figure>
<p>その後、main.goというファイルを作成して、このコードを入れてください：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/gorilla/mux&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>すべてのgolangを使って作られたプログラムがパッケージで構成されています。この部分では、何のパッケージが必要かが書いてあります。この場合には、四つのパッケージが必要です。</p>
<h3 id="ルーティング"><a href="#ルーティング" class="headerlink" title="ルーティング"></a>ルーティング</h3><p>同じファイルで、さっきの書いたコードの下に、このコードを入れてください：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Controller for the / route (home)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">homePage</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    fmt.Fprintf(w, <span class="string">&quot;This is the home page. Welcome!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Controller for the /items route</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">returnAllItems</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    <span class="comment">// Code for returning all items here</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Controller for the /items/&#123;id&#125; route</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">returnSingleItem</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    <span class="comment">// Code for returning a single item here</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleRequests</span><span class="params">()</span></span> &#123;</span><br><span class="line">    myRouter := mux.NewRouter().StrictSlash(<span class="literal">true</span>)</span><br><span class="line">    myRouter.HandleFunc(<span class="string">&quot;/&quot;</span>, homePage)</span><br><span class="line">    myRouter.HandleFunc(<span class="string">&quot;/items&quot;</span>, returnAllItems)</span><br><span class="line">    myRouter.HandleFunc(<span class="string">&quot;/items/&#123;id&#125;&quot;</span>, returnSingleItem)</span><br><span class="line">    log.Fatal(http.ListenAndServe(<span class="string">&quot;:8000&quot;</span>, myRouter))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    handleRequests()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>main()</code>という関数は、このプログラムをスタートすると、自動的に実行されます。その中に、<code>handleRequests()</code>という関数が実行されます。<code>handleRequests()</code>の関数で、それぞれのエンドポイントがアクセスされると、何が起こるかが書いてあります。例えば、/のエンドポイントがアクセスされると、<code>homePage</code>という関数が実行されるとか、<code>/items</code>のエンドポイントがアクセスされると、<code>returnAllItems</code>という関数が実行されます。</p>
<p>そして、このコード：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log.Fatal(http.ListenAndServe(<span class="string">&quot;:8000&quot;</span>, myRouter))</span><br></pre></td></tr></table></figure>
<p>の意味は、このプログラムが8000のポートで、アクセスできます。これで、もう使えるなので、スタートしてみましょう！</p>
<p>CMD / Terminal で、このコマンドを実行してください：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> run main.<span class="keyword">go</span></span><br></pre></td></tr></table></figure>

<h3 id="サポート関数"><a href="#サポート関数" class="headerlink" title="サポート関数"></a>サポート関数</h3><p>これから、二つのパッケージが必要なので、インポートしましょう。最初のimport部分をこれに変更してください：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/gorilla/mux&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>encoding/jsonとstrconvというパッケージを追加しました。もうすぐこの二つを使います。</p>
<p>それから、二つのサポート関数を書きましょう：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">respondWithError</span><span class="params">(w http.ResponseWriter, code <span class="keyword">int</span>, msg <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    respondWithJson(w, code, <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;<span class="string">&quot;error&quot;</span>: msg&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">respondWithJson</span><span class="params">(w http.ResponseWriter, code <span class="keyword">int</span>, payload <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    response, _ := json.Marshal(payload)</span><br><span class="line">    w.Header().Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">    w.WriteHeader(code)</span><br><span class="line">    w.Write(response)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>両方の関数は、JSONの形式でHTTP requestに答える役割があります。</p>
<h3 id="Itemデータ構造"><a href="#Itemデータ構造" class="headerlink" title="Itemデータ構造"></a>Itemデータ構造</h3><p>Itemのデータ構造を書きましょう。importの部分の下に、このコードを入れてください：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Item representation</span></span><br><span class="line"><span class="keyword">type</span> Item <span class="keyword">struct</span> &#123;</span><br><span class="line">    Title   <span class="keyword">string</span> <span class="string">`json:&quot;title&quot;`</span></span><br><span class="line">    Description    <span class="keyword">string</span> <span class="string">`json:&quot;description&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>仕様に基づいて、それぞれのItemは、「title」と「description」のデータがあります。そして、その下に、これを入れて下さい：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Global, static list of items</span></span><br><span class="line"><span class="keyword">var</span> itemList = []Item&#123;</span><br><span class="line">    Item&#123;Title: <span class="string">&quot;Item A&quot;</span>, Description: <span class="string">&quot;The first item&quot;</span>&#125;,</span><br><span class="line">    Item&#123;Title: <span class="string">&quot;Item B&quot;</span>, Description: <span class="string">&quot;The second item&quot;</span>&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>今回は、データベースを使わないので、これでデータを事前に定義します。二つのItemだけ書きましたが、自由にいくつでもいいですよ。</p>
<h3 id="コア関数"><a href="#コア関数" class="headerlink" title="コア関数"></a>コア関数</h3><p>最後に、コア関数（returnAllItemsとreturnSingleItem）を書きます。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Controller for the /items route</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">returnAllItems</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    respondWithJson(w, http.StatusOK, itemList)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>基本的に、/itemsのエンドポイントをアクセスすると、returnAllItems()という関数がすべてのItemをJSONの形式で答えます。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Controller for the /items/&#123;id&#125; route</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">returnSingleItem</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    <span class="comment">// Get query parameters using Mux</span></span><br><span class="line">    vars := mux.Vars(r)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Convert &#123;id&#125; parameter from string to int</span></span><br><span class="line">    key, err := strconv.Atoi(vars[<span class="string">&quot;id&quot;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If &#123;id&#125; parameter is not valid int</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        respondWithError(w, http.StatusBadRequest, <span class="string">&quot;Invalid request payload&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If Item with ID of &#123;id&#125; does not exist</span></span><br><span class="line">    <span class="keyword">if</span> key &gt;= <span class="built_in">len</span>(itemList) &#123;</span><br><span class="line">        respondWithError(w, http.StatusNotFound, <span class="string">&quot;Item does not exist&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    respondWithJson(w, http.StatusOK, itemList[key])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>そして、<code>returnSingleItem()</code>という関数が、idのURLパラメーターに基づいて特定のItemの情報をJSONの形式で答えます。</p>
<p>例えば、localhost:8000/items/1をアクセスしたら、1がidになります。それから、そのidは、indexとしてitemListという配列からデータを取ってJSONの形式で答えます。idは1の場合は、二つ目のデータが取られます。そして、idは0の場合は、一つ目のデータが取られます。</p>
<p>idは、数だけであるべきであり、Itemの数以上になってはいけないので、二つのチェックを書きました。これで、終わりです。作ってみましょう！</p>
<h3 id="テスト"><a href="#テスト" class="headerlink" title="テスト"></a>テスト</h3><p>CMD / Terminal で、さっきのrunを閉じて、もう一回実行してください：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> run main.<span class="keyword">go</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://qiita.com/sbenemerito/items/d94b811f14ce0a546a3f">https://qiita.com/sbenemerito/items/d94b811f14ce0a546a3f</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2020/01/14/nginx%E4%BD%BF%E7%94%A8https%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86laravel%E7%9A%84http%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="要么庸俗，要么孤独">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外贸独立站(日本)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/14/nginx%E4%BD%BF%E7%94%A8https%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86laravel%E7%9A%84http%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">Nginx使用HTTPS反向代理laravel的HTTP应用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-01-14 12:39:12 / 修改时间：13:49:08" itemprop="dateCreated datePublished" datetime="2020-01-14T12:39:12+09:00">2020-01-14</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
幸有我来山未孤
</blockquote>

<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><p>反向代理的概念不多做解释，此处应用反向代理主要原因如下：</p>
<ul>
<li>应用服务器不必暴露在公网，躲在防火墙后，通过内网连接代理服务器（proxy server）</li>
<li>DNS设置简单，因为有两个不同应用服务器，对应不同的子域名（a.example.com, b.example.com），只需设置DNS *.example.com 到代理服务器IP即可</li>
<li>SSL证书管理方便，只需申请一个通配符的证书 *.example.com 配置在代理服务器</li>
</ul>
<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p>系统环境都是Ubuntu 18.04.2，服务器都是使用Nginx，代理服务器配置SSL，使用HTTPS对外访问（HTTP强制跳转到HTTPS），应用服务器使用Laravel，HTTP对内网访问。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="应用服务器配置"><a href="#应用服务器配置" class="headerlink" title="应用服务器配置"></a>应用服务器配置</h4><p>应用服务器的nginx照常配置即可，可以设置server_name为对应的域名。</p>
<h3 id="代理服务器配置"><a href="#代理服务器配置" class="headerlink" title="代理服务器配置"></a>代理服务器配置</h3><p>代理服务器从网上抄来一份，主要是设置proxy_pass，下面只是location block：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">    proxy_set_header X-<span class="keyword">Real</span>-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-<span class="keyword">For</span> <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    proxy_pass    http:<span class="comment">//ip;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意要加 proxy_set_header X-Forwarded-Proto $scheme 这一条，让后面被代理的应用服务器知道对应的协议是什么，这样应用服务器生成url（如css，js文件）使用相应的协议。如果代理服务器确定使用https，那$scheme替换成https也可以。</p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>本以为这样就搞定了，但是在用域名测试的时候发现网站不能正常加载，浏览器有如下错误：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Mixed</span> Content: The page at <span class="string">&#x27;&lt;URL&gt;&#x27;</span> was loaded over HTTPS, but requested an insecure stylesheet <span class="string">&#x27;&lt;URL&gt;&#x27;</span>. This request has been blocked; the content must be served over HTTPS.</span><br></pre></td></tr></table></figure>
<p>在页面中混用了HTTPS和HTTP，浏览器会block掉不安全的HTTP链接。而HTTP链接主要是用laravel的asset生成的css, js文件，css文件没有加载上，所以就不能正常加载了。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://laravel.com/docs/5.5/helpers#method-asset">https://laravel.com/docs/5.5/helpers#method-asset</a><br>多方查询，有推荐使用proxy_redirect来替换HTTP为HTTPS，但是试用不成功。</p>
</blockquote>
<p>也有说这些资源文件用uri路径来表示，\css\example.css 这样，不带协议。</p>
<p>或者页面增加一个meta，让HTTP升级为安全的HTTPS：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;upgrade-insecure-requests&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样在生产环境没问题，但是需要改动很多代码，而且开发、测试环境也需要ssl证书，很不方便。</p>
<p>在查询到几篇文章中，有提到后端是tomcat，需要修改tomcat的配置来接受X-Forwarded-Proto 这个Header来处理。我思考是不是laravel也需要类似设置，google一下发现了这个：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://laravel.com/docs/5.5/requests#configuring-trusted-proxies">https://laravel.com/docs/5.5/requests#configuring-trusted-proxies</a><br>When running your applications behind a load balancer that terminates TLS / SSL certificates, you may notice your application sometimes does not generate HTTPS links. Typically this is because your application is being forwarded traffic from your load balancer on port 80 and does not know it should generate secure links.</p>
</blockquote>
<p>Laravel从5.5开始，内置了一个 TrustProxies模块来解决这个问题，专门应对使用了Load Balancer等情况。</p>
<p>所以按照文档，修改 protected $proxies = ‘<strong>‘，因为应用服务器在内网，所以改成</strong>也无所谓。<br>Laravel 5.5之前的版本，可以自行用composer来安装这个插件。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/fideloper/TrustedProxy">https://github.com/fideloper/TrustedProxy</a></p>
<p>测试之后，问题解决。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://alexlove77.github.io/2019/06/18/ngingx-reverse-proxy-https/">http://alexlove77.github.io/2019/06/18/ngingx-reverse-proxy-https/</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/42/">42</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lnmput@gmail.com</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
