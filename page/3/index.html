<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"swoole.app","root":"/","images":"/images","scheme":"Gemini","version":"8.7.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js"></script>
<meta name="description" content="è¦ä¹ˆåº¸ä¿—ï¼Œè¦ä¹ˆå­¤ç‹¬">
<meta property="og:type" content="website">
<meta property="og:title" content="å¤–è´¸ç‹¬ç«‹ç«™(æ—¥æœ¬)">
<meta property="og:url" content="https://swoole.app/page/3/index.html">
<meta property="og:site_name" content="å¤–è´¸ç‹¬ç«‹ç«™(æ—¥æœ¬)">
<meta property="og:description" content="è¦ä¹ˆåº¸ä¿—ï¼Œè¦ä¹ˆå­¤ç‹¬">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="lnmput@gmail.com">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://swoole.app/page/3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>å¤–è´¸ç‹¬ç«‹ç«™(æ—¥æœ¬)</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">å¤–è´¸ç‹¬ç«‹ç«™(æ—¥æœ¬)</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">ä¸“æ³¨å¤–è´¸ç‹¬ç«‹ç«™å»ºè®¾</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-é¦–é¡µ"><a href="/" rel="section">é¦–é¡µ</a></li>
        <li class="menu-item menu-item-æ ‡ç­¾"><a href="/tags" rel="section">æ ‡ç­¾</a></li>
        <li class="menu-item menu-item-è¯»ä¹¦"><a href="/read" rel="section">è¯»ä¹¦</a></li>
        <li class="menu-item menu-item-ç¿»è¯‘"><a href="/tags/translate" rel="section">ç¿»è¯‘</a></li>
        <li class="menu-item menu-item-å…³äºæˆ‘"><a href="/about" rel="section">å…³äºæˆ‘</a></li>
        <li class="menu-item menu-item-å¤–è´¸ç«™"><a href="/site" rel="section">å¤–è´¸ç«™</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lnmput@gmail.com"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">lnmput@gmail.com</p>
  <div class="site-description" itemprop="description">è¦ä¹ˆåº¸ä¿—ï¼Œè¦ä¹ˆå­¤ç‹¬</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">420</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">135</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://octobercms.com/" title="octobercms â†’ https:&#x2F;&#x2F;octobercms.com&#x2F;" rel="noopener" target="_blank">octobercms</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://medium.com/" title="medium â†’ https:&#x2F;&#x2F;medium.com&#x2F;" rel="noopener" target="_blank">medium</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/lnmput" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2022/06/01/Golang%E4%BD%BF%E7%94%A8embed%E6%89%93%E5%8C%85gin%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="è¦ä¹ˆåº¸ä¿—ï¼Œè¦ä¹ˆå­¤ç‹¬">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¤–è´¸ç‹¬ç«‹ç«™(æ—¥æœ¬)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/06/01/Golang%E4%BD%BF%E7%94%A8embed%E6%89%93%E5%8C%85gin%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">Golangä½¿ç”¨embedæ‰“åŒ…ginåº”ç”¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-06-01 12:51:13 / ä¿®æ”¹æ—¶é—´ï¼š12:58:24" itemprop="dateCreated datePublished" datetime="2022-06-01T12:51:13+09:00">2022-06-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
å†å²æ˜¯ä¸€å †ç°çƒ¬ï¼Œä½†ç°çƒ¬æ·±å¤„æœ‰ä½™æ¸©ã€‚
</blockquote>

<h3 id="æ–‡ä»¶ç›®å½•"><a href="#æ–‡ä»¶ç›®å½•" class="headerlink" title="æ–‡ä»¶ç›®å½•"></a>æ–‡ä»¶ç›®å½•</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- static</span><br><span class="line">  - js</span><br><span class="line">    - <span class="number">1.</span>js</span><br><span class="line">- templates</span><br><span class="line">  - foo.html</span><br><span class="line">  - index.html</span><br><span class="line">- main.<span class="keyword">go</span></span><br></pre></td></tr></table></figure>

<h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;html/template&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//go:embed static templates</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f embed.FS</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	router := gin.Default()</span><br><span class="line">	templ := template.Must(template.New(<span class="string">&quot;&quot;</span>).ParseFS(f, <span class="string">&quot;templates/*.html&quot;</span>))</span><br><span class="line">	router.SetHTMLTemplate(templ)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// example: /public/static/js/1.js</span></span><br><span class="line">	router.StaticFS(<span class="string">&quot;/public&quot;</span>, http.FS(f))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	router.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.HTML(http.StatusOK, <span class="string">&quot;index.html&quot;</span>, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;title&quot;</span>: <span class="string">&quot;Embed Demo&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	router.GET(<span class="string">&quot;/foo&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.HTML(http.StatusOK, <span class="string">&quot;foo.html&quot;</span>, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;title&quot;</span>: <span class="string">&quot;Foo Bar&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	_ = router.Run(<span class="string">&quot;:9080&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/public/static/js/1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>htn<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2022/05/31/Golang%E6%96%B9%E6%B3%95%E5%92%8C%E6%8E%A5%E5%8F%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="è¦ä¹ˆåº¸ä¿—ï¼Œè¦ä¹ˆå­¤ç‹¬">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¤–è´¸ç‹¬ç«‹ç«™(æ—¥æœ¬)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/31/Golang%E6%96%B9%E6%B3%95%E5%92%8C%E6%8E%A5%E5%8F%A3/" class="post-title-link" itemprop="url">Golangæ–¹æ³•å’Œæ¥å£</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-05-31 13:41:52 / ä¿®æ”¹æ—¶é—´ï¼š14:01:19" itemprop="dateCreated datePublished" datetime="2022-05-31T13:41:52+09:00">2022-05-31</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
è¿™é‡Œè’èŠœå¯¸è‰ä¸ç”Ÿ
åæ¥ä½ æ¥è¿™é‡Œèµ°äº†ä¸€é­
å¥‡è¿¹èˆ¬ä¸‡ç‰©ç”Ÿé•¿
è¿™é‡Œæ˜¯æˆ‘çš„å¿ƒ
</blockquote>

<h3 id="What-is-a-method"><a href="#What-is-a-method" class="headerlink" title="What is a method?"></a>What is a method?</h3><blockquote>
<p>A method is a function or a piece of code that is associated with an object.</p>
</blockquote>
<p>Letâ€™s say, you have a struct called â€œCarâ€ and you create a method of the struct named â€œDriveâ€, then you declare an object from the struct and name it as â€œteslaâ€. So you can call the â€œDriveâ€ method of your â€œteslaâ€ to do whatever you programmed the method to do by using the properties or fields of your â€œteslaâ€ to go the calculation.</p>
<p>What I just explained to you is only an example to make you get the concept of method. So now I will show you how to create your own methods and how to use them.</p>
<h3 id="Usage-of-Method"><a href="#Usage-of-Method" class="headerlink" title="Usage of Method"></a>Usage of Method</h3><p>Basically, all methods are associated with objects, means that you need to have at least one object in your code to declare any methods.</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Car <span class="keyword">struct</span> &#123;</span><br><span class="line">  color <span class="keyword">string</span></span><br><span class="line">  distance <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  tesla := &amp;Car&#123;</span><br><span class="line">    distance: <span class="number">0</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(tesla)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After you got your struct, you will be able to create your method</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Car <span class="keyword">struct</span> &#123;</span><br><span class="line">  color <span class="keyword">string</span></span><br><span class="line">  distance <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Car)</span> <span class="title">Drive</span><span class="params">(dist <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  c.distance += dist</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  tesla := &amp;Car&#123;</span><br><span class="line">    distance: <span class="number">0</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="string">&quot;init distance:&quot;</span>, tesla.distance)</span><br><span class="line">  tesla.Drive(<span class="number">10</span>)</span><br><span class="line">  fmt.Println(<span class="string">&quot;1st drive distance:&quot;</span>, tesla.distance)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&gt;&gt;&gt; OUTPUT &lt;&lt;&lt;</span></span><br><span class="line"><span class="comment">init distance: 0</span></span><br><span class="line"><span class="comment">1st drive distance: 10</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>A method is very similar to a function but the difference is that the method is associated with an object and can you the properties inside the object to calculate, just like the â€œDriveâ€ method that uses â€œdistanceâ€ property of â€œCarâ€ to calculate new â€œdistanceâ€.</p>
<p>In case you need to expose some fields of your struct to other packages without directly exporting them, using methods as â€œGetterâ€ is your best choice.</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Car <span class="keyword">struct</span> &#123;</span><br><span class="line">  color <span class="keyword">string</span></span><br><span class="line">  distance <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Car)</span> <span class="title">Drive</span><span class="params">(dist <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  c.distance += dist</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Car)</span> <span class="title">GetDistance</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> c.distance</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  tesla := &amp;Car&#123;</span><br><span class="line">    distance: <span class="number">0</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  tesla.Drive(<span class="number">10</span>)</span><br><span class="line">  fmt.Println(<span class="string">&quot;1st drive distance (without exporting):&quot;</span>, tesla.GetDistance())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&gt;&gt;&gt; OUTPUT &lt;&lt;&lt;</span></span><br><span class="line"><span class="comment">1st drive distance (without exporting): 10</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>Setter is a way to set the value of unexported fields and getter can be used to setup default value of any field you want like the example below.</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Car <span class="keyword">struct</span> &#123;</span><br><span class="line">  color <span class="keyword">string</span></span><br><span class="line">  distance <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Car)</span> <span class="title">Drive</span><span class="params">(dist <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  c.distance += dist</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Getter</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Car)</span> <span class="title">GetDistance</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> c.distance</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Setter</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Car)</span> <span class="title">SetColor</span><span class="params">(color <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">  c.color = color</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Getter with default value</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Car)</span> <span class="title">GetColor</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> c.color == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">    c.color = <span class="string">&quot;white&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> c.color</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  tesla := &amp;Car&#123;</span><br><span class="line">    distance: <span class="number">0</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="string">&quot;get default color:&quot;</span>, tesla.GetColor())</span><br><span class="line">  tesla.SetColor(<span class="string">&quot;silver&quot;</span>)</span><br><span class="line">  fmt.Println(<span class="string">&quot;get new color:&quot;</span>, tesla.GetColor())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&gt;&gt;&gt; OUTPUT &lt;&lt;&lt;</span></span><br><span class="line"><span class="comment">get default color: white</span></span><br><span class="line"><span class="comment">get new color: silver</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>Now you have already learnt how methods work and how to work with methods, but there is another feature in Golang that can enhance the power of structs and their methods. The feature is â€œInterfaceâ€.</p>
<h3 id="What-is-an-interface"><a href="#What-is-an-interface" class="headerlink" title="What is an interface?"></a>What is an interface?</h3><blockquote>
<p>An interface is a set of method signature that an object can implement.</p>
</blockquote>
<p>To make it more understandable, letâ€™s say you have another struct named â€œPlaneâ€ and its methods: â€œFlyâ€ and â€œGetDistanceâ€. And you want to use it with â€œCarâ€ struct by using the same logic to get their distance. An interface will help you for this kind of task.</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Car struct </span></span><br><span class="line"><span class="keyword">type</span> Car <span class="keyword">struct</span> &#123;</span><br><span class="line">  distance <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Car)</span> <span class="title">Drive</span><span class="params">(dist <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  c.distance += dist</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Car)</span> <span class="title">GetDistance</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> c.distance</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Plane struct</span></span><br><span class="line"><span class="keyword">type</span> Plane <span class="keyword">struct</span> &#123;</span><br><span class="line">  distance <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Plane)</span> <span class="title">Fly</span><span class="params">(dist <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  p.distance += dist</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Plane)</span> <span class="title">GetDistance</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> p.distance</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use interface as argument</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetVehicleDistance</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> i.(<span class="keyword">type</span>) &#123;</span><br><span class="line">  <span class="keyword">case</span> *Car:</span><br><span class="line">    c := i.(*Car) <span class="comment">// Type assertion</span></span><br><span class="line">    <span class="keyword">return</span> c.GetDistance()</span><br><span class="line">  <span class="keyword">case</span> *Plane:</span><br><span class="line">    p := i.(*Plane) <span class="comment">// Type assertion</span></span><br><span class="line">    <span class="keyword">return</span> p.GetDistance()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  tesla := &amp;Car&#123;&#125;</span><br><span class="line">  airbus := &amp;Plane&#123;&#125;</span><br><span class="line">  tesla.Drive(<span class="number">10</span>)</span><br><span class="line">  airbus.Fly(<span class="number">10000</span>)</span><br><span class="line">  fmt.Println(<span class="string">&quot;tesla distance:&quot;</span>, GetVehicleDistance(tesla))</span><br><span class="line">  fmt.Println(<span class="string">&quot;airbus distance:&quot;</span>, GetVehicleDistance(airbus))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&gt;&gt;&gt; OUTPUT &lt;&lt;&lt;</span></span><br><span class="line"><span class="comment">tesla distance: 10</span></span><br><span class="line"><span class="comment">airbus distance: 10000</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>From the example above, you can use the same function with different parameter types by using interface as argument. And before you use the method from the interface, you need to do â€œtype assertionâ€ which is very important step for using interfaces.</p>
<p>Anyway the code can be improved and shorten by declaring an interface type with a set of method signature. For our case, it is â€œGetDistanceâ€ method. You will see how short it is.</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Car struct </span></span><br><span class="line"><span class="keyword">type</span> Car <span class="keyword">struct</span> &#123;</span><br><span class="line">  distance <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Car)</span> <span class="title">Drive</span><span class="params">(dist <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  c.distance += dist</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Car)</span> <span class="title">GetDistance</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> c.distance</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Plane struct</span></span><br><span class="line"><span class="keyword">type</span> Plane <span class="keyword">struct</span> &#123;</span><br><span class="line">  distance <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Plane)</span> <span class="title">Fly</span><span class="params">(dist <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  p.distance += dist</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Plane)</span> <span class="title">GetDistance</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> p.distance</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Declare interface type</span></span><br><span class="line"><span class="keyword">type</span> Vehicle <span class="keyword">interface</span> &#123;</span><br><span class="line">  GetDistance() <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use interface as argument</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetVehicleDistance</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  v := i.(Vehicle)</span><br><span class="line">  <span class="keyword">return</span> v.GetDistance()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  tesla := &amp;Car&#123;&#125;</span><br><span class="line">  airbus := &amp;Plane&#123;&#125;</span><br><span class="line">  tesla.Drive(<span class="number">10</span>)</span><br><span class="line">  airbus.Fly(<span class="number">10000</span>)</span><br><span class="line">  fmt.Println(<span class="string">&quot;tesla distance:&quot;</span>, GetVehicleDistance(tesla))</span><br><span class="line">  fmt.Println(<span class="string">&quot;airbus distance:&quot;</span>, GetVehicleDistance(airbus))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&gt;&gt;&gt; OUTPUT &lt;&lt;&lt;</span></span><br><span class="line"><span class="comment">tesla distance: 10</span></span><br><span class="line"><span class="comment">airbus distance: 10000</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>However, donâ€™t forget to validate your interface before using it because somehow it can be nil.</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetVehicleDistance</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> i == <span class="literal">nil</span> &#123; <span class="comment">// validate interface before using</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  v := i.(Vehicle)</span><br><span class="line">  <span class="keyword">return</span> v.GetDistance()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I hope you would get some point about implementing interface with multiple types, it will allow you to create only one logic for executing their method and make you life easier ğŸ˜‚.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2022/05/14/Laravel%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E8%83%BD%E5%9C%A8%E7%A8%8B%E5%BA%8F%E4%B8%AD%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8env%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="è¦ä¹ˆåº¸ä¿—ï¼Œè¦ä¹ˆå­¤ç‹¬">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¤–è´¸ç‹¬ç«‹ç«™(æ—¥æœ¬)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/14/Laravel%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E8%83%BD%E5%9C%A8%E7%A8%8B%E5%BA%8F%E4%B8%AD%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8env%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">Laravelä¸ºä»€ä¹ˆä¸èƒ½åœ¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨envå‡½æ•°</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-05-14 13:28:56 / ä¿®æ”¹æ—¶é—´ï¼š13:37:27" itemprop="dateCreated datePublished" datetime="2022-05-14T13:28:56+09:00">2022-05-14</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
ä¸€å®šè¦çˆ±ç€ç‚¹ä»€ä¹ˆï¼Œæ°ä¼¼è‰æœ¨å¯¹å…‰é˜´çš„é’Ÿæƒ…ã€‚
</blockquote>

<h3 id="HH"><a href="#HH" class="headerlink" title="HH"></a>HH</h3><ul>
<li><code>env()</code>ã¯ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼, ãƒ¢ãƒ‡ãƒ«, etc.. å†…ã§ç›´æ¥ä½¿ã‚ãªã„ã€‚</li>
<li><code>config/*.php</code>ã«<code>env()</code>ã®å€¤ã‚’å…¥ã‚Œã¦<code>config()</code>ã‹ã‚‰å‚ç…§ã™ã‚‹ã€‚</li>
</ul>
<p>ä¾‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// config/my-app.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="comment">// configã«.envã®å†…å®¹ã‚’å…¥ã‚Œã‚‹ã€‚</span></span><br><span class="line">    <span class="string">&#x27;my-env&#x27;</span> =&gt; env(<span class="string">&#x27;MY_ENV&#x27;</span>),</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å†…ãªã©</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// config() ã‚’ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="variable">$my_env</span> = config(<span class="string">&#x27;my-app.my-env&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ã“ã‚Œã¯ãƒ€ãƒ¡ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚</span></span><br><span class="line"><span class="variable">$my_env</span> = env(<span class="string">&#x27;MY_ENV&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="ä½•æ•…-env-ã‚’ä½¿ã£ã¦ã¯ã„ã‘ãªã„ã®ã‹"><a href="#ä½•æ•…-env-ã‚’ä½¿ã£ã¦ã¯ã„ã‘ãªã„ã®ã‹" class="headerlink" title="ä½•æ•… env() ã‚’ä½¿ã£ã¦ã¯ã„ã‘ãªã„ã®ã‹"></a>ä½•æ•… env() ã‚’ä½¿ã£ã¦ã¯ã„ã‘ãªã„ã®ã‹</h3><p>æœ¬ç•ªç’°å¢ƒã§<code>config:cache</code>ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸéš›ã€<code>.env</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¾ãªã„ã‹ã‚‰ã€‚</p>
<p><code>.env</code>ãƒ•ã‚¡ã‚¤ãƒ«ã¯<code>Illuminate\Foundation\Bootstrap\LoadEnvironmentVariables</code>ã‚¯ãƒ©ã‚¹ã®<code>bootstrap()</code>ã§èª­ã¿è¾¼ã¾ã‚Œã‚‹ã®ã§ã™ãŒã€èª­ã¿è¾¼ã‚€å‰ã«<code>config</code>ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ‰ç„¡ã‚’ç¢ºèªã—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã£ãŸå ´åˆã¯<code>.env</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¾ãªã„ä»•æ§˜ã«ãªã£ã¦ã„ã¾ã™ã€‚</p>
<p>å½“è©²éƒ¨åˆ†ã®Laravelã®ã‚³ãƒ¼ãƒ‰ã‚’å¼•ç”¨ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// çœç•¥</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bootstrap</span>(<span class="params">Application <span class="variable">$app</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$app</span>-&gt;configurationIsCached()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checkForSpecificEnvironmentFile(<span class="variable">$app</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            (<span class="keyword">new</span> Dotenv(<span class="variable">$app</span>-&gt;environmentPath(), <span class="variable">$app</span>-&gt;environmentFile()))-&gt;load();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidPathException <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidFileException <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;The environment file is invalid: &#x27;</span>.<span class="variable">$e</span>-&gt;getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœç•¥</span></span><br></pre></td></tr></table></figure>

<p>å¤§ä½“ã®å ´åˆã®æœ¬ç•ªç’°å¢ƒã§ã¯ã€é«˜é€ŸåŒ–ã®ç‚ºã«è¨­å®šã‚’ä¸€çºã‚ã«ã™ã‚‹<code>config:cache</code>ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨æ€ã†ã®ã§ã™ãŒã€å‰è¿°ã®é€šã‚Šã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚‹ã¨.envãŒèª­ã¿è¾¼ã¾ã‚Œãªã„ã®ã§ã€<code>env()</code>ã‚’ç›´æ¥å©ã„ã¦ã‚‹ã¨é–‹ç™ºæ™‚ã‚„ãƒ†ã‚¹ãƒˆæ™‚ã«ã¯å‹•ãã‘ã©æœ¬ç•ªç’°å¢ƒã§æ­»ã¬ã€‚ã¨ã„ã£ãŸäº‹ã«ãªã‚Šã¾ã™ã€‚(å®Ÿéš›ãªã£ãŸ)</p>
<h3 id="å®Ÿéš›ã«è©¦ã™"><a href="#å®Ÿéš›ã«è©¦ã™" class="headerlink" title="å®Ÿéš›ã«è©¦ã™"></a>å®Ÿéš›ã«è©¦ã™</h3><p>é©å½“ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ç”¨æ„ã—ã¦ddã‚’ä½¿ã£ã¦å€¤ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã ã‘ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HogeController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getHoge</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        dd(</span><br><span class="line">            env(<span class="string">&#x27;MY_ENV&#x27;</span>),</span><br><span class="line">            config(<span class="string">&#x27;my-app.my-env&#x27;</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã¾ãšã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡ã—ã§ã‚¢ã‚¯ã‚»ã‚¹ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;Foo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;Foo&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚„é–‹ç™ºç’°å¢ƒã¨åŒã˜æ§˜ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½œæˆã—ã¦ã„ãªã„ã®ã§ã©ã¡ã‚‰ã‚‚åŒã˜å€¤ãŒå–å¾—ã§ãã¾ã™ã€‚</p>
<p>æ¬¡ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã›ã¦ã‚¢ã‚¯ã‚»ã‚¹ã€‚<code>artisan</code>ã®<code>config:cache</code>ã‚’å®Ÿè¡Œã—ã¦<code>bootstrap/cache/config.php</code>ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan config:cache</span><br></pre></td></tr></table></figure>
<p>ã§ã€å…ˆã»ã©ã¨åŒã˜æ§˜ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;Foo&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>.env</code>ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿å‡ºã•ã‚Œã¦ã„ãªã„ã®ã§<code>env()</code>ã§å–å¾—ã—ãŸæ‰€ã§å€¤ãŒå…¥ã£ã¦ã‚‹è¨³ã‚‚ãªãnullã‚’è¿”ã—ã¾ã™ã€‚</p>
<p>ã¨è¨€ã†è¨³ã§æœ€åˆã«æ›¸ã„ãŸé€šã‚Šã€env()ã¯ç›´æ¥ä½¿ã‚ãšã«config()ã«.envã®å€¤ã‚’å…¥ã‚Œã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://hiroto-k.hatenablog.com/entry/2018/03/28/213000">https://hiroto-k.hatenablog.com/entry/2018/03/28/213000</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2022/04/17/%E4%BD%BF%E7%94%A8channel%E6%A8%A1%E6%8B%9F%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="è¦ä¹ˆåº¸ä¿—ï¼Œè¦ä¹ˆå­¤ç‹¬">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¤–è´¸ç‹¬ç«‹ç«™(æ—¥æœ¬)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/17/%E4%BD%BF%E7%94%A8channel%E6%A8%A1%E6%8B%9F%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">ä½¿ç”¨channelæ¨¡æ‹Ÿé”çš„å®ç°</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-04-17 15:19:24 / ä¿®æ”¹æ—¶é—´ï¼š15:40:36" itemprop="dateCreated datePublished" datetime="2022-04-17T15:19:24+09:00">2022-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
çœ‹äººå¥½å¤„ è®°äººé•¿å¤„ å¸®äººéš¾å¤„
</blockquote>

<h3 id="çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>çº¿ç¨‹å®‰å…¨é—®é¢˜</h3><p>å‡è®¾æˆ‘è¦è¦è®¡ç®—ä¸€ä¸ªç”¨æˆ·çš„ç§¯åˆ†ï¼Œä¸ºäº†èƒ½å¤Ÿå°½å¿«ç®—å‡ºç”¨æˆ·æ‰€æœ‰çš„ç§¯åˆ†æ•°ï¼Œæˆ‘ä»¬å¼€å¯äº†åç¨‹</p>
<p>main.go</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">  <span class="string">&quot;test/user&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  newuser:= user.User&#123;</span><br><span class="line">    Point: <span class="number">1</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">  wg.Add(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++ &#123;</span><br><span class="line">      newuser.Add()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++ &#123;</span><br><span class="line">      newuser.Minus()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  wg.Wait()</span><br><span class="line"></span><br><span class="line">  point := newuser.Get()</span><br><span class="line"></span><br><span class="line">  fmt.Println(point)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>user/user.go</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> user</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Point <span class="keyword">int64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Add</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user.Point ++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Minus</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user.Point --</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Get</span><span class="params">()</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> user.Point</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»“æœè®¡ç®—çš„ç”¨æˆ·ç§¯åˆ†æ¯æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œæ­£å¸¸æƒ…å†µä¸‹åº”è¯¥æ˜¯ 1</p>
<h3 id="åŠ é”å¤„ç†"><a href="#åŠ é”å¤„ç†" class="headerlink" title="åŠ é”å¤„ç†"></a>åŠ é”å¤„ç†</h3><p>user/user.go</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> user</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;sync&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Point <span class="keyword">int64</span></span><br><span class="line">  lock sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Add</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user.lock.Lock()</span><br><span class="line">  <span class="keyword">defer</span> user.lock.Unlock()</span><br><span class="line">  user.Point ++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Minus</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user.lock.Lock()</span><br><span class="line">  <span class="keyword">defer</span> user.lock.Unlock()</span><br><span class="line">  user.Point --</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Get</span><span class="params">()</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> user.Point</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨channelæ¨¡æ‹Ÿé”"><a href="#ä½¿ç”¨channelæ¨¡æ‹Ÿé”" class="headerlink" title="ä½¿ç”¨channelæ¨¡æ‹Ÿé”"></a>ä½¿ç”¨channelæ¨¡æ‹Ÿé”</h3><p>nain.go</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">  <span class="string">&quot;test/user&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  newuser:= user.User&#123;</span><br><span class="line">    Point: <span class="number">1</span>,</span><br><span class="line">    Lock: user.NewMutex(),</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">  wg.Add(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++ &#123;</span><br><span class="line">      newuser.Add()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++ &#123;</span><br><span class="line">      newuser.Minus()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  wg.Wait()</span><br><span class="line"></span><br><span class="line">  point := newuser.Get()</span><br><span class="line"></span><br><span class="line">  fmt.Println(point)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>user/user.go</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> user</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Mutex <span class="keyword">struct</span> &#123;</span><br><span class="line">  ch <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMutex</span><span class="params">()</span> *<span class="title">Mutex</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &amp;Mutex&#123;ch: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, <span class="number">1</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Mutex)</span> <span class="title">Lock</span><span class="params">()</span></span> &#123;</span><br><span class="line">  this.ch &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *Mutex)</span> <span class="title">UnLock</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">select</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> &lt;-this.ch:</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;unlock error&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Point <span class="keyword">int64</span></span><br><span class="line">  Lock *Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Add</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user.Lock.Lock()</span><br><span class="line">  <span class="keyword">defer</span> user.Lock.UnLock()</span><br><span class="line">  user.Point ++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Minus</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user.Lock.Lock()</span><br><span class="line">  <span class="keyword">defer</span> user.Lock.UnLock()</span><br><span class="line">  user.Point --</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Get</span><span class="params">()</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> user.Point</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2022/04/17/golang%E4%BD%BF%E7%94%A8channel%E5%A4%84%E7%90%86%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="è¦ä¹ˆåº¸ä¿—ï¼Œè¦ä¹ˆå­¤ç‹¬">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¤–è´¸ç‹¬ç«‹ç«™(æ—¥æœ¬)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/17/golang%E4%BD%BF%E7%94%A8channel%E5%A4%84%E7%90%86%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" class="post-title-link" itemprop="url">golangä½¿ç”¨channelå¤„ç†çº¿ç¨‹å®‰å…¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-04-17 14:17:23 / ä¿®æ”¹æ—¶é—´ï¼š15:16:22" itemprop="dateCreated datePublished" datetime="2022-04-17T14:17:23+09:00">2022-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
å±±è„šäººå¤š,æˆ‘ä»¬å±±é¡¶è§
</blockquote>

<h3 id="çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>çº¿ç¨‹å®‰å…¨é—®é¢˜</h3><p>å‡è®¾æˆ‘è¦è¦è®¡ç®—ä¸€ä¸ªç”¨æˆ·çš„ç§¯åˆ†ï¼Œä¸ºäº†èƒ½å¤Ÿå°½å¿«ç®—å‡ºç”¨æˆ·æ‰€æœ‰çš„ç§¯åˆ†æ•°ï¼Œæˆ‘ä»¬å¼€å¯äº†åç¨‹</p>
<p>main.go</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">  <span class="string">&quot;test/user&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  newuser:= user.User&#123;</span><br><span class="line">    Point: <span class="number">1</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">  wg.Add(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++ &#123;</span><br><span class="line">      newuser.Add()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++ &#123;</span><br><span class="line">      newuser.Minus()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  wg.Wait()</span><br><span class="line"></span><br><span class="line">  point := newuser.Get()</span><br><span class="line"></span><br><span class="line">  fmt.Println(point)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>user/user.go</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> user</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Point <span class="keyword">int64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Add</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user.Point ++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Minus</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user.Point --</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Get</span><span class="params">()</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> user.Point</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»“æœè®¡ç®—çš„ç”¨æˆ·ç§¯åˆ†æ¯æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œæ­£å¸¸æƒ…å†µä¸‹åº”è¯¥æ˜¯ 1</p>
<h3 id="åŠ é”å¤„ç†"><a href="#åŠ é”å¤„ç†" class="headerlink" title="åŠ é”å¤„ç†"></a>åŠ é”å¤„ç†</h3><p>user/user.go</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> user</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;sync&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Point <span class="keyword">int64</span></span><br><span class="line">  lock sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Add</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user.lock.Lock()</span><br><span class="line">  <span class="keyword">defer</span> user.lock.Unlock()</span><br><span class="line">  user.Point ++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Minus</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user.lock.Lock()</span><br><span class="line">  <span class="keyword">defer</span> user.lock.Unlock()</span><br><span class="line">  user.Point --</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Get</span><span class="params">()</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> user.Point</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="channelå¤„ç†"><a href="#channelå¤„ç†" class="headerlink" title="channelå¤„ç†"></a>channelå¤„ç†</h3><p>man.go</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">  <span class="string">&quot;test/user&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  newuser:= user.NewUser()</span><br><span class="line"></span><br><span class="line">  wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">  wg.Add(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++ &#123;</span><br><span class="line">        newuser.Add()</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++ &#123;</span><br><span class="line">      newuser.Minus()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  wg.Wait()</span><br><span class="line"></span><br><span class="line">  point := newuser.Get()</span><br><span class="line"></span><br><span class="line">  fmt.Println(point)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>user/user.go</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> user</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> opera <span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Point <span class="keyword">int64</span></span><br><span class="line">  ch <span class="keyword">chan</span> opera</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewUser</span><span class="params">()</span> *<span class="title">User</span></span> &#123;</span><br><span class="line">  ch := <span class="built_in">make</span>(<span class="keyword">chan</span> opera)</span><br><span class="line">  user := &amp;User&#123;</span><br><span class="line">    Point: <span class="number">1</span>,</span><br><span class="line">      ch: ch,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">go</span> user.Watch()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> user</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Watch</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> fn := <span class="keyword">range</span> user.ch &#123;</span><br><span class="line">    fn()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user.Point ++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Add</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user.ch &lt;- user.add</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">minus</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user.Point --</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Minus</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user.ch &lt;- user.minus</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Get</span><span class="params">()</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> user.Point</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2022/04/17/golang%E6%8E%A7%E5%88%B6%E5%8D%8F%E7%A8%8B%E6%95%B0%E9%87%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="è¦ä¹ˆåº¸ä¿—ï¼Œè¦ä¹ˆå­¤ç‹¬">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¤–è´¸ç‹¬ç«‹ç«™(æ—¥æœ¬)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/17/golang%E6%8E%A7%E5%88%B6%E5%8D%8F%E7%A8%8B%E6%95%B0%E9%87%8F/" class="post-title-link" itemprop="url">golangæ§åˆ¶åç¨‹æ•°é‡</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-04-17 11:25:38 / ä¿®æ”¹æ—¶é—´ï¼š11:46:28" itemprop="dateCreated datePublished" datetime="2022-04-17T11:25:38+09:00">2022-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
äººæ´»ä¸€ç”Ÿï¼Œå€¼å¾—çˆ±çš„ä¸œè¥¿å¾ˆå¤šï¼Œä¸è¦å› ä¸ºä¸€ä¸ªä¸æ»¡æ„ï¼Œå°±ç°å¿ƒ
</blockquote>

<h3 id="DEMO1"><a href="#DEMO1" class="headerlink" title="DEMO1"></a>DEMO1</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> _,v := <span class="keyword">range</span> Uins&#123;</span><br><span class="line">    <span class="comment">// Query the corresponding user information for each UIN</span></span><br><span class="line">    <span class="keyword">go</span> getUserInfo(v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="DEMO2"><a href="#DEMO2" class="headerlink" title="DEMO2"></a>DEMO2</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">(a)</span></span>&#123;</span><br><span class="line">  <span class="comment">// Create an empty structure channel with size 512</span></span><br><span class="line">  channel := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;,<span class="number">512</span>)</span><br><span class="line">  / / create a sync. WaitGroup</span><br><span class="line">  <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">  <span class="comment">// Wg is the length of Uins</span></span><br><span class="line">  wg.Add(<span class="built_in">len</span>(Uins))</span><br><span class="line">  for_,v:= <span class="keyword">range</span> Uins&#123;</span><br><span class="line">      channel &lt;- <span class="keyword">struct</span>&#123;&#125; &#123;&#125;<span class="comment">// Pass WG as a parameter to the coroutine</span></span><br><span class="line">      <span class="keyword">go</span> getUserInfo(v,channel,&amp;wg)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// block until wg is 0</span></span><br><span class="line">  wg.Wait()</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getUserInfo</span><span class="params">(v <span class="keyword">int</span>,channel <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;,wg *sync.WaitGroup)</span></span>&#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(a)</span></span> &#123;</span><br><span class="line">    	<span class="comment">// Wargaming is reduced by 1 before return</span></span><br><span class="line">        wg.Done()</span><br><span class="line">		&lt;-channel</span><br><span class="line">	&#125;()</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    ä¸šåŠ¡é€»è¾‘  </span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="DEMO3"><a href="#DEMO3" class="headerlink" title="DEMO3"></a>DEMO3</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	count := <span class="number">10</span></span><br><span class="line">	sum := <span class="number">100</span></span><br><span class="line">	wg := sync.WaitGroup&#123;&#125;</span><br><span class="line"></span><br><span class="line">	c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, count)</span><br><span class="line">	<span class="keyword">defer</span> <span class="built_in">close</span>(c)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;sum;i++&#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">			<span class="keyword">defer</span> wg.Done()</span><br><span class="line">			c &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">			fmt.Println(j)</span><br><span class="line">		&#125;(i)</span><br><span class="line">		&lt;- c</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="DEMO4"><a href="#DEMO4" class="headerlink" title="DEMO4"></a>DEMO4</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;math/rand&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	maxnum := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, <span class="number">5</span>)</span><br><span class="line">	setPool(maxnum)</span><br><span class="line"></span><br><span class="line">	wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">	wg.Add(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			wg.Wait()</span><br><span class="line">			fmt.Println(<span class="string">&quot;=======å‘æ”¾5ä¸ªä»»åŠ¡=========&quot;</span>)</span><br><span class="line">			setPool(maxnum)</span><br><span class="line">			wg.Add(<span class="number">5</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		&lt;-maxnum</span><br><span class="line">		 <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		 	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">		 	myJob()</span><br><span class="line">		 &#125;()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setPool</span><span class="params">(ch <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++ &#123;</span><br><span class="line">		ch &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myJob</span><span class="params">()</span></span> &#123;</span><br><span class="line">	time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line">	fmt.Println(rand.Intn(<span class="number">100</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2022/04/11/laravel-limit-chunk-collection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="è¦ä¹ˆåº¸ä¿—ï¼Œè¦ä¹ˆå­¤ç‹¬">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¤–è´¸ç‹¬ç«‹ç«™(æ—¥æœ¬)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/11/laravel-limit-chunk-collection/" class="post-title-link" itemprop="url">laravel-limit-chunk-collection</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-04-11 18:34:06 / ä¿®æ”¹æ—¶é—´ï¼š18:44:39" itemprop="dateCreated datePublished" datetime="2022-04-11T18:34:06+09:00">2022-04-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
Home is behind, world ahead.
</blockquote>

<p>Laravel comes up with an excellent Eloquent ORM. There are lot of cool things in Eloquent, one of which is chunk method.</p>
<p>Usually when you need to process large data, lets say you want to update users table and assign a coupon code based on 3rd party APIs.</p>
<p>What you can do is :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User::get()-&gt;each(<span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$user</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$coupon</span> = API::getCouponCode(<span class="variable">$user</span>-&gt;email);</span><br><span class="line">    <span class="variable">$user</span>-&gt;coupon = <span class="variable">$coupon</span>;</span><br><span class="line">    <span class="variable">$user</span>-&gt;save();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Doing this is good but if you have thousands of users, loading them all up at once to do the coupon saving process. Thatâ€™s going to take consume a hige memory at a time and maybe the server will be exusted because so much data is stored in memory for processing at a time.</p>
<p>The chunk method helps these kind of implementations. Chunking records means taking a batch of records by a limit, process those, take the next batch processing those and so onâ€¦ The idea is you are taking a subset of data to process at a time instead of entire data loaded into memory.</p>
<p>The chunk method will retrieve a â€œchunkâ€ of Eloquent models, feeding them to a given Closure for processing. Using the chunk method will conserve memory when working with large result sets.</p>
<p>Lets do the same but with chunk this time :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$recodsPerBatch</span> = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">User::chunk(<span class="variable">$recodsPerBatch</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$user</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$coupon</span> = API::getCouponCode(<span class="variable">$user</span>-&gt;email);</span><br><span class="line">    <span class="variable">$user</span>-&gt;coupon = <span class="variable">$coupon</span>;</span><br><span class="line">    <span class="variable">$user</span>-&gt;save();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Now, as you can probably guess this will take 50 user records at a time to process, once those are completed it will take next 50 untill all records are procesed by chunk closure.</p>
<ul>
<li>The main problem Limit with Chunk :</li>
</ul>
<p>Letâ€™s apply limit to the above example :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$recodsPerBatch</span> = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">User::limit(<span class="number">100</span>)-&gt;chunk(<span class="variable">$recodsPerBatch</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$user</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$coupon</span> = API::getCouponCode(<span class="variable">$user</span>-&gt;email);</span><br><span class="line">    <span class="variable">$user</span>-&gt;coupon = <span class="variable">$coupon</span>;</span><br><span class="line">    <span class="variable">$user</span>-&gt;save();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>If you would think laravel will chunk 50 records in 2 batches are we are limiting the total records to 100, oops not really.</p>
<p>Laravel will do series of queries like below to chunk the records :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span> `users` limit <span class="number">50</span> offset <span class="number">0</span></span><br><span class="line">select * <span class="keyword">from</span> `users` limit <span class="number">50</span> offset <span class="number">50</span></span><br><span class="line">select * <span class="keyword">from</span> `users` limit <span class="number">50</span> offset <span class="number">100</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>The chunk method ignores any previous eloquent method which applies limit. It can be limit and offset OR take and skipâ€¦</p>
<p>This becomes a problem for which lot of people had raised an issue on laravelâ€™s github repo. But Laravelâ€™s core dev team mentioned this is the expected behaviour and rightfully so.. Chunk itself is using limit to convert entire collection in batches.</p>
<ul>
<li>Andâ€¦. Here it is.. The Solution you were waiting for :</li>
</ul>
<p>Laravel has a chunk variation called chunkById. Letâ€™s use the first example and implement chunkById now :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$recodsPerBatch</span> = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">User::chunkById(<span class="variable">$recodsPerBatch</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$user</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$coupon</span> = API::getCouponCode(<span class="variable">$user</span>-&gt;email);</span><br><span class="line">    <span class="variable">$user</span>-&gt;coupon = <span class="variable">$coupon</span>;</span><br><span class="line">    <span class="variable">$user</span>-&gt;save();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The main and only fundamental difference between chunk and chunkById is how it structures the query.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span> `users` where `id` &gt; <span class="number">0</span> order by `id` asc limit <span class="number">50</span></span><br><span class="line">select * <span class="keyword">from</span> `users` where `id` &gt; <span class="number">0</span> <span class="keyword">and</span> `id` &gt; <span class="number">50</span> order by `id` asc limit <span class="number">50</span></span><br><span class="line">select * <span class="keyword">from</span> `users` where `id` &gt; <span class="number">0</span> <span class="keyword">and</span> `id` &gt; <span class="number">50</span> <span class="keyword">and</span> `id` &gt; <span class="number">100</span> order by `id` asc limit <span class="number">50</span></span><br><span class="line">select * <span class="keyword">from</span> `users` where `id` &gt; <span class="number">0</span> <span class="keyword">and</span> `id` &gt; <span class="number">50</span> <span class="keyword">and</span> `id` &gt; <span class="number">100</span> <span class="keyword">and</span> `id` &gt; <span class="number">150</span> order by `id` asc limit <span class="number">50</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>If you observer in the queries done by chunkById :</p>
<ul>
<li>Itâ€™s adding an order by clause to the id column (By the way you can specify the column as 3rd argument to chunkById method if itis not id)</li>
<li>It adds where id &gt; x each time it processes the next batch</li>
<li>There is no offset used and id column is used conceptually as an offset.</li>
</ul>
<p>This gives you an advantage that you can add your offset in the query using id column as a limit just like chunkById is doing internallu.</p>
<p>Letâ€™s limit the chunk in our example with 100 records to chunk :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$recodsPerBatch</span> = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$limit</span> = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$maxId</span> = User::orderBy(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;asc&#x27;</span>)-&gt;offset(<span class="variable">$limit</span>)-&gt;limit(<span class="number">1</span>)-&gt;select(<span class="string">&#x27;id&#x27;</span>)-&gt;first()-&gt;id;</span><br><span class="line"></span><br><span class="line">User::where(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="variable">$maxId</span>)-&gt;chunkById(<span class="variable">$recodsPerBatch</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$user</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$coupon</span> = API::getCouponCode(<span class="variable">$user</span>-&gt;email);</span><br><span class="line">    <span class="variable">$user</span>-&gt;coupon = <span class="variable">$coupon</span>;</span><br><span class="line">    <span class="variable">$user</span>-&gt;save();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>What we did was, even if we can not use limit directly, we got an id which falls just above the limit we want. Used that to add a where clause of <code>where(&#39;id&#39;, &#39;&lt;&#39;, $maxId)</code>.</p>
<p>This will then chunk the 100 results, with 2 batches of 50 records in each batch. Cool, isnâ€™t it!</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://techsemicolon.github.io/blog/2019/02/12/laravel-limiting-chunk-collection/">https://techsemicolon.github.io/blog/2019/02/12/laravel-limiting-chunk-collection/</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2022/04/11/shell%E8%84%9A%E6%9C%AC%E6%97%A0%E6%B3%95%E8%AF%BB%E5%8F%96%E6%9C%80%E5%90%8E%E4%B8%80%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="è¦ä¹ˆåº¸ä¿—ï¼Œè¦ä¹ˆå­¤ç‹¬">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¤–è´¸ç‹¬ç«‹ç«™(æ—¥æœ¬)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/11/shell%E8%84%9A%E6%9C%AC%E6%97%A0%E6%B3%95%E8%AF%BB%E5%8F%96%E6%9C%80%E5%90%8E%E4%B8%80%E8%A1%8C/" class="post-title-link" itemprop="url">shellè„šæœ¬æ— æ³•è¯»å–æœ€åä¸€è¡Œ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-04-11 15:29:13 / ä¿®æ”¹æ—¶é—´ï¼š15:38:28" itemprop="dateCreated datePublished" datetime="2022-04-11T15:29:13+09:00">2022-04-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
ä¸è¦åˆ°å¤„å®£æ‰¬è‡ªå·±çš„å†…å¿ƒï¼Œ

<p>è¿™ä¸–ä¸Šä¸æ­¢ä½ ä¸€ä¸ªäººæœ‰æ•…äº‹ã€‚</p>
</blockquote>


<h3 id="while-read-lineæ— æ³•è¯»å–æœ€åä¸€è¡Œ"><a href="#while-read-lineæ— æ³•è¯»å–æœ€åä¸€è¡Œ" class="headerlink" title="while read lineæ— æ³•è¯»å–æœ€åä¸€è¡Œ"></a>while read lineæ— æ³•è¯»å–æœ€åä¸€è¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    data=`...line...`</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;data&#125;</span>&quot;</span> &gt;&gt; <span class="variable">$2</span>.txt</span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$1</span></span><br></pre></td></tr></table></figure>

<h3 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h3><p>å› ä¸ºæˆ‘çš„ç›®æ ‡æ–‡ä»¶æ˜¯åœ¨windowsä¸‹åˆ›å»ºç„¶åä¼ åˆ°æœåŠ¡å™¨ä¸Šçš„ï¼Œè¿™æ ·åœ¨åˆ©ç”¨<code>while read line</code>è¯»å–æ–‡ä»¶æ—¶ï¼Œå¦‚æœæ–‡ä»¶æœ€åä¸€è¡Œä¹‹åæ²¡æœ‰æ¢è¡Œç¬¦\nï¼Œåˆ™readè¯»å–æœ€åä¸€è¡Œæ—¶é‡åˆ°æ–‡ä»¶ç»“æŸç¬¦EOFæ—¶å¾ªç¯å³ç»ˆæ­¢ã€‚ä¸Šé¢ä»£ç ä¸­ï¼Œè™½ç„¶æ­¤æ—¶$lineå†…å­˜æœ‰æœ€åä¸€è¡Œçš„å†…å®¹ï¼Œä½†ç¨‹åºå·²ç»æ²¡æœ‰æœºä¼šå†å¤„ç†æ­¤è¡Œå†…å®¹ï¼Œå› æ­¤å¯¼è‡´äº†æœ€åä¸€è¡Œæ— æ³•è¯»å–ã€‚</p>
<h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><h4 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h4><p>ä¿®æ”¹whileå¾ªç¯ï¼Œå¢åŠ  <code>[[ -n $&#123;line&#125; ]]</code>ï¼Œè¿™æ ·å½“æ–‡ä»¶æ²¡æœ‰åˆ°æœ€åä¸€è¡Œæ—¶ä¸ä¼šæµ‹è¯•<code>-n $line</code>ï¼Œå½“é‡åˆ°æ–‡ä»¶ç»“æŸï¼ˆæœ€åä¸€è¡Œï¼‰æ—¶ï¼Œä»ç„¶å¯ä»¥é€šè¿‡æµ‹è¯•$lineæ˜¯å¦æœ‰å†…å®¹æ¥è¿›è¡Œç»§ç»­å¤„ç†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line || [[ -n <span class="variable">$&#123;line&#125;</span> ]]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    data=`...line...`</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;data&#125;</span>&quot;</span> &gt;&gt; <span class="variable">$2</span>.txt</span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$1</span></span><br></pre></td></tr></table></figure>

<h4 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h4><p>é€šè¿‡åˆ†æåŸå› å¯çŸ¥ï¼Œæœ¬è´¨åŸå› æ˜¯å› ä¸ºæ–‡ä»¶æ ¼å¼ä¸æ˜¯unixå¯¼è‡´çš„ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡è®¾ç½®æ–‡ä»¶æ ¼å¼æ¥å¤„ç†ï¼Œè¯¥æ–¹å¼åˆ™è„šæœ¬ä»£ç ä¸éœ€æ”¹åŠ¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æœåŠ¡å™¨ä¸Švimç¼–è¾‘ç›®æ ‡æ–‡ä»¶</span></span><br><span class="line">vim target_file</span><br><span class="line"> </span><br><span class="line"><span class="comment"># ç„¶åæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼Œç”¨äºæŸ¥çœ‹å½“å‰æ–‡ä»¶æ˜¯dosæ ¼å¼è¿˜æ˜¯unixæ ¼å¼</span></span><br><span class="line">:<span class="built_in">set</span> ff?</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å¼ºåˆ¶åˆ‡æ¢ä¸ºunixæ ¼å¼ï¼Œç„¶åä¿å­˜å³å¯</span></span><br><span class="line">:<span class="built_in">set</span> ff=unix</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2022/03/24/Golang%E9%94%99%E8%AF%AF%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="è¦ä¹ˆåº¸ä¿—ï¼Œè¦ä¹ˆå­¤ç‹¬">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¤–è´¸ç‹¬ç«‹ç«™(æ—¥æœ¬)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/24/Golang%E9%94%99%E8%AF%AF%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">Golangé”™è¯¯å¼‚å¸¸å¤„ç†</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-03-24 00:24:46 / ä¿®æ”¹æ—¶é—´ï¼š12:02:50" itemprop="dateCreated datePublished" datetime="2022-03-24T00:24:46+09:00">2022-03-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
é‚£äº›çœ‹ä¼¼ä¸èµ·æ³¢æ¾œçš„æ—¥å¤ä¸€æ—¥ï¼Œä¼šçªç„¶åœ¨æŸä¸€å¤©è®©äººçœ‹åˆ°åšæŒçš„æ„ä¹‰ã€‚
</blockquote>


<h2 id="error"><a href="#error" class="headerlink" title="error"></a>error</h2><p>å¯¹äºGoè¯­è¨€ï¼ˆgolangï¼‰çš„é”™è¯¯è®¾è®¡ï¼Œç›¸ä¿¡å¾ˆå¤šäººå·²ç»ä½“éªŒè¿‡äº†ï¼Œå®ƒæ˜¯é€šè¿‡è¿”å›å€¼çš„æ–¹å¼ï¼Œæ¥å¼ºè¿«è°ƒç”¨è€…å¯¹é”™è¯¯è¿›è¡Œå¤„ç†ï¼Œè¦ä¹ˆä½ å¿½ç•¥ï¼Œè¦ä¹ˆä½ å¤„ç†ï¼ˆå¤„ç†ä¹Ÿå¯ä»¥æ˜¯ç»§ç»­è¿”å›ç»™è°ƒç”¨è€…ï¼‰ï¼Œå¯¹äºgolangè¿™ç§è®¾è®¡æ–¹å¼ï¼Œæˆ‘ä»¬ä¼šåœ¨ä»£ç ä¸­å†™å¤§é‡çš„ifåˆ¤æ–­ï¼Œä»¥ä¾¿åšå‡ºå†³å®šã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	conent,err:=ioutil.ReadFile(<span class="string">&quot;filepath&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err !=<span class="literal">nil</span>&#123;</span><br><span class="line">		<span class="comment">//é”™è¯¯å¤„ç†</span></span><br><span class="line">	&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="keyword">string</span>(conent))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="error-æ¥å£"><a href="#error-æ¥å£" class="headerlink" title="error æ¥å£"></a>error æ¥å£</h3><p>errorå…¶å®ä¸€ä¸ªæ¥å£ï¼Œå†…ç½®çš„ï¼Œæˆ‘ä»¬çœ‹ä¸‹å®ƒçš„å®šä¹‰</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The error built-in interface type is the conventional interface for</span></span><br><span class="line"><span class="comment">// representing an error condition, with the nil value representing no error.</span></span><br><span class="line"><span class="keyword">type</span> error <span class="keyword">interface</span> &#123;</span><br><span class="line">	Error() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ƒåªæœ‰ä¸€ä¸ªæ–¹æ³• Errorï¼Œåªè¦å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯å®ç°äº†errorã€‚ç°åœ¨æˆ‘ä»¬è‡ªå·±å®šä¹‰ä¸€ä¸ªé”™è¯¯è¯•è¯•ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> fileError <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(fe *fileError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;æ–‡ä»¶é”™è¯¯&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è‡ªå®šä¹‰-error"><a href="#è‡ªå®šä¹‰-error" class="headerlink" title="è‡ªå®šä¹‰ error"></a>è‡ªå®šä¹‰ error</h3><p>è‡ªå®šä¹‰äº†ä¸€ä¸ªfileErrorç±»å‹ï¼Œå®ç°äº†erroræ¥å£ã€‚ç°åœ¨æµ‹è¯•ä¸‹çœ‹çœ‹æ•ˆæœã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	conent, err := openFile()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="keyword">string</span>(conent))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åªæ˜¯æ¨¡æ‹Ÿä¸€ä¸ªé”™è¯¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">openFile</span><span class="params">()</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span>, &amp;fileError&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿è¡Œæ¨¡æ‹Ÿçš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶é”™è¯¯çš„é€šçŸ¥ã€‚</p>
<p>åœ¨å®é™…çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½é‡åˆ°å¾ˆå¤šé”™è¯¯ï¼Œä»–ä»¬çš„åŒºåˆ«æ˜¯é”™è¯¯ä¿¡æ¯ä¸ä¸€æ ·ï¼Œä¸€ç§åšæ³•æ˜¯æ¯ç§é”™è¯¯éƒ½ç±»ä¼¼ä¸Šé¢ä¸€æ ·å®šä¹‰ä¸€ä¸ªé”™è¯¯ç±»å‹ï¼Œä½†æ˜¯è¿™æ ·å¤ªéº»çƒ¦äº†ã€‚æˆ‘ä»¬å‘ç°Errorè¿”å›çš„å…¶å®æ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸‹ï¼Œè®©è¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥è®¾ç½®å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> fileError <span class="keyword">struct</span> &#123;</span><br><span class="line">	s <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(fe *fileError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fe.s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ©ï¼Œè¿™æ ·æ”¹é€ åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å£°æ˜fileErrorçš„æ—¶å€™ï¼Œè®¾ç½®å¥½è¦æç¤ºçš„é”™è¯¯æ–‡å­—ï¼Œå°±å¯ä»¥æ»¡è¶³æˆ‘ä»¬ä¸åŒçš„éœ€è¦äº†ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åªæ˜¯æ¨¡æ‹Ÿä¸€ä¸ªé”™è¯¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">openFile</span><span class="params">()</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span>, &amp;fileError&#123;<span class="string">&quot;æ–‡ä»¶é”™è¯¯ï¼Œè‡ªå®šä¹‰&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ©ï¼Œå¯ä»¥äº†ï¼Œå·²ç»è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®çš„ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥æŠŠå®ƒå˜çš„æ›´é€šç”¨ä¸€äº›ï¼Œæ¯”å¦‚ä¿®æ”¹fileErrorçš„åå­—ï¼Œå†åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œä¾¿äºæˆ‘ä»¬åˆ›å»ºä¸åŒçš„é”™è¯¯ç±»å‹ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(text <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;errorString&#123;text&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> errorString <span class="keyword">struct</span> &#123;</span><br><span class="line">	s <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *errorString)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> e.s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="panic"><a href="#panic" class="headerlink" title="panic"></a>panic</h2><p>error è¿”å›çš„æ˜¯ä¸€èˆ¬æ€§çš„é”™è¯¯ï¼Œä½†æ˜¯ panic å‡½æ•°è¿”å›çš„æ˜¯è®©ç¨‹åºå´©æºƒçš„é”™è¯¯ã€‚</p>
<p>ä¹Ÿå°±æ˜¯å½“é‡åˆ°ä¸å¯æ¢å¤çš„é”™è¯¯çŠ¶æ€çš„æ—¶å€™ï¼Œå¦‚æ•°ç»„è®¿é—®è¶Šç•Œã€ç©ºæŒ‡é’ˆå¼•ç”¨ç­‰ï¼Œè¿™äº›è¿è¡Œæ—¶é”™è¯¯ä¼šå¼•èµ· painc å¼‚å¸¸ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸åº”é€šè¿‡è°ƒç”¨ panic å‡½æ•°æ¥æŠ¥å‘Šæ™®é€šçš„é”™è¯¯ï¼Œè€Œåº”è¯¥åªæŠŠå®ƒä½œä¸ºæŠ¥å‘Šè‡´å‘½é”™è¯¯çš„ä¸€ç§æ–¹å¼ã€‚å½“æŸäº›ä¸åº”è¯¥å‘ç”Ÿçš„åœºæ™¯å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬å°±åº”è¯¥è°ƒç”¨ panicã€‚</p>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œå½“ panic å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œç¨‹åºä¼šä¸­æ–­è¿è¡Œã€‚éšåï¼Œç¨‹åºå´©æºƒå¹¶è¾“å‡ºæ—¥å¿—ä¿¡æ¯ã€‚æ—¥å¿—ä¿¡æ¯åŒ…æ‹¬ panic value å’Œå‡½æ•°è°ƒç”¨çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœç›´æ¥è°ƒç”¨å†…ç½®çš„ panic å‡½æ•°ä¹Ÿä¼šå¼•å‘ panic å¼‚å¸¸ï¼›panic å‡½æ•°æ¥å—ä»»ä½•å€¼ä½œä¸ºå‚æ•°ã€‚</p>
<h3 id="ç›´æ¥è°ƒç”¨-panic-å‡½æ•°"><a href="#ç›´æ¥è°ƒç”¨-panic-å‡½æ•°" class="headerlink" title="ç›´æ¥è°ƒç”¨ panic å‡½æ•°"></a>ç›´æ¥è°ƒç”¨ panic å‡½æ•°</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestA</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;func TestA()&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestB</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;throw error&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestC</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;func TestC()&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    TestA()</span><br><span class="line">    TestB()</span><br><span class="line">    TestC()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­å¹¶ä¸ä¼šç›´æ¥è°ƒç”¨ panic ( ) å‡½æ•°ï¼Œä½†æ˜¯å½“æˆ‘ä»¬ç¼–ç¨‹çš„ç¨‹åºé‡åˆ°è‡´å‘½é”™è¯¯æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨è¯¥å‡½æ•°æ¥ç»ˆæ­¢æ•´ä¸ªç¨‹åºçš„è¿è¡Œï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿå†…ç½®äº† panic å‡½æ•°ã€‚</p>
<h3 id="æ•°ç»„ä¸‹æ ‡è¶Šç•Œçš„é—®é¢˜"><a href="#æ•°ç»„ä¸‹æ ‡è¶Šç•Œçš„é—®é¢˜" class="headerlink" title="æ•°ç»„ä¸‹æ ‡è¶Šç•Œçš„é—®é¢˜"></a>æ•°ç»„ä¸‹æ ‡è¶Šç•Œçš„é—®é¢˜</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestA</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;func TestA()&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestB</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> a [<span class="number">10</span>] <span class="keyword">int</span></span><br><span class="line">    a[x] = <span class="number">222</span> <span class="comment">// x å€¼ä¸º11æ—¶å€™ï¼Œæ•°ç»„è¶Šç•Œ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestC</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;func TestC()&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    TestA()</span><br><span class="line">    TestB(<span class="number">11</span>)  <span class="comment">// TestB() å‘ç”Ÿå¼‚å¸¸ ä¸­æ–­ç¨‹åº</span></span><br><span class="line">    TestC()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="recover"><a href="#recover" class="headerlink" title="recover"></a>recover</h2><p>è¿è¡Œæ—¶ panic å¼‚å¸¸ä¸€æ—¦è¢«å¼•å‘å°±ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚è¿™å½“ç„¶ä¸æ˜¯æˆ‘ä»¬æ„¿æ„çœ‹åˆ°çš„ï¼Œå› ä¸ºè°ä¹Ÿä¸èƒ½ä¿è¯ç¨‹åºä¸ä¼šå‘ç”Ÿä»»ä½•è¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<p>Go è¯­è¨€ä¸ºæˆ‘ä»¬æä¾›äº†ä¸“ç”¨äº â€œæ‹¦æˆªâ€ è¿è¡Œæ—¶ panic çš„å†…å»ºå‡½æ•° â€”â€”recoverã€‚å®ƒå¯ä»¥æ˜¯å½“å‰çš„ç¨‹åºä»è¿è¡Œæ—¶ panic çš„çŠ¶æ€ä¸­æ¢å¤å¹¶é‡æ–°è·å¾—æµç¨‹æ§åˆ¶æƒã€‚</p>
<p>æ³¨æ„ï¼šrecover åªæœ‰åœ¨ defer è°ƒç”¨çš„å‡½æ•°ä¸­æœ‰æ•ˆã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestA</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;func TestA()&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestB</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// è®¾ç½®recover</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="built_in">recover</span>()</span><br><span class="line">	&#125;() <span class="comment">// è‡ªè°ƒç”¨æ”¹åŒ¿åå‡½æ•°</span></span><br><span class="line">	<span class="keyword">var</span> a [<span class="number">10</span>] <span class="keyword">int</span></span><br><span class="line">	a[x] = <span class="number">111</span> <span class="comment">// å½“xä¸º20 çš„æ—¶å€™ï¼Œå¯¼è‡´æ•°ç»„è¶Šç•Œï¼Œäº§ç”Ÿpaniï¼Œå¯¼è‡´ç¨‹åºå´©æºƒ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestC</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;func TestC()&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	TestA()</span><br><span class="line">	TestB(<span class="number">11</span>)  <span class="comment">// TestB() å‘ç”Ÿå¼‚å¸¸ ä¸­æ–­ç¨‹åº</span></span><br><span class="line">	TestC()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä»¥ä¸Šç¨‹åºï¼Œæˆ‘ä»¬å‘ç°è™½ç„¶ TestB () å‡½æ•°ä¼šå¯¼è‡´æ•´ä¸ªåº”ç”¨ç¨‹åºå´©æºƒï¼Œä½†æ˜¯ç”±äºåœ¨æ”¹å‡½æ•°ä¸­è°ƒç”¨äº† recover () å‡½æ•°ï¼Œæ‰€ä»¥æ•´ä¸ªå‡½æ•°å¹¶æ²¡æœ‰å´©æºƒã€‚è™½ç„¶ç¨‹åºæ²¡æœ‰å´©æºƒï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿæ²¡æœ‰çœ‹åˆ°ä»»ä½•çš„æç¤ºä¿¡æ¯ï¼Œé‚£ä¹ˆæ€æ ·æ‰èƒ½å¤Ÿçœ‹åˆ°ç›¸åº”çš„æç¤ºä¿¡æ¯å‘¢ï¼Ÿ</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestA</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;func TestA()&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestB</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// è®¾ç½®recover</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123; <span class="comment">// äº§ç”Ÿäº†panic å¼‚å¸¸</span></span><br><span class="line">			fmt.Println(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;() <span class="comment">// è‡ªè°ƒç”¨æ”¹åŒ¿åå‡½æ•°</span></span><br><span class="line">	<span class="keyword">var</span> a [<span class="number">10</span>] <span class="keyword">int</span></span><br><span class="line">	a[x] = <span class="number">111</span> <span class="comment">// å½“xä¸º20 çš„æ—¶å€™ï¼Œå¯¼è‡´æ•°ç»„è¶Šç•Œï¼Œäº§ç”Ÿpanicï¼Œå¯¼è‡´ç¨‹åºå´©æºƒ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestC</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;func TestC()&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	TestA()</span><br><span class="line">	TestB(<span class="number">1111</span>)  <span class="comment">// TestB() ä¸è®©ä»–è¶Šç•Œ</span></span><br><span class="line">	TestC()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<blockquote>
<p><a target="_blank" rel="noopener" href="https://xuhy.top/posts/develop/go/go-lesson/go-lesson07/">https://xuhy.top/posts/develop/go/go-lesson/go-lesson07/</a><br><a target="_blank" rel="noopener" href="https://learnku.com/docs/qianxi-golang/2020/section-2-panic-function/6444#ed4f2f">https://learnku.com/docs/qianxi-golang/2020/section-2-panic-function/6444#ed4f2f</a><br><a target="_blank" rel="noopener" href="https://www.flysnow.org/2019/01/01/golang-error-handle-suggestion.html">https://www.flysnow.org/2019/01/01/golang-error-handle-suggestion.html</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2022/02/28/golang%E4%B8%ADembed%E7%AE%80%E5%8D%95%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="è¦ä¹ˆåº¸ä¿—ï¼Œè¦ä¹ˆå­¤ç‹¬">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¤–è´¸ç‹¬ç«‹ç«™(æ—¥æœ¬)">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/02/28/golang%E4%B8%ADembed%E7%AE%80%E5%8D%95%E7%94%A8%E6%B3%95/" class="post-title-link" itemprop="url">golangä¸­embedç®€å•ç”¨æ³•</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-02-28 21:11:17" itemprop="dateCreated datePublished" datetime="2022-02-28T21:11:17+09:00">2022-02-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">æ›´æ–°äº</span>
        <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-03-24 00:23:20" itemprop="dateModified" datetime="2022-03-24T00:23:20+09:00">2022-03-24</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
æ— èŠæ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œä¸€ä¸ªäººåœ¨ç©ºç™½æ—¶é—´æ‰€åšçš„äº‹ï¼Œå†³å®šäº†è¿™ä¸ªäººå’Œä»–äººæ ¹æœ¬çš„ä¸åŒã€‚
</blockquote>


<p>Goç¼–è¯‘çš„ç¨‹åºéå¸¸é€‚åˆéƒ¨ç½²ï¼Œå¦‚æœæ²¡æœ‰é€šè¿‡CGOå¼•ç”¨å…¶å®ƒçš„åº“çš„è¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç¼–è¯‘å‡ºæ¥çš„å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶éƒ½æ˜¯å•ä¸ªçš„æ–‡ä»¶ï¼Œéå¸¸é€‚åˆå¤åˆ¶å’Œéƒ¨ç½²ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œé™¤äº†äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯èƒ½è¿˜éœ€è¦ä¸€äº›é…ç½®æ–‡ä»¶ï¼Œæˆ–è€…é™æ€æ–‡ä»¶ï¼Œæ¯”å¦‚htmlæ¨¡æ¿ã€é™æ€çš„å›¾ç‰‡ã€CSSã€javascriptç­‰æ–‡ä»¶ï¼Œå¦‚ä½•è¿™äº›æ–‡ä»¶ä¹Ÿèƒ½æ‰“è¿›åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œé‚£å°±å¤ªç¾å¦™ï¼Œæˆ‘ä»¬åªéœ€å¤åˆ¶ã€æŒ‰ç…§å•ä¸ªçš„å¯æ‰§è¡Œæ–‡ä»¶å³å¯ã€‚</p>
<h2 id="åµŒå…¥"><a href="#åµŒå…¥" class="headerlink" title="åµŒå…¥"></a>åµŒå…¥</h2><h3 id="åµŒå…¥ä¸ºå­—ç¬¦ä¸²"><a href="#åµŒå…¥ä¸ºå­—ç¬¦ä¸²" class="headerlink" title="åµŒå…¥ä¸ºå­—ç¬¦ä¸²"></a>åµŒå…¥ä¸ºå­—ç¬¦ä¸²</h3><p>æ¯”å¦‚å½“å‰æ–‡ä»¶ä¸‹æœ‰ä¸ªhello.txtçš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ºhello,world!ã€‚é€šè¿‡go:embedæŒ‡ä»¤ï¼Œåœ¨ç¼–è¯‘åä¸‹é¢ç¨‹åºä¸­çš„så˜é‡çš„å€¼å°±å˜ä¸ºäº†hello,world!ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	_ <span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed hello.txt</span></span><br><span class="line"><span class="keyword">var</span> s <span class="keyword">string</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åµŒå…¥ä¸ºbyte-slice"><a href="#åµŒå…¥ä¸ºbyte-slice" class="headerlink" title="åµŒå…¥ä¸ºbyte slice"></a>åµŒå…¥ä¸ºbyte slice</h3><p>ä½ è¿˜å¯ä»¥æŠŠå•ä¸ªæ–‡ä»¶çš„å†…å®¹åµŒå…¥ä¸ºslice of byteï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	_ <span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed hello.txt</span></span><br><span class="line"><span class="keyword">var</span> b []<span class="keyword">byte</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åµŒå…¥ä¸ºfs-FS"><a href="#åµŒå…¥ä¸ºfs-FS" class="headerlink" title="åµŒå…¥ä¸ºfs.FS"></a>åµŒå…¥ä¸ºfs.FS</h3><p>ç”šè‡³ä½ å¯ä»¥åµŒå…¥ä¸ºä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè¿™åœ¨åµŒå…¥å¤šä¸ªæ–‡ä»¶çš„æ—¶å€™éå¸¸æœ‰ç”¨ã€‚<br>æ¯”å¦‚åµŒå…¥ä¸€ä¸ªæ–‡ä»¶ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed hello.txt</span></span><br><span class="line"><span class="keyword">var</span> f embed.FS</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	data, _ := f.ReadFile(<span class="string">&quot;hello.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åµŒå…¥æœ¬åœ°çš„å¦å¤–ä¸€ä¸ªæ–‡ä»¶hello2.txt, æ”¯æŒåŒä¸€ä¸ªå˜é‡ä¸Šå¤šä¸ªgo:embedæŒ‡ä»¤(åµŒå…¥ä¸ºstringæˆ–è€…byte sliceæ˜¯ä¸èƒ½æœ‰å¤šä¸ªgo:embedæŒ‡ä»¤çš„):</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed hello.txt</span></span><br><span class="line"><span class="comment">//go:embed hello2.txt</span></span><br><span class="line"><span class="keyword">var</span> f embed.FS</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	data, _ := f.ReadFile(<span class="string">&quot;hello.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">	data, _ = f.ReadFile(<span class="string">&quot;hello2.txt&quot;</span>)</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“å‰é‡å¤çš„go:embedæŒ‡ä»¤åµŒå…¥ä¸ºembed.FSæ˜¯æ”¯æŒçš„ï¼Œç›¸å½“äºä¸€ä¸ª:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed hello.txt</span></span><br><span class="line"><span class="comment">//go:embed hello.txt</span></span><br><span class="line"><span class="keyword">var</span> f embed.FS</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	data, _ := f.ReadFile(<span class="string">&quot;hello.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥åµŒå…¥å­æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed p/hello.txt</span></span><br><span class="line"><span class="comment">//go:embed p/hello2.txt</span></span><br><span class="line"><span class="keyword">var</span> f embed.FS</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	data, _ := f.ReadFile(<span class="string">&quot;p/hello.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">	data, _ = f.ReadFile(<span class="string">&quot;p/hello2.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åŒä¸€ä¸ªæ–‡ä»¶åµŒå…¥ä¸ºå¤šä¸ªå˜é‡"><a href="#åŒä¸€ä¸ªæ–‡ä»¶åµŒå…¥ä¸ºå¤šä¸ªå˜é‡" class="headerlink" title="åŒä¸€ä¸ªæ–‡ä»¶åµŒå…¥ä¸ºå¤šä¸ªå˜é‡"></a>åŒä¸€ä¸ªæ–‡ä»¶åµŒå…¥ä¸ºå¤šä¸ªå˜é‡</h3><p>æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œså’Œs2å˜é‡éƒ½åµŒå…¥hello.txtçš„æ–‡ä»¶ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	_ <span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed hello.txt</span></span><br><span class="line"><span class="keyword">var</span> s <span class="keyword">string</span></span><br><span class="line"><span class="comment">//go:embed hello.txt</span></span><br><span class="line"><span class="keyword">var</span> s2 <span class="keyword">string</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(s)</span><br><span class="line">	fmt.Println(s2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="exported-unexportedçš„å˜é‡éƒ½æ”¯æŒ"><a href="#exported-unexportedçš„å˜é‡éƒ½æ”¯æŒ" class="headerlink" title="exported/unexportedçš„å˜é‡éƒ½æ”¯æŒ"></a>exported/unexportedçš„å˜é‡éƒ½æ”¯æŒ</h3><p>Goå¯ä»¥å°†æ–‡ä»¶å¯ä»¥åµŒå…¥ä¸ºexportedçš„å˜é‡ï¼Œä¹Ÿå¯ä»¥åµŒå…¥ä¸ºunexportedçš„å˜é‡ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	_ <span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed hello.txt</span></span><br><span class="line"><span class="keyword">var</span> s <span class="keyword">string</span></span><br><span class="line"><span class="comment">//go:embed hello2.txt</span></span><br><span class="line"><span class="keyword">var</span> S <span class="keyword">string</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(s)</span><br><span class="line">	fmt.Println(S)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="packageçº§åˆ«çš„å˜é‡å’Œå±€éƒ¨å˜é‡éƒ½æ”¯æŒ"><a href="#packageçº§åˆ«çš„å˜é‡å’Œå±€éƒ¨å˜é‡éƒ½æ”¯æŒ" class="headerlink" title="packageçº§åˆ«çš„å˜é‡å’Œå±€éƒ¨å˜é‡éƒ½æ”¯æŒ"></a>packageçº§åˆ«çš„å˜é‡å’Œå±€éƒ¨å˜é‡éƒ½æ”¯æŒ</h3><p>å‰é¢çš„ä¾‹å­éƒ½æ˜¯packageä¸€çº§çš„çš„å˜é‡ï¼Œå³ä½¿æ˜¯å‡½æ•°å†…çš„å±€éƒ¨å˜é‡ï¼Œä¹Ÿéƒ½æ”¯æŒåµŒå…¥ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	_ <span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//go:embed hello.txt</span></span><br><span class="line">	<span class="keyword">var</span> s <span class="keyword">string</span></span><br><span class="line">	<span class="comment">//go:embed hello.txt</span></span><br><span class="line">	<span class="keyword">var</span> s2 <span class="keyword">string</span></span><br><span class="line">	fmt.Println(s, s2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å±€éƒ¨å˜é‡sçš„å€¼åœ¨ç¼–è¯‘æ—¶å°±å·²ç»åµŒå…¥äº†ï¼Œè€Œä¸”è™½ç„¶så’Œs2åµŒå…¥åŒä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å®ƒä»¬çš„å€¼åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šä½¿ç”¨åˆå§‹åŒ–å­—æ®µä¸­çš„ä¸åŒçš„å€¼</p>
<h3 id="åªè¯»"><a href="#åªè¯»" class="headerlink" title="åªè¯»"></a>åªè¯»</h3><p>åµŒå…¥çš„å†…å®¹æ˜¯åªè¯»çš„ã€‚ä¹Ÿå°±æ˜¯åœ¨ç¼–è¯‘æœŸåµŒå…¥æ–‡ä»¶çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Œé‚£ä¹ˆåœ¨è¿è¡Œæ—¶çš„å†…å®¹ä¹Ÿå°±æ˜¯ä»€ä¹ˆã€‚</p>
<p>FSæ–‡ä»¶ç³»ç»Ÿå€¼æä¾›äº†æ‰“å¼€å’Œè¯»å–çš„æ–¹æ³•ï¼Œå¹¶æ²¡æœ‰writeçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´FSå®ä¾‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šä¸ªgoroutineå¯ä»¥å¹¶å‘ä½¿ç”¨ã€‚</p>
<h2 id="go-embedæŒ‡ä»¤"><a href="#go-embedæŒ‡ä»¤" class="headerlink" title="go:embedæŒ‡ä»¤"></a>go:embedæŒ‡ä»¤</h2><h3 id="go-embedæŒ‡ä»¤æ”¯æŒåµŒå…¥å¤šä¸ªæ–‡ä»¶"><a href="#go-embedæŒ‡ä»¤æ”¯æŒåµŒå…¥å¤šä¸ªæ–‡ä»¶" class="headerlink" title="go:embedæŒ‡ä»¤æ”¯æŒåµŒå…¥å¤šä¸ªæ–‡ä»¶"></a>go:embedæŒ‡ä»¤æ”¯æŒåµŒå…¥å¤šä¸ªæ–‡ä»¶</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed hello.txt hello2.txt</span></span><br><span class="line"><span class="keyword">var</span> f embed.FS</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	data, _ := f.ReadFile(<span class="string">&quot;hello.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">	data, _ = f.ReadFile(<span class="string">&quot;hello2.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥åƒå‰é¢çš„ä¾‹å­ä¸€æ ·å†™æˆå¤šè¡Œgo:embed:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed hello.txt</span></span><br><span class="line"><span class="comment">//go:embed hello2.txt</span></span><br><span class="line"><span class="keyword">var</span> f embed.FS</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	data, _ := f.ReadFile(<span class="string">&quot;hello.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">	data, _ = f.ReadFile(<span class="string">&quot;hello2.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ”¯æŒæ–‡ä»¶å¤¹"><a href="#æ”¯æŒæ–‡ä»¶å¤¹" class="headerlink" title="æ”¯æŒæ–‡ä»¶å¤¹"></a>æ”¯æŒæ–‡ä»¶å¤¹</h3><p>æ–‡ä»¶å¤¹åˆ†éš”ç¬¦é‡‡ç”¨æ­£æ–œæ /,å³ä½¿æ˜¯windowsç³»ç»Ÿä¹Ÿé‡‡ç”¨è¿™ä¸ªæ¨¡å¼ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed p</span></span><br><span class="line"><span class="keyword">var</span> f embed.FS</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	data, _ := f.ReadFile(<span class="string">&quot;p/hello.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">	data, _ = f.ReadFile(<span class="string">&quot;p/hello2.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„"><a href="#ä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„" class="headerlink" title="ä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„"></a>ä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„</h3><p>ç›¸å¯¹è·¯å¾„çš„æ ¹è·¯å¾„æ˜¯goæºæ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹ã€‚</p>
<p>æ”¯æŒä½¿ç”¨åŒå¼•å·â€æˆ–è€…åå¼•å·çš„æ–¹å¼åº”ç”¨åˆ°åµŒå…¥çš„æ–‡ä»¶åæˆ–è€…æ–‡ä»¶å¤¹åæˆ–è€…æ¨¡å¼åä¸Šï¼Œè¿™å¯¹åç§°ä¸­å¸¦ç©ºæ ¼æˆ–è€…ç‰¹æ®Šå­—ç¬¦çš„æ–‡ä»¶æ–‡ä»¶å¤¹æœ‰ç”¨ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed &quot;he llo.txt&quot; `hello-2.txt`</span></span><br><span class="line"><span class="keyword">var</span> f embed.FS</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	data, _ := f.ReadFile(<span class="string">&quot;he llo.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åŒ¹é…æ¨¡å¼"><a href="#åŒ¹é…æ¨¡å¼" class="headerlink" title="åŒ¹é…æ¨¡å¼"></a>åŒ¹é…æ¨¡å¼</h3><p><code>go:embed</code>æŒ‡ä»¤ä¸­å¯ä»¥åªå†™æ–‡ä»¶å¤¹åï¼Œæ­¤æ–‡ä»¶å¤¹ä¸­é™¤äº†<code>.</code>å’Œ<code>_</code>å¼€å¤´çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹éƒ½ä¼šè¢«åµŒå…¥ï¼Œå¹¶ä¸”å­æ–‡ä»¶å¤¹ä¹Ÿä¼šè¢«é€’å½’çš„åµŒå…¥ï¼Œå½¢æˆä¸€ä¸ªæ­¤æ–‡ä»¶å¤¹çš„æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p>å¦‚æœæƒ³åµŒå…¥<code>.</code>å’Œ<code>_</code>å¼€å¤´çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œ æ¯”å¦‚<code>p</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>.hello.txt</code>æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨<code>*</code>ï¼Œæ¯”å¦‚<code>go:embed p/*</code>ã€‚</p>
<p><em>ä¸å…·æœ‰é€’å½’æ€§ï¼Œæ‰€ä»¥å­æ–‡ä»¶å¤¹ä¸‹çš„.å’Œ_ä¸ä¼šè¢«åµŒå…¥ï¼Œé™¤éä½ åœ¨ä¸“é—¨ä½¿ç”¨å­æ–‡ä»¶å¤¹çš„</em>è¿›è¡ŒåµŒå…¥</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed p/*</span></span><br><span class="line"><span class="keyword">var</span> f embed.FS</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	data, _ := f.ReadFile(<span class="string">&quot;p/.hello.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">	data, _ = f.ReadFile(<span class="string">&quot;p/q/.hi.txt&quot;</span>) <span class="comment">// æ²¡æœ‰åµŒå…¥ p/q/.hi.txt</span></span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åµŒå…¥å’ŒåµŒå…¥æ¨¡å¼ä¸æ”¯æŒç»å¯¹è·¯å¾„ã€ä¸æ”¯æŒè·¯å¾„ä¸­åŒ…å«.å’Œ..,å¦‚æœæƒ³åµŒå…¥goæºæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ï¼Œä½¿ç”¨<code>*</code>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed *</span></span><br><span class="line"><span class="keyword">var</span> f embed.FS</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	data, _ := f.ReadFile(<span class="string">&quot;hello.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">	data, _ = f.ReadFile(<span class="string">&quot;.hello.txt&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h2><p>embed.FSå®ç°äº† io/fs.FSæ¥å£ï¼Œå®ƒå¯ä»¥æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿”å›fs.File:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed *</span></span><br><span class="line"><span class="keyword">var</span> f embed.FS</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	helloFile, _ := f.Open(<span class="string">&quot;hello.txt&quot;</span>)</span><br><span class="line">	stat, _ := helloFile.Stat()</span><br><span class="line">	fmt.Println(stat.Name(), stat.Size())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ƒè¿˜æä¾›äº†ReadFilehå’ŒReadDiråŠŸèƒ½ï¼Œéå†ä¸€ä¸ªæ–‡ä»¶ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ä¿¡æ¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed *</span></span><br><span class="line"><span class="keyword">var</span> f embed.FS</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	dirEntries, _ := f.ReadDir(<span class="string">&quot;p&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> _, de := <span class="keyword">range</span> dirEntries &#123;</span><br><span class="line">		fmt.Println(de.Name(), de.IsDir())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºå®ƒå®ç°äº†io/fs.FSæ¥å£ï¼Œæ‰€ä»¥å¯ä»¥è¿”å›å®ƒçš„å­æ–‡ä»¶å¤¹ä½œä¸ºæ–°çš„æ–‡ä»¶ç³»ç»Ÿï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/fs&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//go:embed *</span></span><br><span class="line"><span class="keyword">var</span> f embed.FS</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ps, _ := fs.Sub(f, <span class="string">&quot;p&quot;</span>)</span><br><span class="line">	hi, _ := ps.Open(<span class="string">&quot;q/hi.txt&quot;</span>)</span><br><span class="line">	data, _ := ioutil.ReadAll(hi)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><h3 id="net-http"><a href="#net-http" class="headerlink" title="net/http"></a>net/http</h3><p>å…ˆå‰ï¼Œæˆ‘ä»¬æä¾›ä¸€ä¸ªé™æ€æ–‡ä»¶çš„æœåŠ¡æ—¶ï¼Œä½¿ç”¨ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http.Handle(<span class="string">&quot;/&quot;</span>, http.FileServer(http.Dir(<span class="string">&quot;/tmp&quot;</span>)))</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œio/fs.FSæ–‡ä»¶ç³»ç»Ÿä¹Ÿå¯ä»¥è½¬æ¢æˆhttp.FileServerçš„å‚æ•°äº†:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> FileSystem</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">FS</span><span class="params">(fsys fs.FS)</span> <span class="title">FileSystem</span></span></span><br><span class="line"><span class="keyword">type</span> Handler</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">FileServer</span><span class="params">(root FileSystem)</span> <span class="title">Handler</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ï¼ŒåµŒå…¥æ–‡ä»¶å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http.Handle(<span class="string">&quot;/&quot;</span>, http.FileServer(http.FS(fsys)))</span><br></pre></td></tr></table></figure>
<h3 id="text-templateå’Œhtml-template"><a href="#text-templateå’Œhtml-template" class="headerlink" title="text/templateå’Œhtml/template."></a>text/templateå’Œhtml/template.</h3><p>åŒæ ·çš„,templateä¹Ÿå¯ä»¥ä»åµŒå…¥çš„æ–‡ä»¶ç³»ç»Ÿä¸­è§£ææ¨¡æ¿ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ParseFS</span><span class="params">(fsys fs.FS, patterns ...<span class="keyword">string</span>)</span> <span class="params">(*Template, error)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *Template)</span> <span class="title">ParseFS</span><span class="params">(fsys fs.FS, patterns ...<span class="keyword">string</span>)</span> <span class="params">(*Template, error)</span></span></span><br></pre></td></tr></table></figure>


<blockquote>
<p><a target="_blank" rel="noopener" href="https://colobu.com/2021/01/17/go-embed-tutorial/">https://colobu.com/2021/01/17/go-embed-tutorial/</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/42/">42</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lnmput@gmail.com</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
