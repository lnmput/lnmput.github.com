<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"swoole.app","root":"/","images":"/images","scheme":"Gemini","version":"8.7.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="不要太在意别人说的话，因为他们有嘴，但不一定有脑子   In more advanced projects you will soon realize that relation lists&#x2F;forms and in general the whole RelationController is lacking funcionality. One of those things that are">
<meta property="og:type" content="article">
<meta property="og:title" content="OctoberCms-Relation-Lists-With-Filters">
<meta property="og:url" content="https://swoole.app/2023/03/02/OctoberCms-Relation-Lists-With-Filters/index.html">
<meta property="og:site_name" content="外贸独立站(日本)">
<meta property="og:description" content="不要太在意别人说的话，因为他们有嘴，但不一定有脑子   In more advanced projects you will soon realize that relation lists&#x2F;forms and in general the whole RelationController is lacking funcionality. One of those things that are">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-03-02T14:55:19.000Z">
<meta property="article:modified_time" content="2023-03-03T02:00:18.328Z">
<meta property="article:author" content="lnmput@gmail.com">
<meta property="article:tag" content="OctoberCMS">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://swoole.app/2023/03/02/OctoberCms-Relation-Lists-With-Filters/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://swoole.app/2023/03/02/OctoberCms-Relation-Lists-With-Filters/","path":"2023/03/02/OctoberCms-Relation-Lists-With-Filters/","title":"OctoberCms-Relation-Lists-With-Filters"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>OctoberCms-Relation-Lists-With-Filters | 外贸独立站(日本)</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">外贸独立站(日本)</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">专注外贸独立站建设</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-首页"><a href="/" rel="section">首页</a></li>
        <li class="menu-item menu-item-标签"><a href="/tags" rel="section">标签</a></li>
        <li class="menu-item menu-item-读书"><a href="/read" rel="section">读书</a></li>
        <li class="menu-item menu-item-翻译"><a href="/tags/translate" rel="section">翻译</a></li>
        <li class="menu-item menu-item-关于我"><a href="/about" rel="section">关于我</a></li>
        <li class="menu-item menu-item-外贸站"><a href="/site" rel="section">外贸站</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lnmput@gmail.com"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">lnmput@gmail.com</p>
  <div class="site-description" itemprop="description">要么庸俗，要么孤独</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">419</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">135</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://octobercms.com/" title="octobercms → https:&#x2F;&#x2F;octobercms.com&#x2F;" rel="noopener" target="_blank">octobercms</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://medium.com/" title="medium → https:&#x2F;&#x2F;medium.com&#x2F;" rel="noopener" target="_blank">medium</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/lnmput" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swoole.app/2023/03/02/OctoberCms-Relation-Lists-With-Filters/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="lnmput@gmail.com">
      <meta itemprop="description" content="要么庸俗，要么孤独">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="外贸独立站(日本)">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          OctoberCms-Relation-Lists-With-Filters
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-03-02 23:55:19" itemprop="dateCreated datePublished" datetime="2023-03-02T23:55:19+09:00">2023-03-02</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-03-03 11:00:18" itemprop="dateModified" datetime="2023-03-03T11:00:18+09:00">2023-03-03</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <blockquote class="blockquote-center">
不要太在意别人说的话，因为他们有嘴，但不一定有脑子
</blockquote>

<p>In more advanced projects you will soon realize that relation lists/forms and in general the whole RelationController is lacking funcionality. One of those things that are missing are filters in the relation list. But fear not, you can render lists and forms manually and then you can add filters to it. The best place to start with manual lists are these two tutorials: <a target="_blank" rel="noopener" href="https://octobercms.com/support/article/ob-21">https://octobercms.com/support/article/ob-21</a><br><a target="_blank" rel="noopener" href="https://octobercms.com/support/article/ob-20">https://octobercms.com/support/article/ob-20</a></p>
<p>But they only cover how to make a simple list rendered by hand in a partial and without filters. What I will cover in this article is how to do the same but using ListController (to render the list with filters for us automatically).</p>
<p>OctoberCMS - Relation lists with filters [HOWTO]<br>OctoberCMS | Date: Sep 23, 2018</p>
<p>In more advanced projects you will soon realize that relation lists/forms and in general the whole RelationController is lacking funcionality. One of those things that are missing are filters in the relation list. But fear not, you can render lists and forms manually and then you can add filters to it. The best place to start with manual lists are these two tutorials: <a target="_blank" rel="noopener" href="https://octobercms.com/support/article/ob-21">https://octobercms.com/support/article/ob-21</a><br><a target="_blank" rel="noopener" href="https://octobercms.com/support/article/ob-20">https://octobercms.com/support/article/ob-20</a></p>
<p>But they only cover how to make a simple list rendered by hand in a partial and without filters. What I will cover in this article is how to do the same but using ListController (to render the list with filters for us automatically).</p>
<p>Once you know the formula this is a pretty easy process. But I recon that getting there by yourself can be a painfull process (it was for me). After seeing the tutorial videos you would probably dive into the Behaviours and ListController to see how October does it because the documentation is still lacking. But it also has some good sides, you need to consciously code your plugins, you can’t just paste random code form internet and make a plugin out of it. In other words, your code quality will be by default higher than code for other leading CMS platforms :)</p>
<p>OctoberCMS - Relation lists with filters [HOWTO]<br>OctoberCMS | Date: Sep 23, 2018</p>
<p>In more advanced projects you will soon realize that relation lists/forms and in general the whole RelationController is lacking funcionality. One of those things that are missing are filters in the relation list. But fear not, you can render lists and forms manually and then you can add filters to it. The best place to start with manual lists are these two tutorials: <a target="_blank" rel="noopener" href="https://octobercms.com/support/article/ob-21">https://octobercms.com/support/article/ob-21</a><br><a target="_blank" rel="noopener" href="https://octobercms.com/support/article/ob-20">https://octobercms.com/support/article/ob-20</a></p>
<p>But they only cover how to make a simple list rendered by hand in a partial and without filters. What I will cover in this article is how to do the same but using ListController (to render the list with filters for us automatically).</p>
<p>Once you know the formula this is a pretty easy process. But I recon that getting there by yourself can be a painfull process (it was for me). After seeing the tutorial videos you would probably dive into the Behaviours and ListController to see how October does it because the documentation is still lacking. But it also has some good sides, you need to consciously code your plugins, you can’t just paste random code form internet and make a plugin out of it. In other words, your code quality will be by default higher than code for other leading CMS platforms :)</p>
<p>But let’s get to the point. Let’s say we have Order controller and model, then we have Product controller and model, both are glued together by Many to Many relationship with some pivot data. You will soon realize that when adding products to order manually (after reaching about 100 products) it gets really annoying to scroll through list of products to get those you want to add to order. Yeah you have search but sometimes you don’t remeber the name, or you just want to browse given product category or color or anything like that. List filter would come handy here. Below are the steps needed to take to achieve that:</p>
<ul>
<li>Add custom button to relation toolbar to have Ajax handler that will render the custom list. We will remove the default Add Product button(rendered by RelationController) and put a custom Add Product button.</li>
<li>We need custom Products list widget to display list of products</li>
<li>We need to attach filter to Products list widget</li>
<li>As an option we need to use a query scope to show, lets say only active products.</li>
</ul>
<p>STEP 1. Edit Controller/Orders/config_relation.yaml Your toolbarButtons declaration for products relation probably looks like that:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toolbarButtons: add | remove</span><br></pre></td></tr></table></figure>

<p>Like I said before we want to use custom add button. Lets swap the default add button for a custom button. I will call it “productsadd” The line will look like this:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toolbarButtons: productsadd | remove</span><br></pre></td></tr></table></figure>
<p>Now we need to put the code for the custom button somewhere, October is really making this easy for us. The only thing we need to do is to create a file called <code>_relation_button_productsadd.htm</code> in Controller/orders directory.<br>This is how my file looks like:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;button</span><br><span class="line"><span class="class"><span class="keyword">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">secondary</span> <span class="title">oc</span>-<span class="title">icon</span>-<span class="title">plus</span>&quot;</span></span><br><span class="line"><span class="class"><span class="title">data</span>-<span class="title">control</span>=&quot;<span class="title">popup</span>&quot;</span></span><br><span class="line"><span class="class"><span class="title">data</span>-<span class="title">handler</span>=&quot;<span class="title">onAddProduct</span>&quot;</span></span><br><span class="line"><span class="class"><span class="title">data</span>-<span class="title">size</span>=&quot;<span class="title">large</span>&quot;&gt;</span></span><br><span class="line"><span class="class"><span class="title">Add</span> <span class="title">Product</span></span></span><br></pre></td></tr></table></figure>
<p>Two most important lines here are:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data-control=<span class="string">&quot;popup&quot;</span></span><br></pre></td></tr></table></figure>
<p>This will open the relation list in the modal window.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data-handler=<span class="string">&quot;onAddProduct&quot;</span></span><br></pre></td></tr></table></figure>
<p>This is our Ajax Handler to display custom list. We need to add a function in our Orders controller to handle it. Lets go to Controllers/Orders.php, but before we will add this action we should do some other things too. I will put it all in one file with comments explaning the lines of code we will add. Bear in mind that this is not the complete Orders.php controller file. Those are mostly only the lines of code you need to add.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line"><span class="comment"># List and Filter widgets variables, name them as you want :)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$productsListWidget</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$productsFilterWidget</span>;</span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">parent</span>::construct();</span><br><span class="line">BackendMenu::setContext(<span class="string">&#x27;Redmarlin.ShopClerk&#x27;</span>, <span class="string">&#x27;Shop&#x27;</span>, <span class="string">&#x27;Orders&#x27;</span>);</span><br><span class="line">    <span class="comment">#We need to create Products List Widget</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;productsListWidget = <span class="keyword">$this</span>-&gt;createProductListWidget();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line"><span class="comment"># This is Ajax Handler invoked when clickin on &quot;Add Product&quot; button. What it does is to just assign</span></span><br><span class="line"><span class="comment"># previously created widgets to variables that are accessible from partials.</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onAddProduct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;vars[<span class="string">&#x27;ProductListWidget&#x27;</span>] = <span class="keyword">$this</span>-&gt;ProductListWidget;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#Variable necessary for the Filter funcionality</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;vars[<span class="string">&#x27;ProductFilterWidget&#x27;</span>] = <span class="keyword">$this</span>-&gt;ProductFilterWidget;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#Process the custom list partial, The name you choose here will be the partials file name</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;makePartial(<span class="string">&#x27;product_custom_list&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ahhh finally there, the most important part, here we declare all the necessary</span></span><br><span class="line"><span class="comment"># things to make List widget with filters happen.</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">createProductListWidget</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#First we need config for the list, as described in video tutorials mentioned at the beginning.</span></span><br><span class="line">    <span class="comment"># Specify which list configuration file use for this list</span></span><br><span class="line">    <span class="variable">$config</span> = <span class="keyword">$this</span>-&gt;makeConfig(<span class="string">&#x27;$/redmarlin/shopclerk/models/product/columns_relation.yaml&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Specify the List model</span></span><br><span class="line">    <span class="variable">$config</span>-&gt;model = <span class="keyword">New</span> \Redmarlin\ShopClerk\Models\Product ;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Lets configure some more things like report per page and lets show checkboxes on the list.</span></span><br><span class="line">    <span class="comment"># Most of the options mentioned in https://octobercms.com/docs/backend/lists#configuring-list # will work</span></span><br><span class="line">    <span class="variable">$config</span>-&gt;recordsPerPage = <span class="string">&#x27;30&#x27;</span>;</span><br><span class="line">    <span class="variable">$config</span>-&gt;showCheckboxes = <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Here we will actually make the list using Lists Widget</span></span><br><span class="line">    <span class="variable">$widget_product</span> = <span class="keyword">$this</span>-&gt;makeWidget(<span class="string">&#x27;Backend\Widgets\Lists&#x27;</span>, <span class="variable">$config</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">#For the optional Step 4. Alter product list query before displaying it.</span></span><br><span class="line">    <span class="comment"># We will bind to list.extendQuery event and assign a function that should be executed to extend</span></span><br><span class="line">    <span class="comment"># the query (the function is defined in this very same controller file)</span></span><br><span class="line">    <span class="variable">$widget_product</span>-&gt;bindEvent(<span class="string">&#x27;list.extendQuery&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;productExtendQuery(<span class="variable">$query</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 3. The filter part, we must define the config, really similar to the Product list widget config</span></span><br><span class="line">    <span class="comment"># Filter configuration file</span></span><br><span class="line">    <span class="variable">$filterConfig</span> = <span class="keyword">$this</span>-&gt;makeConfig(<span class="string">&#x27;$/redmarlin/shopclerk/models/product/filter_relation.yaml&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Use Filter widgets to make the widget and bind it to the controller</span></span><br><span class="line">    <span class="variable">$filterWidget</span> = <span class="keyword">$this</span>-&gt;makeWidget(<span class="string">&#x27;Backend\Widgets\Filter&#x27;</span>, <span class="variable">$filterConfig</span>);</span><br><span class="line">    <span class="variable">$filterWidget</span>-&gt;bindToController();</span><br><span class="line"></span><br><span class="line">    <span class="comment"># We need to bind to filter.update event in order to refresh the list after selecting </span></span><br><span class="line">    <span class="comment"># the desired filters.</span></span><br><span class="line">    <span class="variable">$filterWidget</span>-&gt;bindEvent(<span class="string">&#x27;filter.update&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) <span class="keyword">use</span> (<span class="params"><span class="variable">$widget_product</span>, <span class="variable">$filterWidget</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$widget_product</span>-&gt;onRefresh();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">#Finally we are attaching The Filter widget to the Product widget.</span></span><br><span class="line">    <span class="variable">$widget_product</span>-&gt;addFilter([<span class="variable">$filterWidget</span>, <span class="string">&#x27;applyAllScopesToQuery&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;productFilterWidget = <span class="variable">$filterWidget</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Dont forget to bind the whole thing to the controller</span></span><br><span class="line">    <span class="variable">$widget_product</span>-&gt;bindToController();</span><br><span class="line"></span><br><span class="line">    <span class="comment">#Return the prepared widget object</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$widget_product</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Function that will extend default Product query and only show active products </span></span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">productExtendQuery</span>(<span class="params"><span class="variable">$query</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;status&#x27;</span>,<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>That is basically all that is needed in the Orders controller. But we are still a few things short. We need a partial that we have declared in our Ajax Handler (onAddProduct) - “product_custom_list”.<br>Create a file <code>_product_custom_list.htm</code> in Controllers/orders/ directory. The code in this file is basically copied from the RelationController partial for managing pivot relation (<code>modules/backend/behaviors/relationcontroller/partials/_manage_pivot.htm</code>). If you need code for other relation type just copy appropriate file from RelationController dir and then modify it to suit your needs. In the first line, by using the <code>data-request-data</code> we are telling relation controller what relation we are displaying here. Apart from that we are rendering Filter and List widget.</p>
<p>I have also customized a few other things here like: removed search widget and removed parts I wont use (ie the list will be always rendered with checkboxes).</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;relationManagePopup&quot;</span> data-request-data=<span class="string">&quot;_relation_field: &#x27;product&#x27;&quot;</span>&gt;</span><br><span class="line">    <span class="meta">&lt;?=</span> Form::open() <span class="meta">?&gt;</span></span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">modal</span>-<span class="title">header</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">button</span>&quot; <span class="title">class</span>=&quot;<span class="title">close</span>&quot; <span class="title">data</span>-<span class="title">dismiss</span>=&quot;<span class="title">popup</span>&quot;&gt;×&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">h4</span> <span class="title">class</span>=&quot;<span class="title">modal</span>-<span class="title">title</span>&quot;&gt;<span class="title">Product</span> <span class="title">Selection</span> <span class="title">List</span>&lt;/<span class="title">h4</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">list</span>-<span class="title">flush</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;?<span class="title">php</span> <span class="title">if</span> ($<span class="title">productFilterWidget</span>): ?&gt;</span></span><br><span class="line"><span class="class">                &lt;?= $<span class="title">productFilterWidget</span>-&gt;<span class="title">render</span>() ?&gt;</span></span><br><span class="line"><span class="class">            &lt;?<span class="title">php</span> <span class="title">endif</span> ?&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        &lt;?= $<span class="title">productListWidget</span>-&gt;<span class="title">render</span>() ?&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">modal</span>-<span class="title">footer</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">button</span></span></span><br><span class="line"><span class="class">                    <span class="title">type</span>=&quot;<span class="title">button</span>&quot;</span></span><br><span class="line"><span class="class">                    <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span>&quot;</span></span><br><span class="line"><span class="class">                    <span class="title">data</span>-<span class="title">control</span>=&quot;<span class="title">popup</span>&quot;</span></span><br><span class="line"><span class="class">                    <span class="title">data</span>-<span class="title">handler</span>=&quot;<span class="title">onRelationManageAddPivot</span>&quot;</span></span><br><span class="line"><span class="class">                    <span class="title">data</span>-<span class="title">size</span>=&quot;<span class="title">huge</span>&quot;</span></span><br><span class="line"><span class="class">                    <span class="title">data</span>-<span class="title">dismiss</span>=&quot;<span class="title">popup</span>&quot;</span></span><br><span class="line"><span class="class">                    <span class="title">data</span>-<span class="title">stripe</span>-<span class="title">load</span>-<span class="title">indicator</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;?= <span class="title">e</span>(<span class="title">trans</span>(&#x27;<span class="title">backend</span>::<span class="title">lang</span>.<span class="title">relation</span>.<span class="title">add_selected</span>&#x27;)) ?&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">button</span></span></span><br><span class="line"><span class="class">                <span class="title">type</span>=&quot;<span class="title">button</span>&quot;</span></span><br><span class="line"><span class="class">                <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">default</span>&quot;</span></span><br><span class="line"><span class="class">                <span class="title">data</span>-<span class="title">dismiss</span>=&quot;<span class="title">popup</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;?= <span class="title">e</span>(<span class="title">trans</span>(&#x27;<span class="title">backend</span>::<span class="title">lang</span>.<span class="title">relation</span>.<span class="title">cancel</span>&#x27;)) ?&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;?= <span class="title">Form</span>::<span class="title">close</span>() ?&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">setTimeout</span>(</span></span><br><span class="line"><span class="class">            <span class="title">function</span>()</span>&#123; $(<span class="string">&#x27;#relationManagePivotPopup input.form-control:first&#x27;</span>).focus() &#125;,</span><br><span class="line">            <span class="number">310</span></span><br><span class="line">    )</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>If you need search widget you need to add it the same way we added Filter widget.</p>
<p>With this we can render Products list with working filters in the Orders update/create screen as relation. After choosing Product from the list a pivot create form will be shown.</p>
<p>But there is still a tiny detail we should take care of. When using group type filter the dropdown list will be shown below our modal window. In other words it will be invisible!!! You can fix it with just one line of css. You need to change z-index of “control-popover” class to show it above the modal window. something like:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">div.control-popover &#123;</span><br><span class="line">z-index: <span class="number">9999</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>will do. Then I simply injected css file from plugin/assets/backend_mods.css into Orders controller. But you can inject it globally in the Plugin.php. This way you don’t need to add it in every controller.<br>That’s it, I hope you’ll find this tutorial helpful. Let me know if I got something wrong or something is not clear enough.</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://redmarlin.net/blog/category/octobercms">https://redmarlin.net/blog/category/octobercms</a></p>
</blockquote>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/OctoberCMS/" rel="tag"># OctoberCMS</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/02/28/Nativefier%E6%8A%8A%E7%BD%91%E9%A1%B5%E6%89%93%E5%8C%85%E6%88%90%E6%A1%8C%E9%9D%A2%E5%BA%94%E7%94%A8/" rel="prev" title="Nativefier把网页打包成桌面应用">
                  <i class="fa fa-chevron-left"></i> Nativefier把网页打包成桌面应用
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/09/15/How-to-automate-deployment-using-git-and-webhooks/" rel="next" title="How-to-automate-deployment-using-git-and-webhooks">
                  How-to-automate-deployment-using-git-and-webhooks <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lnmput@gmail.com</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
